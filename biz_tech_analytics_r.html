<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Business and Technical Analytics with R</title>
  <meta name="description" content="This is a study and reference notes to solving various business analytics problems using R.">
  <meta name="generator" content="bookdown <!--bookdown:version--> and GitBook 2.6.7">

  <meta property="og:title" content="Business and Technical Analytics with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a study and reference notes to solving various business analytics problems using R." />
  <meta name="github-repo" content="yongks/biz_tech_analytics_r" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Business and Technical Analytics with R" />
  
  <meta name="twitter:description" content="This is a study and reference notes to solving various business analytics problems using R." />
  

<meta name="author" content="Yong Keh Soon">


<meta name="date" content="2017-06-17">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #f8f8f8; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
pre, code { background-color: #f8f8f8; }
code > span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code > span.dt { color: #204a87; } /* DataType */
code > span.dv { color: #0000cf; } /* DecVal */
code > span.bn { color: #0000cf; } /* BaseN */
code > span.fl { color: #0000cf; } /* Float */
code > span.ch { color: #4e9a06; } /* Char */
code > span.st { color: #4e9a06; } /* String */
code > span.co { color: #8f5902; font-style: italic; } /* Comment */
code > span.ot { color: #8f5902; } /* Other */
code > span.al { color: #ef2929; } /* Alert */
code > span.fu { color: #000000; } /* Function */
code > span.er { color: #a40000; font-weight: bold; } /* Error */
code > span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #000000; } /* Constant */
code > span.sc { color: #000000; } /* SpecialChar */
code > span.vs { color: #4e9a06; } /* VerbatimString */
code > span.ss { color: #4e9a06; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #000000; } /* Variable */
code > span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code > span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code > span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code > span.ex { } /* Extension */
code > span.at { color: #c4a000; } /* Attribute */
code > span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code > span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



<!--bookdown:title:start-->
<div id="header">
<h1 class="title">Business and Technical Analytics with R</h1>
<h4 class="author"><em>Yong Keh Soon</em></h4>
<h4 class="date"><em>2017-06-17</em></h4>
</div>
<!--bookdown:title:end-->

<!--bookdown:toc:start-->
  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">
<!--bookdown:toc2:start-->
<ul>
<li><a href="#preface">Preface</a></li>
<li><a href="#fundamentals"><span class="toc-section-number">1</span> R Fundamentals</a><ul>
<li><a href="#package-management"><span class="toc-section-number">1.1</span> Package Management</a><ul>
<li><a href="#package-storage"><span class="toc-section-number">1.1.1</span> Package Storage</a></li>
<li><a href="#package-listing"><span class="toc-section-number">1.1.2</span> Package Listing</a></li>
<li><a href="#package-install-removal"><span class="toc-section-number">1.1.3</span> Package Install / Removal</a></li>
<li><a href="#package-update"><span class="toc-section-number">1.1.4</span> Package Update</a></li>
<li><a href="#package-corruption"><span class="toc-section-number">1.1.5</span> Package Corruption</a></li>
</ul></li>
<li><a href="#data-types"><span class="toc-section-number">1.2</span> Data Types</a><ul>
<li><a href="#string"><span class="toc-section-number">1.2.1</span> String</a></li>
<li><a href="#dates-manipulation"><span class="toc-section-number">1.2.2</span> Dates Manipulation</a></li>
</ul></li>
<li><a href="#conditioinal-decision"><span class="toc-section-number">1.3</span> Conditioinal Decision</a></li>
<li><a href="#looping"><span class="toc-section-number">1.4</span> Looping</a></li>
<li><a href="#apply-family"><span class="toc-section-number">1.5</span> Apply Family</a><ul>
<li><a href="#overview"><span class="toc-section-number">1.5.1</span> Overview</a></li>
<li><a href="#apply"><span class="toc-section-number">1.5.2</span> apply</a></li>
<li><a href="#sapply"><span class="toc-section-number">1.5.3</span> sapply</a></li>
<li><a href="#tapply"><span class="toc-section-number">1.5.4</span> tapply</a></li>
</ul></li>
<li><a href="#data-import"><span class="toc-section-number">1.6</span> Data Import</a><ul>
<li><a href="#working-directory"><span class="toc-section-number">1.6.1</span> Working Directory</a></li>
<li><a href="#importing-csv"><span class="toc-section-number">1.6.2</span> Importing CSV</a></li>
</ul></li>
</ul></li>
<li><a href="#data-generation"><span class="toc-section-number">2</span> Data Generation</a><ul>
<li><a href="#sequential-number"><span class="toc-section-number">2.1</span> Sequential Number</a><ul>
<li><a href="#using-return-vector"><span class="toc-section-number">2.1.1</span> Using <code>:</code> : return vector</a></li>
<li><a href="#using-seq-return-vector"><span class="toc-section-number">2.1.2</span> Using <code>seq</code> : return vector</a></li>
</ul></li>
<li><a href="#random-number"><span class="toc-section-number">2.2</span> Random Number</a><ul>
<li><a href="#unified-distribution"><span class="toc-section-number">2.2.1</span> Unified Distribution</a></li>
<li><a href="#normal-distribution"><span class="toc-section-number">2.2.2</span> Normal Distribution</a></li>
<li><a href="#binomial-distribution"><span class="toc-section-number">2.2.3</span> Binomial Distribution</a></li>
<li><a href="#beta-distribution"><span class="toc-section-number">2.2.4</span> Beta Distribution</a></li>
<li><a href="#drawing-from-a-bag"><span class="toc-section-number">2.2.5</span> Drawing From A Bag</a></li>
</ul></li>
<li><a href="#factor"><span class="toc-section-number">2.3</span> Factor</a></li>
</ul></li>
<li><a href="#data-simulation"><span class="toc-section-number">3</span> Data Simulation</a><ul>
<li><a href="#linear-simulation"><span class="toc-section-number">3.1</span> Linear Simulation</a><ul>
<li><a href="#example-of-random-normal-x"><span class="toc-section-number">3.1.1</span> Example of Random Normal X</a></li>
<li><a href="#example-of-sequantial-x-non-random"><span class="toc-section-number">3.1.2</span> Example of Sequantial X (non-random)</a></li>
</ul></li>
<li><a href="#logarithm-simulation"><span class="toc-section-number">3.2</span> Logarithm Simulation</a></li>
<li><a href="#parabola-simulation"><span class="toc-section-number">3.3</span> Parabola Simulation</a><ul>
<li><a href="#example-of-random-normal-x-1"><span class="toc-section-number">3.3.1</span> Example of Random Normal X</a></li>
<li><a href="#example-of-sequantial-x-non-random-1"><span class="toc-section-number">3.3.2</span> Example of Sequantial X (non-random)</a></li>
</ul></li>
<li><a href="#polynomial-simulation"><span class="toc-section-number">3.4</span> Polynomial Simulation</a></li>
</ul></li>
<li><a href="#data-summarization"><span class="toc-section-number">4</span> Data Summarization</a><ul>
<li><a href="#sample-data"><span class="toc-section-number">4.1</span> Sample Data</a></li>
<li><a href="#frequency-table"><span class="toc-section-number">4.2</span> Frequency Table</a><ul>
<li><a href="#single-dimension-data"><span class="toc-section-number">4.2.1</span> Single Dimension Data</a></li>
<li><a href="#two-dimension-data"><span class="toc-section-number">4.2.2</span> Two Dimension Data</a></li>
<li><a href="#three-dimension-data"><span class="toc-section-number">4.2.3</span> Three Dimension Data</a></li>
<li><a href="#four-dimension-data"><span class="toc-section-number">4.2.4</span> Four Dimension Data</a></li>
<li><a href="#making-table-proportion"><span class="toc-section-number">4.2.5</span> Making Table Proportion</a></li>
<li><a href="#adding-margin-info-to-table"><span class="toc-section-number">4.2.6</span> Adding Margin Info To Table</a></li>
<li><a href="#proportion-table-with-margin"><span class="toc-section-number">4.2.7</span> Proportion Table with Margin</a></li>
</ul></li>
<li><a href="#data-aggregation"><span class="toc-section-number">4.3</span> Data Aggregation</a><ul>
<li><a href="#tapply-1"><span class="toc-section-number">4.3.1</span> tapply</a></li>
<li><a href="#aggretate---base-r"><span class="toc-section-number">4.3.2</span> aggretate - base R</a></li>
</ul></li>
<li><a href="#r-with-sql-emulation"><span class="toc-section-number">4.4</span> R with SQL Emulation</a><ul>
<li><a href="#library"><span class="toc-section-number">4.4.1</span> Library</a></li>
<li><a href="#run-the-code"><span class="toc-section-number">4.4.2</span> Run The Code</a></li>
</ul></li>
</ul></li>
<li><a href="#data-preprocessing"><span class="toc-section-number">5</span> Data Preprocessing</a><ul>
<li><a href="#library-1"><span class="toc-section-number">5.1</span> Library</a></li>
<li><a href="#sample-data-1"><span class="toc-section-number">5.2</span> Sample Data</a></li>
<li><a href="#column-manipulation"><span class="toc-section-number">5.3</span> Column Manipulation</a><ul>
<li><a href="#duplicating-columns"><span class="toc-section-number">5.3.1</span> Duplicating Columns</a></li>
<li><a href="#delete-columns"><span class="toc-section-number">5.3.2</span> Delete Columns</a></li>
<li><a href="#renaming-columns"><span class="toc-section-number">5.3.3</span> Renaming Columns</a></li>
</ul></li>
<li><a href="#missing-data"><span class="toc-section-number">5.4</span> Missing Data</a><ul>
<li><a href="#detecting-completeincomplete-vectorrow"><span class="toc-section-number">5.4.1</span> Detecting Complete/Incomplete Vector/Row</a></li>
<li><a href="#removing-missing-data"><span class="toc-section-number">5.4.2</span> Removing Missing Data</a></li>
</ul></li>
<li><a href="#merging-data"><span class="toc-section-number">5.5</span> Merging Data</a></li>
<li><a href="#string-manipulation"><span class="toc-section-number">5.6</span> String Manipulation</a><ul>
<li><a href="#extration"><span class="toc-section-number">5.6.1</span> Extration</a></li>
<li><a href="#removal"><span class="toc-section-number">5.6.2</span> Removal</a></li>
<li><a href="#concatenation"><span class="toc-section-number">5.6.3</span> Concatenation</a></li>
</ul></li>
<li><a href="#date-manipulation"><span class="toc-section-number">5.7</span> Date Manipulation</a><ul>
<li><a href="#parsing-date"><span class="toc-section-number">5.7.1</span> Parsing Date</a></li>
<li><a href="#daysmonthsyear-difference"><span class="toc-section-number">5.7.2</span> Days/Months/Year Difference</a></li>
<li><a href="#daysmonhtsyears-later"><span class="toc-section-number">5.7.3</span> Days/Monhts/Years Later</a></li>
<li><a href="#last-day-of-month"><span class="toc-section-number">5.7.4</span> Last Day of Month</a></li>
</ul></li>
<li><a href="#number-manipulation"><span class="toc-section-number">5.8</span> Number Manipulation</a><ul>
<li><a href="#sample-data-2"><span class="toc-section-number">5.8.1</span> Sample Data</a></li>
<li><a href="#z-score-scaling"><span class="toc-section-number">5.8.2</span> Z-Score Scaling</a></li>
<li><a href="#min-max-scaling"><span class="toc-section-number">5.8.3</span> Min Max Scaling</a></li>
</ul></li>
<li><a href="#artificial-grouping"><span class="toc-section-number">5.9</span> Artificial Grouping</a><ul>
<li><a href="#grouping-with-numeric-breakpoints"><span class="toc-section-number">5.9.1</span> Grouping with Numeric Breakpoints</a></li>
<li><a href="#grouping-based-on-custom-criteria"><span class="toc-section-number">5.9.2</span> Grouping based on Custom Criteria</a></li>
</ul></li>
</ul></li>
<li><a href="#find-order-and-filter-data"><span class="toc-section-number">6</span> Find, Order and Filter Data</a><ul>
<li><a href="#sample-data-3"><span class="toc-section-number">6.1</span> Sample Data</a></li>
<li><a href="#finding-data"><span class="toc-section-number">6.2</span> Finding Data</a></li>
<li><a href="#ordering-data"><span class="toc-section-number">6.3</span> Ordering Data</a><ul>
<li><a href="#ordering-vector"><span class="toc-section-number">6.3.1</span> Ordering Vector</a></li>
<li><a href="#ordering-data-frame"><span class="toc-section-number">6.3.2</span> Ordering Data Frame</a></li>
</ul></li>
<li><a href="#filtering-data"><span class="toc-section-number">6.4</span> Filtering Data</a><ul>
<li><a href="#subseting-vector"><span class="toc-section-number">6.4.1</span> Subseting Vector</a></li>
<li><a href="#subseting-data-frame"><span class="toc-section-number">6.4.2</span> Subseting Data Frame</a></li>
</ul></li>
</ul></li>
<li><a href="#graphic-visualization"><span class="toc-section-number">7</span> Graphic Visualization</a><ul>
<li><a href="#library-used"><span class="toc-section-number">7.1</span> Library used</a></li>
<li><a href="#sample-data-4"><span class="toc-section-number">7.2</span> Sample Data</a></li>
<li><a href="#histogram"><span class="toc-section-number">7.3</span> Histogram</a><ul>
<li><a href="#single-dimension-data-1"><span class="toc-section-number">7.3.1</span> Single Dimension Data</a></li>
<li><a href="#two-dimension-data-1"><span class="toc-section-number">7.3.2</span> Two Dimension Data</a></li>
</ul></li>
<li><a href="#scatter-plot"><span class="toc-section-number">7.4</span> Scatter Plot</a><ul>
<li><a href="#two-dimension-data-2"><span class="toc-section-number">7.4.1</span> Two Dimension Data</a></li>
<li><a href="#two-one-dimension-data"><span class="toc-section-number">7.4.2</span> Two + One Dimension Data</a></li>
</ul></li>
<li><a href="#bar-chart"><span class="toc-section-number">7.5</span> Bar Chart</a><ul>
<li><a href="#single-dimension-data-2"><span class="toc-section-number">7.5.1</span> Single Dimension Data</a></li>
<li><a href="#two-one-dimension-data-1"><span class="toc-section-number">7.5.2</span> Two + One Dimension Data</a></li>
<li><a href="#reordering"><span class="toc-section-number">7.5.3</span> Reordering</a></li>
<li><a href="#positioning"><span class="toc-section-number">7.5.4</span> Positioning</a></li>
<li><a href="#in-bar-text-labeling"><span class="toc-section-number">7.5.5</span> In-Bar Text Labeling</a></li>
</ul></li>
<li><a href="#box-plot"><span class="toc-section-number">7.6</span> Box Plot</a><ul>
<li><a href="#one-dimension-data"><span class="toc-section-number">7.6.1</span> One Dimension Data</a></li>
<li><a href="#two-dimension-data-3"><span class="toc-section-number">7.6.2</span> Two Dimension Data</a></li>
<li><a href="#two-one-dimension-data-2"><span class="toc-section-number">7.6.3</span> Two + One Dimension Data</a></li>
</ul></li>
<li><a href="#pie-chart"><span class="toc-section-number">7.7</span> Pie Chart</a></li>
</ul></li>
<li><a href="#statistics"><span class="toc-section-number">8</span> Statistics</a><ul>
<li><a href="#sample-data-5"><span class="toc-section-number">8.1</span> Sample Data</a></li>
<li><a href="#descriptive-summary"><span class="toc-section-number">8.2</span> Descriptive Summary</a><ul>
<li><a href="#single-vector"><span class="toc-section-number">8.2.1</span> Single Vector</a></li>
<li><a href="#multiple-vectors"><span class="toc-section-number">8.2.2</span> Multiple Vectors</a></li>
<li><a href="#custom-function"><span class="toc-section-number">8.2.3</span> Custom Function</a></li>
</ul></li>
<li><a href="#t-test"><span class="toc-section-number">8.3</span> T-Test</a></li>
<li><a href="#covariance-correlation"><span class="toc-section-number">8.4</span> Covariance / Correlation</a><ul>
<li><a href="#covariance"><span class="toc-section-number">8.4.1</span> Covariance</a></li>
<li><a href="#correlation"><span class="toc-section-number">8.4.2</span> Correlation</a></li>
<li><a href="#correlation-test-for-significance"><span class="toc-section-number">8.4.3</span> Correlation Test for significance</a></li>
</ul></li>
</ul></li>
<li><a href="#clustering-analysis"><span class="toc-section-number">9</span> Clustering Analysis</a><ul>
<li><a href="#library-2"><span class="toc-section-number">9.1</span> Library</a></li>
<li><a href="#application"><span class="toc-section-number">9.2</span> Application</a></li>
<li><a href="#sample-data-6"><span class="toc-section-number">9.3</span> Sample Data</a></li>
<li><a href="#general-steps"><span class="toc-section-number">9.4</span> General Steps</a></li>
<li><a href="#distance-algorithm"><span class="toc-section-number">9.5</span> Distance Algorithm</a><ul>
<li><a href="#euclidean-distance"><span class="toc-section-number">9.5.1</span> Euclidean Distance</a></li>
<li><a href="#manhattan-distance"><span class="toc-section-number">9.5.2</span> Manhattan Distance</a></li>
<li><a href="#maximum-distance"><span class="toc-section-number">9.5.3</span> Maximum Distance</a></li>
<li><a href="#canberra-distance"><span class="toc-section-number">9.5.4</span> Canberra Distance</a></li>
<li><a href="#minkowski-distance"><span class="toc-section-number">9.5.5</span> Minkowski Distance</a></li>
</ul></li>
<li><a href="#optimum-number-of-clusters-k"><span class="toc-section-number">9.6</span> Optimum Number of Clusters (K)</a><ul>
<li><a href="#elbow-method"><span class="toc-section-number">9.6.1</span> Elbow Method</a></li>
<li><a href="#average-silhoutte-method"><span class="toc-section-number">9.6.2</span> Average Silhoutte Method</a></li>
<li><a href="#nbclust-package-with-30-indices"><span class="toc-section-number">9.6.3</span> NbClust Package (with 30 Indices)</a></li>
</ul></li>
<li><a href="#clustering-algorithm-compared"><span class="toc-section-number">9.7</span> Clustering Algorithm Compared</a></li>
<li><a href="#hierarchical-clustering"><span class="toc-section-number">9.8</span> Hierarchical Clustering</a><ul>
<li><a href="#clustering-algorithm"><span class="toc-section-number">9.8.1</span> Clustering Algorithm</a></li>
<li><a href="#inter-cluster-distance-method"><span class="toc-section-number">9.8.2</span> Inter Cluster Distance Method</a></li>
<li><a href="#run-the-code-2"><span class="toc-section-number">9.8.3</span> Run The Code</a></li>
</ul></li>
<li><a href="#k-mean-clustering"><span class="toc-section-number">9.9</span> K-Mean Clustering</a><ul>
<li><a href="#clustering-algorithm-1"><span class="toc-section-number">9.9.1</span> Clustering Algorithm</a></li>
<li><a href="#run-the-code-3"><span class="toc-section-number">9.9.2</span> Run The Code</a></li>
<li><a href="#visualizing-k-mean-cluster"><span class="toc-section-number">9.9.3</span> Visualizing K-Mean Cluster</a></li>
</ul></li>
<li><a href="#agreement-with-actual-group-data"><span class="toc-section-number">9.10</span> Agreement With Actual Group Data</a><ul>
<li><a href="#compare-cluster-with-actual-data"><span class="toc-section-number">9.10.1</span> Compare Cluster with Actual Data</a></li>
<li><a href="#compare-two-clusters"><span class="toc-section-number">9.10.2</span> Compare Two Clusters</a></li>
</ul></li>
</ul></li>
<li><a href="#regression-analysis"><span class="toc-section-number">10</span> Regression Analysis</a><ul>
<li><a href="#introduction"><span class="toc-section-number">10.1</span> Introduction</a><ul>
<li><a href="#general-equation-and-terminilogy"><span class="toc-section-number">10.1.1</span> General Equation and Terminilogy</a></li>
<li><a href="#r-formula-object"><span class="toc-section-number">10.1.2</span> R Formula Object</a></li>
</ul></li>
<li><a href="#application-1"><span class="toc-section-number">10.2</span> Application</a></li>
<li><a href="#types-of-regression"><span class="toc-section-number">10.3</span> Types of Regression</a><ul>
<li><a href="#linear-and-non-lienar"><span class="toc-section-number">10.3.1</span> Linear and Non Lienar</a></li>
<li><a href="#choosing-the-regression-algorithm"><span class="toc-section-number">10.3.2</span> Choosing the Regression Algorithm</a></li>
</ul></li>
<li><a href="#linear-regression-ols"><span class="toc-section-number">10.4</span> Linear Regression (OLS)</a><ul>
<li><a href="#the-concept"><span class="toc-section-number">10.4.1</span> The Concept</a></li>
<li><a href="#assumptions"><span class="toc-section-number">10.4.2</span> Assumptions</a></li>
<li><a href="#equations"><span class="toc-section-number">10.4.3</span> Equations</a></li>
<li><a href="#ols-performance"><span class="toc-section-number">10.4.4</span> OLS Performance</a></li>
<li><a href="#sample-data-7"><span class="toc-section-number">10.4.5</span> Sample Data</a></li>
<li><a href="#run-the-code-4"><span class="toc-section-number">10.4.6</span> Run The Code</a></li>
</ul></li>
<li><a href="#regression-diagnostic"><span class="toc-section-number">10.5</span> Regression Diagnostic</a><ul>
<li><a href="#outlier-test"><span class="toc-section-number">10.5.1</span> Outlier Test</a></li>
<li><a href="#linearity-test"><span class="toc-section-number">10.5.2</span> Linearity Test</a></li>
<li><a href="#homoscedasticity-test"><span class="toc-section-number">10.5.3</span> Homoscedasticity Test</a></li>
<li><a href="#multicollinearity-test"><span class="toc-section-number">10.5.4</span> Multicollinearity Test</a></li>
<li><a href="#normality-test"><span class="toc-section-number">10.5.5</span> Normality Test</a></li>
</ul></li>
</ul></li>
<li><a href="#classification"><span class="toc-section-number">11</span> Classification</a><ul>
<li><a href="#introduction-1"><span class="toc-section-number">11.1</span> Introduction</a></li>
<li><a href="#application-2"><span class="toc-section-number">11.2</span> Application</a></li>
<li><a href="#comparing-algorithm"><span class="toc-section-number">11.3</span> Comparing Algorithm</a></li>
<li><a href="#logistic-regression"><span class="toc-section-number">11.4</span> Logistic Regression</a><ul>
<li><a href="#the-concept-1"><span class="toc-section-number">11.4.1</span> The Concept</a></li>
<li><a href="#assumptions-1"><span class="toc-section-number">11.4.2</span> Assumptions</a></li>
<li><a href="#equations-1"><span class="toc-section-number">11.4.3</span> Equations</a></li>
<li><a href="#sample-data-8"><span class="toc-section-number">11.4.4</span> Sample Data</a></li>
<li><a href="#run-the-code-5"><span class="toc-section-number">11.4.5</span> Run The Code</a></li>
</ul></li>
<li><a href="#performance-measurement"><span class="toc-section-number">11.5</span> Performance Measurement</a><ul>
<li><a href="#confusion-matrix"><span class="toc-section-number">11.5.1</span> Confusion Matrix</a></li>
<li><a href="#roc-curve"><span class="toc-section-number">11.5.2</span> ROC Curve</a></li>
</ul></li>
</ul></li>
<li><a href="#survival-analysis"><span class="toc-section-number">12</span> Survival Analysis</a><ul>
<li><a href="#library-3"><span class="toc-section-number">12.1</span> Library</a></li>
<li><a href="#sample-data-9"><span class="toc-section-number">12.2</span> Sample Data</a></li>
<li><a href="#the-code"><span class="toc-section-number">12.3</span> The Code</a></li>
<li><a href="#performance-evaluation"><span class="toc-section-number">12.4</span> Performance Evaluation</a></li>
</ul></li>
</ul>
<!--bookdown:toc2:end-->
      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Business and Technical Analytics with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!--bookdown:toc:end-->
<!--bookdown:body:start-->
<div id="preface" class="section level1 unnumbered">
<h1>Preface</h1>
<!--chapter:end:index.Rmd-->
</div>
<div id="fundamentals" class="section level1">
<h1><span class="header-section-number">1</span> R Fundamentals</h1>
<div id="package-management" class="section level2">
<h2><span class="header-section-number">1.1</span> Package Management</h2>
<div id="package-storage" class="section level3">
<h3><span class="header-section-number">1.1.1</span> Package Storage</h3>
<p>Here is where all the libraries are stored.<br />
Can you guess which are the <strong>baseR and third party libraries</strong> stored ?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">.libPaths</span>()</code></pre></div>
<pre><code>## [1] &quot;C:/Users/YKS-NIC/Documents/R/win-library/3.3&quot;
## [2] &quot;C:/Program Files/R/R-3.3.3/library&quot;</code></pre>
</div>
<div id="package-listing" class="section level3">
<h3><span class="header-section-number">1.1.2</span> Package Listing</h3>
<p>Use <strong><code>installed.packages()</code></strong> to return a data frame that list all installed packages.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>( <span class="kw">installed.packages</span>() )</code></pre></div>
<pre><code>##            Package      LibPath                                       
## abind      &quot;abind&quot;      &quot;C:/Users/YKS-NIC/Documents/R/win-library/3.3&quot;
## assertthat &quot;assertthat&quot; &quot;C:/Users/YKS-NIC/Documents/R/win-library/3.3&quot;
## backports  &quot;backports&quot;  &quot;C:/Users/YKS-NIC/Documents/R/win-library/3.3&quot;
## base64enc  &quot;base64enc&quot;  &quot;C:/Users/YKS-NIC/Documents/R/win-library/3.3&quot;
## BH         &quot;BH&quot;         &quot;C:/Users/YKS-NIC/Documents/R/win-library/3.3&quot;
## bitops     &quot;bitops&quot;     &quot;C:/Users/YKS-NIC/Documents/R/win-library/3.3&quot;
##            Version    Priority Depends        Imports          LinkingTo
## abind      &quot;1.4-5&quot;    NA       &quot;R (&gt;= 1.5.0)&quot; &quot;methods, utils&quot; NA       
## assertthat &quot;0.2.0&quot;    NA       NA             &quot;tools&quot;          NA       
## backports  &quot;1.1.0&quot;    NA       &quot;R (&gt;= 3.0.0)&quot; &quot;utils&quot;          NA       
## base64enc  &quot;0.1-3&quot;    NA       &quot;R (&gt;= 2.9.0)&quot; NA               NA       
## BH         &quot;1.62.0-1&quot; NA       NA             NA               NA       
## bitops     &quot;1.0-6&quot;    NA       NA             NA               NA       
##            Suggests   Enhances License         License_is_FOSS
## abind      NA         NA       &quot;LGPL (&gt;= 2)&quot;   NA             
## assertthat &quot;testthat&quot; NA       &quot;GPL-3&quot;         NA             
## backports  NA         NA       &quot;GPL-2&quot;         NA             
## base64enc  NA         &quot;png&quot;    &quot;GPL-2 | GPL-3&quot; NA             
## BH         NA         NA       &quot;BSL-1.0&quot;       NA             
## bitops     NA         NA       &quot;GPL (&gt;= 2)&quot;    NA             
##            License_restricts_use OS_type MD5sum NeedsCompilation Built  
## abind      NA                    NA      NA     &quot;no&quot;             &quot;3.3.2&quot;
## assertthat NA                    NA      NA     &quot;no&quot;             &quot;3.3.3&quot;
## backports  NA                    NA      NA     &quot;no&quot;             &quot;3.3.3&quot;
## base64enc  NA                    NA      NA     &quot;yes&quot;            &quot;3.3.2&quot;
## BH         NA                    NA      NA     &quot;no&quot;             &quot;3.3.2&quot;
## bitops     NA                    NA      NA     &quot;yes&quot;            &quot;3.3.2&quot;</code></pre>
<p><strong>TOO MANY COLUMNS !!</strong><br />
Below are the column names and its numbering for filtering purpose.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colnames</span>( <span class="kw">installed.packages</span>() )</code></pre></div>
<pre><code>##  [1] &quot;Package&quot;               &quot;LibPath&quot;              
##  [3] &quot;Version&quot;               &quot;Priority&quot;             
##  [5] &quot;Depends&quot;               &quot;Imports&quot;              
##  [7] &quot;LinkingTo&quot;             &quot;Suggests&quot;             
##  [9] &quot;Enhances&quot;              &quot;License&quot;              
## [11] &quot;License_is_FOSS&quot;       &quot;License_restricts_use&quot;
## [13] &quot;OS_type&quot;               &quot;MD5sum&quot;               
## [15] &quot;NeedsCompilation&quot;      &quot;Built&quot;</code></pre>
<p><strong>Perform column filter</strong> based on column names as necessary.<br />
Set parameter <strong>priority = ‘NA’ to exclude base R</strong> packages.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>( <span class="kw">installed.packages</span>( <span class="dt">priority=</span><span class="st">&#39;NA&#39;</span> ) [,<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)] )</code></pre></div>
<pre><code>##            Package      Version   
## abind      &quot;abind&quot;      &quot;1.4-5&quot;   
## assertthat &quot;assertthat&quot; &quot;0.2.0&quot;   
## backports  &quot;backports&quot;  &quot;1.1.0&quot;   
## base64enc  &quot;base64enc&quot;  &quot;0.1-3&quot;   
## BH         &quot;BH&quot;         &quot;1.62.0-1&quot;
## bitops     &quot;bitops&quot;     &quot;1.0-6&quot;</code></pre>
<p>Set parameter <strong>priority = ‘high’</strong> will include <strong>ONLY base R</strong> packages</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>( <span class="kw">installed.packages</span>( <span class="dt">priority=</span><span class="st">&#39;high&#39;</span> ) [,<span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">2</span>)] )</code></pre></div>
<pre><code>##         Version   LibPath                                       
## boot    &quot;1.3-19&quot;  &quot;C:/Users/YKS-NIC/Documents/R/win-library/3.3&quot;
## cluster &quot;2.0.6&quot;   &quot;C:/Users/YKS-NIC/Documents/R/win-library/3.3&quot;
## foreign &quot;0.8-68&quot;  &quot;C:/Users/YKS-NIC/Documents/R/win-library/3.3&quot;
## lattice &quot;0.20-35&quot; &quot;C:/Users/YKS-NIC/Documents/R/win-library/3.3&quot;
## MASS    &quot;7.3-47&quot;  &quot;C:/Users/YKS-NIC/Documents/R/win-library/3.3&quot;
## Matrix  &quot;1.2-10&quot;  &quot;C:/Users/YKS-NIC/Documents/R/win-library/3.3&quot;</code></pre>
</div>
<div id="package-install-removal" class="section level3">
<h3><span class="header-section-number">1.1.3</span> Package Install / Removal</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>( <span class="kw">c</span>(<span class="st">&#39;ggplot&#39;</span>, <span class="st">&#39;ggExtra&#39;</span>) )
<span class="kw">remove.packages</span> ( <span class="kw">c</span>(<span class="st">&#39;ggplot&#39;</span>, <span class="st">&#39;ggExtra&#39;</span>) )</code></pre></div>
</div>
<div id="package-update" class="section level3">
<h3><span class="header-section-number">1.1.4</span> Package Update</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">old.packages</span>()      ## list all old packages, their old version and available new version
<span class="kw">update.packages</span>()             ## need to input y/n/c for each old package to update
<span class="kw">update.packages</span>( <span class="dt">ask=</span><span class="ot">FALSE</span> )  ## automatically update all packages without asking</code></pre></div>
</div>
<div id="package-corruption" class="section level3">
<h3><span class="header-section-number">1.1.5</span> Package Corruption</h3>
<p>Sometimes a corrupted R package can give below issues:</p>
<ul>
<li>Error loading a library<br />
</li>
<li>Error installing a library<br />
</li>
<li>Error removing a library</li>
</ul>
<p>The solution is to:</p>
<ul>
<li>Remove the problematic package folder (see where they are stored using <strong>.libPaths()</strong> )<br />
</li>
<li>Reinstall the package</li>
</ul>
</div>
</div>
<div id="data-types" class="section level2">
<h2><span class="header-section-number">1.2</span> Data Types</h2>
<div id="string" class="section level3">
<h3><span class="header-section-number">1.2.1</span> String</h3>
<div id="string-comparison" class="section level4">
<h4><span class="header-section-number">1.2.1.1</span> String Comparison</h4>
</div>
<div id="string-manipulations" class="section level4">
<h4><span class="header-section-number">1.2.1.2</span> String Manipulations</h4>
<p><strong>Splitting</strong><br />
<strong>Combining</strong><br />
<strong>Extracting</strong></p>
</div>
</div>
<div id="dates-manipulation" class="section level3">
<h3><span class="header-section-number">1.2.2</span> Dates Manipulation</h3>
<div id="formatting" class="section level4">
<h4><span class="header-section-number">1.2.2.1</span> Formatting</h4>
</div>
<div id="dates-comparison" class="section level4">
<h4><span class="header-section-number">1.2.2.2</span> Dates Comparison</h4>
</div>
<div id="dates-manipulation-1" class="section level4">
<h4><span class="header-section-number">1.2.2.3</span> Dates Manipulation</h4>
<p><strong>Days Between</strong></p>
<p><strong>First Day of the Month</strong></p>
<p><strong>Last Day of the Month</strong></p>
<p><strong>Days/Months/Years After</strong></p>
</div>
</div>
</div>
<div id="conditioinal-decision" class="section level2">
<h2><span class="header-section-number">1.3</span> Conditioinal Decision</h2>
</div>
<div id="looping" class="section level2">
<h2><span class="header-section-number">1.4</span> Looping</h2>
</div>
<div id="apply-family" class="section level2">
<h2><span class="header-section-number">1.5</span> Apply Family</h2>
<div id="overview" class="section level3">
<h3><span class="header-section-number">1.5.1</span> Overview</h3>
<ul>
<li>Apply and its family is a useful function</li>
</ul>
</div>
<div id="apply" class="section level3">
<h3><span class="header-section-number">1.5.2</span> apply</h3>
</div>
<div id="sapply" class="section level3">
<h3><span class="header-section-number">1.5.3</span> sapply</h3>
</div>
<div id="tapply" class="section level3">
<h3><span class="header-section-number">1.5.4</span> tapply</h3>
</div>
</div>
<div id="data-import" class="section level2">
<h2><span class="header-section-number">1.6</span> Data Import</h2>
<div id="working-directory" class="section level3">
<h3><span class="header-section-number">1.6.1</span> Working Directory</h3>
<p>To display the current working directory.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getwd</span>()
## [1] &quot;C:/Users/YKS-NIC/Dropbox/R/business_technical_analytics_r&quot;</code></pre></div>
<p>To set the working directory, use below:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">setwd</span>(<span class="st">&quot;...new path...)</span></code></pre></div>
</div>
<div id="importing-csv" class="section level3">
<h3><span class="header-section-number">1.6.2</span> Importing CSV</h3>
<p><strong>read.csv</strong> is a similar to <strong>read.table</strong> but with some defaults value set as below for convenience of CSV import.</p>
<p>In the resulting data.frame, row.names attribute are automatically assigned with sequence number starting from 1.</p>
<blockquote>
<p><strong>read.csv</strong> ( file,<br />
<span class="math inline">\(\quad\)</span> header = TRUE - contain header row<br />
<span class="math inline">\(\quad\)</span> sep = “,” - column seperator marked as ‘,’<br />
<span class="math inline">\(\quad\)</span> dec = “.” - decimals marked as ‘.’<br />
<span class="math inline">\(\quad\)</span> na.strings = “NA” - vectors that define missing data marking <NA><br />
<span class="math inline">\(\quad\)</span> check.names = TRUE - col names with white space replaced with ‘.’<br />
<span class="math inline">\(\quad\)</span> stringsAsFactors = TRUE - convert string to factor</p>
</blockquote>
<p>Examine the below example of data import process (Excel–&gt;csv–&gt;R data.frame):</p>
<div id="original-excel-data-source" class="section level4">
<h4><span class="header-section-number">1.6.2.1</span> Original Excel Data Source</h4>
<div class="figure">
<img src="images/sample_excel_import.jpg" alt="Check out the Yellow areas in codes below !" />
<p class="caption">Check out the Yellow areas in codes below !</p>
</div>
</div>
<div id="exported-csv-file-from-excel" class="section level4">
<h4><span class="header-section-number">1.6.2.2</span> Exported CSV File from Excel</h4>
<pre><code>,,dept,gender,weight,height,date_birth,amount,date_last,date first
1,ID101,D1,Male,35,173,1/7/1973,100,2/29/2016,2013-07-31
2,ID102,D2,Female,37.1,164,28/2/1980,121,4/1/2017,2013-08-31
3,ID103,D3,Female,43.12,178,31/12/1978,152,10/31/2015,2014-12-31
4,ID104,D1,Male,38.123,182,12/1/1997,133,11/1/2016,2015-02-28
5,ID105,D1,Male,54.1234,159,2/1/1982,143,9/30/2016,2012-06-15
,ID106,D3,Female,34.12345,166,26/7/1973,155,11/27/2015,2013-04-28
7,ID107,D2,Male,49.123456,153,21/8/1985,117,3/31/2017,2014-03-01
8,ID108,D3,Female,75.1,151,9/8/1983,135,2/1/2015,
9,ID109,D2,Male,52.1,169,NULL,128,NA,
10,ID110,D3,NULL,88.8,171,NULL,141,NA,</code></pre>
</div>
<div id="import-into-r-data-frame" class="section level4">
<h4><span class="header-section-number">1.6.2.3</span> Import Into R Data Frame</h4>
<p>Example below specify multiple string elements that represents <strong>missing data</strong> in the CSV file. Also turn FALSE for stirngsAsFactors so all string columns are not converted to factor automatically.</p>
<p><strong>./</strong> is a relative path represents current R working directory. It can be replaced with complete non-relative path.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sample.df &lt;-<span class="st"> </span><span class="kw">read.csv</span> ( <span class="dt">file=</span><span class="st">&quot;./datasets/import_sample.csv&quot;</span>, 
    <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>,
    <span class="dt">na.strings=</span><span class="kw">c</span>(<span class="st">&#39;NA&#39;</span>,<span class="st">&#39;NULL&#39;</span>,<span class="st">&#39;&#39;</span>),
    <span class="dt">encoding=</span><span class="st">&quot;UTF-8&quot;</span>)
sample.df</code></pre></div>
<pre><code>##     X   X.1 dept gender   weight height date_birth amount  date_last
## 1   1 ID101   D1   Male 35.00000    173   1/7/1973    100  2/29/2016
## 2   2 ID102   D2 Female 37.10000    164  28/2/1980    121   4/1/2017
## 3   3 ID103   D3 Female 43.12000    178 31/12/1978    152 10/31/2015
## 4   4 ID104   D1   Male 38.12300    182  12/1/1997    133  11/1/2016
## 5   5 ID105   D1   Male 54.12340    159   2/1/1982    143  9/30/2016
## 6  NA ID106   D3 Female 34.12345    166  26/7/1973    155 11/27/2015
## 7   7 ID107   D2   Male 49.12346    153  21/8/1985    117  3/31/2017
## 8   8 ID108   D3 Female 75.10000    151   9/8/1983    135   2/1/2015
## 9   9 ID109   D2   Male 52.10000    169       &lt;NA&gt;    128       &lt;NA&gt;
## 10 10 ID110   D3   &lt;NA&gt; 88.80000    171       &lt;NA&gt;    141       &lt;NA&gt;
##    date.first
## 1  2013-07-31
## 2  2013-08-31
## 3  2014-12-31
## 4  2015-02-28
## 5  2012-06-15
## 6  2013-04-28
## 7  2014-03-01
## 8        &lt;NA&gt;
## 9        &lt;NA&gt;
## 10       &lt;NA&gt;</code></pre>
<p>Parameter <strong>check.names=TRUE</strong> automatically named ‘unnamed’ column, as well as replacing white spaces for column names with ‘.’.</p>
<p>All non-numeric data are imported as <strong>chr</strong> due to stringsAsFactor=FALSE.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(sample.df)
## &#39;data.frame&#39;:    10 obs. of  10 variables:
##  $ X         : int  1 2 3 4 5 NA 7 8 9 10
##  $ X.1       : chr  &quot;ID101&quot; &quot;ID102&quot; &quot;ID103&quot; &quot;ID104&quot; ...
##  $ dept      : chr  &quot;D1&quot; &quot;D2&quot; &quot;D3&quot; &quot;D1&quot; ...
##  $ gender    : chr  &quot;Male&quot; &quot;Female&quot; &quot;Female&quot; &quot;Male&quot; ...
##  $ weight    : num  35 37.1 43.1 38.1 54.1 ...
##  $ height    : int  173 164 178 182 159 166 153 151 169 171
##  $ date_birth: chr  &quot;1/7/1973&quot; &quot;28/2/1980&quot; &quot;31/12/1978&quot; &quot;12/1/1997&quot; ...
##  $ amount    : int  100 121 152 133 143 155 117 135 128 141
##  $ date_last : chr  &quot;2/29/2016&quot; &quot;4/1/2017&quot; &quot;10/31/2015&quot; &quot;11/1/2016&quot; ...
##  $ date.first: chr  &quot;2013-07-31&quot; &quot;2013-08-31&quot; &quot;2014-12-31&quot; &quot;2015-02-28&quot; ...</code></pre></div>
<!--chapter:end:01-fundamentals.Rmd-->
</div>
</div>
</div>
</div>
<div id="data-generation" class="section level1">
<h1><span class="header-section-number">2</span> Data Generation</h1>
<p>Here is a review of existing methods.</p>
<div id="sequential-number" class="section level2">
<h2><span class="header-section-number">2.1</span> Sequential Number</h2>
<div id="using-return-vector" class="section level3">
<h3><span class="header-section-number">2.1.1</span> Using <code>:</code> : return vector</h3>
<p>Produce sequantial integer with fix incremental or decremental by 1</p>
<p><strong>Incremental</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="dv">3</span><span class="op">:</span><span class="dv">6</span>            <span class="co"># incremental integer</span>
<span class="fl">1.25</span><span class="op">:</span><span class="fl">9.25</span>      <span class="co"># incremental decimal</span>
<span class="kw">c</span>(<span class="dv">3</span><span class="op">:</span><span class="dv">6</span>, <span class="fl">4.25</span><span class="op">:</span><span class="fl">8.25</span>)  <span class="co"># combination of multiple sequence</span></code></pre></div>
<pre><code>## [1] 3 4 5 6
## [1] 1.25 2.25 3.25 4.25 5.25 6.25 7.25 8.25 9.25
## [1] 3.00 4.00 5.00 6.00 4.25 5.25 6.25 7.25 8.25</code></pre>
<p><strong>Decremental</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="dv">6</span><span class="op">:</span><span class="dv">3</span>            <span class="co"># decremental integer</span>
<span class="fl">9.25</span><span class="op">:</span><span class="st"> </span><span class="fl">1.25</span>     <span class="co"># decremental decimal</span></code></pre></div>
<pre><code>## [1] 6 5 4 3
## [1] 9.25 8.25 7.25 6.25 5.25 4.25 3.25 2.25 1.25</code></pre>
</div>
<div id="using-seq-return-vector" class="section level3">
<h3><span class="header-section-number">2.1.2</span> Using <code>seq</code> : return vector</h3>
<p>Improvement from <code>:</code>, <strong><code>seq</code></strong> allows specifying <strong>incremental steps</strong> with <code>by=</code>.</p>
<blockquote>
<p><code>seq( from, to )</code><br />
<code>seq( from, to, by = )</code><br />
<code>seq( from, to, length.out = )     # potentially return decimal</code></p>
</blockquote>
<p><strong>Incremental</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">seq</span> (<span class="dv">3</span>, <span class="dv">12</span>)                   <span class="co"># default increment by=1</span>
<span class="kw">seq</span> (<span class="dv">3</span>, <span class="dv">12</span>, <span class="dt">by =</span> <span class="dv">4</span>)           <span class="co"># increment of integer</span>
<span class="kw">seq</span> (<span class="fl">3.25</span>, <span class="fl">12.25</span>, <span class="dt">by =</span> <span class="fl">2.25</span>)  <span class="co"># increment of decimal </span></code></pre></div>
<pre><code>##  [1]  3  4  5  6  7  8  9 10 11 12
## [1]  3  7 11
## [1]  3.25  5.50  7.75 10.00 12.25</code></pre>
<p><strong>Decremental</strong> - <code>from</code> must be larger than <code>to</code>, and <code>by</code> has to be negative.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">seq</span> (<span class="dv">12</span>, <span class="dv">3</span>)                    <span class="co"># default decrement by=-1</span>
<span class="kw">seq</span> (<span class="dv">12</span>, <span class="dv">3</span>, <span class="dt">by =</span> <span class="op">-</span><span class="dv">4</span>)           <span class="co"># decrement of integer</span>
<span class="kw">seq</span> (<span class="fl">12.25</span>, <span class="fl">3.25</span>, <span class="dt">by =</span> <span class="op">-</span><span class="fl">2.25</span>)  <span class="co"># decrement of decimal</span></code></pre></div>
<pre><code>##  [1] 12 11 10  9  8  7  6  5  4  3
## [1] 12  8  4
## [1] 12.25 10.00  7.75  5.50  3.25</code></pre>
<p><strong>Equal Spreading</strong> - with <code>length.out=</code></p>
<p>Equal Spreading of Integer</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">seq</span> (<span class="dv">10</span>, <span class="dv">50</span>, <span class="dt">length.out =</span> <span class="dv">9</span>)   <span class="co"># incremental spreding of integer</span>
<span class="kw">seq</span> (<span class="dv">50</span>, <span class="dv">10</span>, <span class="dt">length.out =</span> <span class="dv">9</span>)   <span class="co"># decremental spreading of integer</span></code></pre></div>
<pre><code>## [1] 10 15 20 25 30 35 40 45 50
## [1] 50 45 40 35 30 25 20 15 10</code></pre>
<p>Equal Spreading of Decimal</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">seq</span> (<span class="fl">10.33</span>, <span class="fl">50.55</span>, <span class="dt">length.out =</span> <span class="dv">9</span>)   <span class="co"># incremental spreading of decimal</span>
<span class="kw">seq</span> (<span class="fl">50.55</span>, <span class="fl">10.33</span>, <span class="dt">length.out =</span> <span class="dv">9</span>)   <span class="co"># decremental spreading of decimal</span></code></pre></div>
<pre><code>## [1] 10.3300 15.3575 20.3850 25.4125 30.4400 35.4675 40.4950 45.5225 50.5500
## [1] 50.5500 45.5225 40.4950 35.4675 30.4400 25.4125 20.3850 15.3575 10.3300</code></pre>
</div>
</div>
<div id="random-number" class="section level2">
<h2><span class="header-section-number">2.2</span> Random Number</h2>
<div id="unified-distribution" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Unified Distribution</h3>
<blockquote>
<p><code>runif( n )                # default min=0, max=1</code><br />
<code>runif( n, min=, max= )</code></p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">123</span>)
<span class="kw">runif</span>(<span class="dv">5</span>)                 <span class="co"># geenrate 5 numbers within default min=0, max=1</span>
<span class="kw">runif</span>(<span class="dv">5</span>, <span class="dt">min=</span><span class="dv">3</span>, <span class="dt">max=</span><span class="dv">9</span>)</code></pre></div>
<pre><code>## [1] 0.2875775 0.7883051 0.4089769 0.8830174 0.9404673
## [1] 3.273339 6.168633 8.354514 6.308610 5.739688</code></pre>
<p>Notice that the numbers generated are uniformly distributed.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">hist</span>(<span class="kw">runif</span>(<span class="dv">300</span>, <span class="dt">min=</span><span class="dv">3</span>, <span class="dt">max=</span><span class="dv">9</span>))</code></pre></div>
<p><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-26-1.png" width="864" /></p>
</div>
<div id="normal-distribution" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Normal Distribution</h3>
<blockquote>
<p><code>rnorm( n )                # default mean=0, sd=1</code><br />
<code>rnorm( n, mean=, sd= )</code></p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">123</span>)
<span class="kw">rnorm</span>(<span class="dv">5</span>)                  <span class="co"># geenrate 5 numbers within default min=0, max=1</span>
<span class="kw">rnorm</span>(<span class="dv">5</span>, <span class="dt">mean=</span><span class="dv">3</span>, <span class="dt">sd=</span><span class="fl">1.5</span>)</code></pre></div>
<pre><code>## [1] -0.56047565 -0.23017749  1.55870831  0.07050839  0.12928774
## [1] 5.572597 3.691374 1.102408 1.969721 2.331507</code></pre>
<p>Notice that the numbers generated are uniformly distributed.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">hist</span>(<span class="kw">rnorm</span>(<span class="dv">300</span>, <span class="dt">mean=</span><span class="dv">3</span>, <span class="dt">sd=</span><span class="fl">1.5</span>))</code></pre></div>
<p><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-28-1.png" width="864" /></p>
</div>
<div id="binomial-distribution" class="section level3">
<h3><span class="header-section-number">2.2.3</span> Binomial Distribution</h3>
<p>The code below generates ‘n’ number of observations, each observation is the number of success for a number of trials, and there is a specific probability for success of each trial:</p>
<p>The numbers generated has the below characteristic:</p>
<ol style="list-style-type: lower-alpha">
<li>Discrete number<br />
</li>
<li>Binomial distribution often well approximated by a <strong>Normal distribution</strong>, where:
<ul>
<li>mean = n * prob<br />
</li>
<li>variance = n * prob (1-prob)<br />
Theoritically, when n approaches infitity, a binomial is a normal distribution</li>
</ul></li>
</ol>
<blockquote>
<p><strong><code>rbinorm( n, size, prob )</code></strong><br />
<code>rbinorm( n=, size=, prob= )</code><br />
<span class="math inline">\(\quad\)</span> <code>n = number of observations</code><br />
<span class="math inline">\(\quad\)</span> <code>size = number of trials per observations</code><br />
<span class="math inline">\(\quad\)</span> <code>prob = probability of success for each trial</code></p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rbinom</span>(<span class="dv">100</span>, <span class="dv">10</span>, <span class="fl">0.4</span>)
##   [1] 6 6 5 3 1 3 3 6 3 3 5 6 4 5 2 3 7 5 5 4 4 5 6 4 2 4 5 2 3 4 5 6 4 4 5
##  [36] 6 6 2 4 3 6 5 2 5 3 2 6 2 5 3 1 4 2 3 4 4 5 3 4 4 5 5 5 6 7 4 4 3 4 3
##  [71] 1 5 4 2 3 4 2 2 4 3 6 3 1 6 3 4 4 3 3 4 4 4 5 5 4 4 1 0 8 2</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">hist</span>(<span class="kw">rbinom</span>(<span class="dv">100</span>, <span class="dv">10</span>, <span class="fl">0.4</span>))</code></pre></div>
<p><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-30-1.png" width="256.6656" /></p>
</div>
<div id="beta-distribution" class="section level3">
<h3><span class="header-section-number">2.2.4</span> Beta Distribution</h3>
<p><strong>Balanced Skewness</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">hist</span>(<span class="kw">rbeta</span>(<span class="dv">1000</span>, <span class="dv">1</span>,    <span class="dv">1</span>))     <span class="co"># no left and right skewness = uniform</span>
<span class="kw">hist</span>(<span class="kw">rbeta</span>(<span class="dv">1000</span>, <span class="dv">10</span>,   <span class="dv">10</span>))    <span class="co"># balanced left and right skew</span>
<span class="kw">hist</span>(<span class="kw">rbeta</span>(<span class="dv">1000</span>, <span class="dv">100</span>,  <span class="dv">100</span>))   <span class="co"># more balanced left and right skew</span></code></pre></div>
<p><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-31-1.png" width="256.6656" /><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-31-2.png" width="256.6656" /><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-31-3.png" width="256.6656" /></p>
<p><strong>Left or Right Skew</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">hist</span>(<span class="kw">rbeta</span>(<span class="dv">1000</span>, <span class="dv">1000</span>, <span class="dv">10</span>))    <span class="co"># left skewed more</span>
<span class="kw">hist</span>(<span class="kw">rbeta</span>(<span class="dv">1000</span>, <span class="dv">100</span>,  <span class="dv">1000</span>))  <span class="co"># right skew more</span></code></pre></div>
<p><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-32-1.png" width="256.6656" /><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-32-2.png" width="256.6656" /></p>
</div>
<div id="drawing-from-a-bag" class="section level3">
<h3><span class="header-section-number">2.2.5</span> Drawing From A Bag</h3>
<ul>
<li>A bag has been occupied with vector <code>x</code> (produced using <code>:</code> or any other vector)<br />
</li>
<li><code>sample()</code> will draw from this bag<br />
</li>
<li>Specifying <code>replace=T</code> emulate that the drwan sample will be put back to the bag for next draw<br />
</li>
<li>R will generate error if no enough samples to draw from ( size &gt; length(x) )</li>
</ul>
<blockquote>
<p><code>sample( x=, size= )</code><br />
<code>sample( x=, size=, replace=T) # recycle number even though it is not exhausted</code></p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span> (<span class="dv">123</span>)
<span class="kw">sample</span> (<span class="dv">10</span>,   <span class="dv">5</span>)        <span class="co"># choose 5 numbers from the &#39;bag&#39; containing 1:10</span>
<span class="kw">sample</span> (<span class="dv">3</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">5</span>)        <span class="co"># choose 5 numbers from the &#39;bag&#39; containing 3:10</span>

bag =<span class="st"> </span><span class="kw">runif</span>(<span class="dv">8</span>, <span class="dt">min=</span><span class="dv">3</span>, <span class="dt">max=</span><span class="dv">9</span>)  <span class="co"># define the content of the bag</span>
<span class="kw">sample</span> (bag, <span class="dv">5</span>, <span class="dt">replace=</span>T)    <span class="co"># draw from the bag, recycling numbers</span></code></pre></div>
<pre><code>## [1] 3 8 4 7 6
## [1] 3 6 8 5 4
## [1] 7.065424 3.252357 3.252357 8.398950 8.398950</code></pre>
</div>
</div>
<div id="factor" class="section level2">
<h2><span class="header-section-number">2.3</span> Factor</h2>
<p><strong>gl</strong> generates elements based on given levels. However, it is not randomized.</p>
<blockquote>
<p>gl ( n, k, ordered=FALSE )<br />
gl ( n, k, length = n*k, ordered=FALSE )<br />
<span class="math inline">\(quad\)</span> <code>n = number of levels</code><br />
<span class="math inline">\(quad\)</span> <code>k = number of elements to be created per level</code><br />
<span class="math inline">\(quad\)</span> <code>length = number of elements to be generated</code></p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">gl</span>( <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">9</span>, <span class="kw">c</span>(<span class="st">&#39;Aaa&#39;</span>,<span class="st">&#39;Bbb&#39;</span>,<span class="st">&#39;Ccc&#39;</span>), <span class="dt">ordered=</span><span class="ot">TRUE</span> )
## [1] Aaa Aaa Aaa Aaa Aaa Bbb Bbb Bbb Bbb
## Levels: Aaa &lt; Bbb &lt; Ccc
<span class="kw">str</span>( <span class="kw">gl</span>(<span class="dv">3</span>,<span class="dv">5</span>, <span class="dv">9</span>, <span class="kw">c</span>(<span class="st">&#39;Aaa&#39;</span>,<span class="st">&#39;Bbb&#39;</span>,<span class="st">&#39;Ccc&#39;</span>)) )
##  Factor w/ 3 levels &quot;Aaa&quot;,&quot;Bbb&quot;,&quot;Ccc&quot;: 1 1 1 1 1 2 2 2 2</code></pre></div>
<!--chapter:end:02-datagen.Rmd-->
</div>
</div>
<div id="data-simulation" class="section level1">
<h1><span class="header-section-number">3</span> Data Simulation</h1>
<div id="linear-simulation" class="section level2">
<h2><span class="header-section-number">3.1</span> Linear Simulation</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gen_slinear =<span class="st"> </span><span class="cf">function</span>(<span class="dt">n =</span> <span class="dv">50</span>, <span class="dt">start =</span> <span class="dv">0</span>, <span class="dt">intercept =</span> <span class="dv">0</span>, <span class="dt">coef =</span> <span class="dv">1</span>, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="dv">1</span>) {
    <span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))
    <span class="cf">if</span> (start <span class="op">==</span><span class="st"> </span><span class="op">-</span><span class="dv">1</span>)
        my.df =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="kw">rnorm</span>(n))   <span class="co"># x is normally distributed random number</span>
    <span class="cf">else</span>
        my.df =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> start<span class="op">:</span>n)    <span class="co"># x from 0 to 50</span>
    my.df<span class="op">$</span>f =<span class="st"> </span>my.df<span class="op">$</span>x <span class="op">*</span><span class="st"> </span>coef <span class="op">+</span><span class="st"> </span>intercept   <span class="co"># y = coef * x</span>
    my.df<span class="op">$</span>residuals =<span class="st"> </span><span class="kw">rnorm</span>(<span class="kw">length</span>(my.df<span class="op">$</span>x), <span class="dt">mean =</span> mean, <span class="dt">sd =</span> sd)
    my.df<span class="op">$</span>y =<span class="st"> </span>my.df<span class="op">$</span>f <span class="op">+</span><span class="st"> </span>my.df<span class="op">$</span>residuals    <span class="co"># introduce errors</span>
    <span class="kw">plot</span>(my.df<span class="op">$</span>x, my.df<span class="op">$</span>f, <span class="dt">main =</span> <span class="kw">paste</span>(<span class="st">&#39;Perfect Fit Line:</span><span class="ch">\n</span><span class="st">f = &#39;</span>, coef, <span class="st">&#39;x + &#39;</span>, intercept))
    <span class="kw">plot</span>(my.df<span class="op">$</span>x, my.df<span class="op">$</span>y, <span class="dt">main =</span> <span class="st">&#39;Constant Normal Errors Introduced&#39;</span>)
    <span class="kw">hist</span>(my.df<span class="op">$</span>y, <span class="dt">main =</span> <span class="st">&#39;Y Distribution&#39;</span>)
    <span class="kw">hist</span>(my.df<span class="op">$</span>residuals, <span class="dt">main =</span> <span class="st">&#39;Residuals Distribution&#39;</span>)
    my.df
}

my.slinear =<span class="st"> </span><span class="kw">gen_slinear</span>(<span class="dt">n =</span> <span class="dv">250</span>, <span class="dt">start=</span><span class="op">-</span><span class="dv">1</span>, <span class="dt">intercept =</span> <span class="dv">30</span>, <span class="dt">coef =</span> <span class="dv">2</span>, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="dv">10</span>)</code></pre></div>
<p><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-35-1.png" width="864" /></p>
<div id="example-of-random-normal-x" class="section level3">
<h3><span class="header-section-number">3.1.1</span> Example of Random Normal X</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my.slinear =<span class="st"> </span><span class="kw">gen_slinear</span>(<span class="dt">n =</span> <span class="dv">250</span>, <span class="dt">start=</span><span class="op">-</span><span class="dv">1</span>, <span class="dt">intercept =</span> <span class="dv">30</span>, <span class="dt">coef =</span> <span class="dv">2</span>, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="dv">10</span>)</code></pre></div>
<p><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-36-1.png" width="864" /></p>
</div>
<div id="example-of-sequantial-x-non-random" class="section level3">
<h3><span class="header-section-number">3.1.2</span> Example of Sequantial X (non-random)</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my.slinear =<span class="st"> </span><span class="kw">gen_slinear</span>(<span class="dt">n =</span> <span class="dv">250</span>, <span class="dt">start=</span><span class="dv">0</span>, <span class="dt">intercept =</span> <span class="dv">30</span>, <span class="dt">coef =</span> <span class="dv">2</span>, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="dv">10</span>)</code></pre></div>
<p><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-37-1.png" width="864" /></p>
</div>
</div>
<div id="logarithm-simulation" class="section level2">
<h2><span class="header-section-number">3.2</span> Logarithm Simulation</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gen_log =<span class="st"> </span><span class="cf">function</span>(<span class="dt">n =</span> <span class="dv">50</span>, <span class="dt">start =</span> <span class="op">-</span><span class="dv">1</span>, <span class="dt">root =</span> <span class="dv">0</span>, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="dv">10</span>) {
    <span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))
    <span class="cf">if</span> (start <span class="op">==</span><span class="st"> </span><span class="op">-</span><span class="dv">1</span>)
        my.df =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="kw">rnorm</span>(n)) <span class="co"># x is normally distributed random number</span>
    <span class="cf">else</span>
        my.df =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> start<span class="op">:</span>n)  <span class="co"># x from 0 to 50</span>
    
    my.df<span class="op">$</span>f =<span class="st"> </span><span class="kw">log</span>((my.df<span class="op">$</span>x <span class="op">+</span><span class="st"> </span>root)) <span class="co"># y=log(x+root</span>
    my.df<span class="op">$</span>residuals =<span class="st"> </span><span class="kw">rnorm</span>(<span class="kw">length</span>(my.df<span class="op">$</span>x), <span class="dt">mean =</span> mean, <span class="dt">sd =</span> sd)
    my.df<span class="op">$</span>y =<span class="st"> </span>my.df<span class="op">$</span>f <span class="op">+</span><span class="st"> </span>my.df<span class="op">$</span>residuals  <span class="co"># introduce errors</span>
    <span class="kw">plot</span>(my.df<span class="op">$</span>x, my.df<span class="op">$</span>f, <span class="dt">main =</span> <span class="kw">paste</span>(<span class="st">&#39;Perfect Fit Line:</span><span class="ch">\n</span><span class="st">f=log(x+&#39;</span>, root, <span class="st">&#39;)&#39;</span>))
    <span class="kw">plot</span>(my.df<span class="op">$</span>x, my.df<span class="op">$</span>y, <span class="dt">main =</span> <span class="st">&#39;Constant Normal Errors Introduced&#39;</span>)
    <span class="kw">hist</span>(my.df<span class="op">$</span>y, <span class="dt">main =</span> <span class="st">&#39;Y Distribution&#39;</span>)
    <span class="kw">hist</span>(my.df<span class="op">$</span>residuals, <span class="dt">main =</span> <span class="st">&#39;Residuals Distribution&#39;</span>)
    my.df
}

<span class="kw">gen_log</span>(<span class="dt">n=</span><span class="dv">100</span>, <span class="dt">start=</span><span class="dv">1</span>, <span class="dt">mean=</span><span class="dv">10</span>, <span class="dt">sd=</span><span class="fl">0.2</span>)</code></pre></div>
<pre><code>##       x         f residuals        y
## 1     1 0.0000000 10.356622 10.35662
## 2     2 0.6931472  9.715658 10.40880
## 3     3 1.0986123 10.328437 11.42705
## 4     4 1.3862944 10.024847 11.41114
## 5     5 1.6094379 10.000225 11.60966
## 6     6 1.7917595  9.734205 11.52596
## 7     7 1.9459101 10.155945 12.10186
## 8     8 2.0794415 10.258089 12.33753
## 9     9 2.1972246  9.795886 11.99311
## 10   10 2.3025851 10.140941 12.44353
## 11   11 2.3978953 10.265750 12.66365
## 12   12 2.4849066 10.343330 12.82824
## 13   13 2.5649494  9.828083 12.39303
## 14   14 2.6390573  9.797290 12.43635
## 15   15 2.7080502  9.955951 12.66400
## 16   16 2.7725887 10.031765 12.80435
## 17   17 2.8332133  9.826145 12.65936
## 18   18 2.8903718  9.853872 12.74424
## 19   19 2.9444390 10.222327 13.16677
## 20   20 2.9957323  9.966724 12.96246
## 21   21 3.0445224 10.193539 13.23806
## 22   22 3.0910425  9.900336 12.99138
## 23   23 3.1354942 10.185377 13.32087
## 24   24 3.1780538 10.016229 13.19428
## 25   25 3.2188758  9.977108 13.19598
## 26   26 3.2580965  9.627000 12.88510
## 27   27 3.2958369  9.715609 13.01145
## 28   28 3.3322045 10.142168 13.47437
## 29   29 3.3672958  9.741037 13.10833
## 30   30 3.4011974  9.786793 13.18799
## 31   31 3.4339872 10.032686 13.46667
## 32   32 3.4657359 10.183092 13.64883
## 33   33 3.4965076  9.941247 13.43775
## 34   34 3.5263605 10.165998 13.69236
## 35   35 3.5553481  9.748136 13.30348
## 36   36 3.5835189 10.200634 13.78415
## 37   37 3.6109179 10.152595 13.76351
## 38   38 3.6375862  9.893352 13.53094
## 39   39 3.6635616 10.061284 13.72485
## 40   40 3.6888795 10.241077 13.92996
## 41   41 3.7135721  9.799455 13.51303
## 42   42 3.7376696  9.821551 13.55922
## 43   43 3.7612001 10.006030 13.76723
## 44   44 3.7841896  9.915600 13.69979
## 45   45 3.8066625  9.950515 13.75718
## 46   46 3.8286414 10.128830 13.95747
## 47   47 3.8501476 10.043703 13.89385
## 48   48 3.8712010 10.304981 14.17618
## 49   49 3.8918203  9.795191 13.68701
## 50   50 3.9120230 10.103900 14.01592
## 51   51 3.9318256 10.004948 13.93677
## 52   52 3.9512437  9.805870 13.75711
## 53   53 3.9702919  9.660796 13.63109
## 54   54 3.9889840 10.132564 14.12155
## 55   55 4.0073332  9.983414 13.99075
## 56   56 4.0253517  9.741701 13.76705
## 57   57 4.0430513 10.058553 14.10160
## 58   58 4.0604430  9.980418 14.04086
## 59   59 4.0775374 10.319549 14.39709
## 60   60 4.0943446  9.814869 13.90921
## 61   61 4.1108739 10.168137 14.27901
## 62   62 4.1271344  9.871789 13.99892
## 63   63 4.1431347  9.708217 13.85135
## 64   64 4.1588831 10.235564 14.39445
## 65   65 4.1743873  9.544156 13.71854
## 66   66 4.1896547 10.054442 14.24410
## 67   67 4.2046926 10.110215 14.31491
## 68   68 4.2195077 10.080951 14.30046
## 69   69 4.2341065  9.879233 14.11334
## 70   70 4.2484952  9.815594 14.06409
## 71   71 4.2626799 10.095982 14.35866
## 72   72 4.2766661 10.021176 14.29784
## 73   73 4.2904594  9.771924 14.06238
## 74   74 4.3040651  9.805703 14.10977
## 75   75 4.3174881  9.786070 14.10356
## 76   76 4.3307333  9.619565 13.95030
## 77   77 4.3438054 10.210773 14.55458
## 78   78 4.3567088  9.972054 14.32876
## 79   79 4.3694479  9.923880 14.29333
## 80   80 4.3820266 10.295239 14.67727
## 81   81 4.3944492 10.122145 14.51659
## 82   82 4.4067192 10.311371 14.71809
## 83   83 4.4188406 10.455816 14.87466
## 84   84 4.4308168  9.905639 14.33646
## 85   85 4.4426513 10.042537 14.48519
## 86   86 4.4543473 10.533253 14.98760
## 87   87 4.4659081 10.180419 14.64633
## 88   88 4.4773368 10.437282 14.91462
## 89   89 4.4886364 10.119064 14.60770
## 90   90 4.4998097 10.066552 14.56636
## 91   91 4.5108595 10.279845 14.79070
## 92   92 4.5217886 10.212606 14.73439
## 93   93 4.5325995  9.958137 14.49074
## 94   94 4.5432948  9.999681 14.54298
## 95   95 4.5538769  9.919399 14.47328
## 96   96 4.5643482 10.264941 14.82929
## 97   97 4.5747110  9.893774 14.46848
## 98   98 4.5849675 10.033555 14.61852
## 99   99 4.5951199  9.749212 14.34433
## 100 100 4.6051702 10.274920 14.88009</code></pre>
<p><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-38-1.png" width="864" /></p>
</div>
<div id="parabola-simulation" class="section level2">
<h2><span class="header-section-number">3.3</span> Parabola Simulation</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gen_parabola =<span class="st"> </span><span class="cf">function</span>(<span class="dt">n =</span> <span class="dv">50</span>, <span class="dt">start =</span> <span class="op">-</span><span class="dv">1</span>, <span class="dt">root1 =</span> <span class="op">-</span><span class="fl">0.5</span>, <span class="dt">root2 =</span> <span class="fl">0.5</span>, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="dv">1</span>) {
    <span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))
    <span class="cf">if</span> (start <span class="op">==</span><span class="st"> </span><span class="op">-</span><span class="dv">1</span>)
        my.df =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="kw">rnorm</span>(n)) <span class="co"># x is normally distributed random number</span>
    <span class="cf">else</span>
        my.df =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> start<span class="op">:</span>n)  <span class="co"># x from 0 to 50</span>
    my.df<span class="op">$</span>f =<span class="st"> </span>(my.df<span class="op">$</span>x <span class="op">-</span><span class="st"> </span>root1) <span class="op">*</span><span class="st"> </span>(my.df<span class="op">$</span>x <span class="op">-</span><span class="st"> </span>root2) <span class="co"># y=(x-20)(x-30), root at x=20 and x=30</span>
    my.df<span class="op">$</span>residuals =<span class="st"> </span><span class="kw">rnorm</span>(<span class="kw">length</span>(my.df<span class="op">$</span>x), <span class="dt">mean =</span> mean, <span class="dt">sd =</span> sd)
    my.df<span class="op">$</span>y =<span class="st"> </span>my.df<span class="op">$</span>f <span class="op">+</span><span class="st"> </span>my.df<span class="op">$</span>residuals  <span class="co"># introduce errors</span>
    <span class="kw">plot</span>(my.df<span class="op">$</span>x, my.df<span class="op">$</span>f, <span class="dt">main =</span> <span class="kw">paste</span>(<span class="st">&#39;Perfect Fit Line:</span><span class="ch">\n</span><span class="st">f=(x-&#39;</span>, root1, <span class="st">&#39;)(x-&#39;</span>, root2, <span class="st">&#39;)&#39;</span>))
    <span class="kw">plot</span>(my.df<span class="op">$</span>x, my.df<span class="op">$</span>y, <span class="dt">main =</span> <span class="st">&#39;Constant Normal Errors Introduced&#39;</span>)
    <span class="kw">hist</span>(my.df<span class="op">$</span>y, <span class="dt">main =</span> <span class="st">&#39;Y Distribution&#39;</span>)
    <span class="kw">hist</span>(my.df<span class="op">$</span>residuals, <span class="dt">main =</span> <span class="st">&#39;Residuals Distribution&#39;</span>)
    my.df
}</code></pre></div>
<div id="example-of-random-normal-x-1" class="section level3">
<h3><span class="header-section-number">3.3.1</span> Example of Random Normal X</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my.parabola =<span class="st"> </span><span class="kw">gen_parabola</span>(<span class="dt">n =</span> <span class="dv">250</span>, <span class="dt">start=</span><span class="op">-</span><span class="dv">1</span>, <span class="dt">root1 =</span> <span class="fl">0.25</span>, <span class="dt">root2 =</span> .<span class="dv">5</span>, <span class="dt">sd =</span> <span class="dv">1000</span>)</code></pre></div>
<p><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-40-1.png" width="864" /></p>
</div>
<div id="example-of-sequantial-x-non-random-1" class="section level3">
<h3><span class="header-section-number">3.3.2</span> Example of Sequantial X (non-random)</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my.parabola =<span class="st"> </span><span class="kw">gen_parabola</span>(<span class="dt">n =</span> <span class="dv">50</span>, <span class="dt">start=</span><span class="dv">0</span>, <span class="dt">root1 =</span> <span class="dv">20</span>, <span class="dt">root2 =</span> <span class="dv">30</span>, <span class="dt">sd =</span> <span class="dv">1000</span>)</code></pre></div>
<p><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-41-1.png" width="864" /></p>
</div>
</div>
<div id="polynomial-simulation" class="section level2">
<h2><span class="header-section-number">3.4</span> Polynomial Simulation</h2>
<p><span class="math display">\[ y = \beta_0 + \beta_1 x + \beta_2 x^2 +  \beta_3 x^3 + ...+ \beta_k x^k \]</span></p>
<!--chapter:end:03-datasim.Rmd-->
</div>
</div>
<div id="data-summarization" class="section level1">
<h1><span class="header-section-number">4</span> Data Summarization</h1>
<p>This capter explore manipulating table-like data, summarization and aggregation.</p>
<div id="sample-data" class="section level2">
<h2><span class="header-section-number">4.1</span> Sample Data</h2>
<p>Sample data used simulate two categorical-alike feature, and two numeric value feature:</p>
<ul>
<li><strong>dept</strong> is random character between ‘D1’, ‘D2’ and ‘D3’<br />
</li>
<li><strong>grp</strong> is random character with randomly generated ‘G1’, ‘G2’<br />
</li>
<li><strong>value1</strong> represents numeric value, normally distributed at mean 50<br />
</li>
<li><strong>value2</strong> is numeric value, normally distributed at mean 25</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1234</span>)
my.df =<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">com  =</span> <span class="kw">paste</span>(<span class="st">&#39;C&#39;</span>,<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dv">100</span>, <span class="dt">replace =</span> T),<span class="dt">sep=</span><span class="st">&#39;&#39;</span>),
  <span class="dt">dept =</span> <span class="kw">paste</span>(<span class="st">&#39;D&#39;</span>,<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dv">100</span>, <span class="dt">replace =</span> T),<span class="dt">sep=</span><span class="st">&#39;&#39;</span>),
  <span class="dt">grp  =</span> <span class="kw">paste</span>(<span class="st">&#39;G&#39;</span>,<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dv">100</span>, <span class="dt">replace =</span> T),<span class="dt">sep=</span><span class="st">&#39;&#39;</span>),
  <span class="dt">team =</span> <span class="kw">paste</span>(<span class="st">&#39;T&#39;</span>,<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dv">100</span>, <span class="dt">replace =</span> T),<span class="dt">sep=</span><span class="st">&#39;&#39;</span>),
  <span class="dt">value1 =</span> <span class="kw">rnorm</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>, <span class="dt">mean =</span> <span class="dv">50</span>, <span class="dt">sd =</span> <span class="dv">5</span>),
  <span class="dt">value2 =</span> <span class="kw">rnorm</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>, <span class="dt">mean =</span> <span class="dv">20</span>, <span class="dt">sd =</span> <span class="dv">3</span>),
  <span class="dt">value3 =</span> <span class="kw">rnorm</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>, <span class="dt">mean =</span> <span class="dv">5</span>, <span class="dt">sd =</span> <span class="dv">1</span>),
  <span class="dt">stringsAsFactors =</span> F
)
<span class="kw">head</span>(my.df)</code></pre></div>
<pre><code>##   com dept grp team   value1   value2   value3
## 1  C1   D1  G2   T1 52.42613 18.26013 3.773185
## 2  C2   D2  G2   T2 53.48384 17.14016 5.036153
## 3  C2   D1  G1   T2 50.92757 19.46171 4.578607
## 4  C2   D1  G2   T1 53.50367 23.02942 4.100636
## 5  C2   D1  G2   T2 51.55841 20.07088 5.417441
## 6  C2   D1  G2   T1 53.80231 18.05292 5.153445</code></pre>
</div>
<div id="frequency-table" class="section level2">
<h2><span class="header-section-number">4.2</span> Frequency Table</h2>
<p><code>table</code> return table object (which is also array) that report frequency count base of categorical-alike data provided.</p>
<p><code>table</code> has the below data type characteristics. Note that only 2-dimensional table object is a matrix</p>
<table>
<thead>
<tr class="header">
<th align="center">Dimension</th>
<th align="center">is.atomic</th>
<th align="center">is.vector</th>
<th align="center">is.matrix</th>
<th align="center">is.array</th>
<th align="center">is.table</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">t1</td>
<td align="center">T</td>
<td align="center">F</td>
<td align="center">F</td>
<td align="center">T</td>
<td align="center">T</td>
</tr>
<tr class="even">
<td align="center">t2</td>
<td align="center">T</td>
<td align="center">F</td>
<td align="center">T</td>
<td align="center">T</td>
<td align="center">T</td>
</tr>
<tr class="odd">
<td align="center">t3</td>
<td align="center">T</td>
<td align="center">F</td>
<td align="center">F</td>
<td align="center">T</td>
<td align="center">T</td>
</tr>
<tr class="even">
<td align="center">t4</td>
<td align="center">T</td>
<td align="center">F</td>
<td align="center">F</td>
<td align="center">T</td>
<td align="center">T</td>
</tr>
</tbody>
</table>
<p><code>ftable</code> is technically a <strong>matrix</strong> with two dimensional data (it flatten multiple dimension data). It has below data type characteristic.</p>
<table>
<thead>
<tr class="header">
<th align="center">Dimension</th>
<th align="center">is.atomic</th>
<th align="center">is.vector</th>
<th align="center">is.matrix</th>
<th align="center">is.array</th>
<th align="center">is.table</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">T</td>
<td align="center">F</td>
<td align="center">T</td>
<td align="center">T</td>
<td align="center">F</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">T</td>
<td align="center">F</td>
<td align="center">T</td>
<td align="center">T</td>
<td align="center">F</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">T</td>
<td align="center">F</td>
<td align="center">T</td>
<td align="center">T</td>
<td align="center">F</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">T</td>
<td align="center">F</td>
<td align="center">T</td>
<td align="center">T</td>
<td align="center">F</td>
</tr>
</tbody>
</table>
<div id="single-dimension-data" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Single Dimension Data</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t1 =<span class="st"> </span><span class="kw">table</span>( my.df<span class="op">$</span>com )
t1</code></pre></div>
<pre><code>## 
## C1 C2 
## 55 45</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(t1)</code></pre></div>
<pre><code>##  &#39;table&#39; int [1:2(1d)] 55 45
##  - attr(*, &quot;dimnames&quot;)=List of 1
##   ..$ : chr [1:2] &quot;C1&quot; &quot;C2&quot;</code></pre>
</div>
<div id="two-dimension-data" class="section level3">
<h3><span class="header-section-number">4.2.2</span> Two Dimension Data</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t2 =<span class="st"> </span><span class="kw">table</span>( my.df<span class="op">$</span>com, my.df<span class="op">$</span>dept )
t2</code></pre></div>
<pre><code>##     
##      D1 D2 D3
##   C1 16 18 21
##   C2 15 18 12</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(t2)</code></pre></div>
<pre><code>##  &#39;table&#39; int [1:2, 1:3] 16 15 18 18 21 12
##  - attr(*, &quot;dimnames&quot;)=List of 2
##   ..$ : chr [1:2] &quot;C1&quot; &quot;C2&quot;
##   ..$ : chr [1:3] &quot;D1&quot; &quot;D2&quot; &quot;D3&quot;</code></pre>
</div>
<div id="three-dimension-data" class="section level3">
<h3><span class="header-section-number">4.2.3</span> Three Dimension Data</h3>
<p>When table contain three or more dimension, use <code>ftable (flat table)</code> to put multi dimension table into one flat output</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t3 =<span class="st"> </span><span class="kw">table</span>( my.df<span class="op">$</span>com, my.df<span class="op">$</span>dept, my.df<span class="op">$</span>grp )
t3</code></pre></div>
<pre><code>## , ,  = G1
## 
##     
##      D1 D2 D3
##   C1 10  7 11
##   C2  7  9  4
## 
## , ,  = G2
## 
##     
##      D1 D2 D3
##   C1  6 11 10
##   C2  8  9  8</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(t3)</code></pre></div>
<pre><code>##  &#39;table&#39; int [1:2, 1:3, 1:2] 10 7 7 9 11 4 6 8 11 9 ...
##  - attr(*, &quot;dimnames&quot;)=List of 3
##   ..$ : chr [1:2] &quot;C1&quot; &quot;C2&quot;
##   ..$ : chr [1:3] &quot;D1&quot; &quot;D2&quot; &quot;D3&quot;
##   ..$ : chr [1:2] &quot;G1&quot; &quot;G2&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">f3 =<span class="st"> </span><span class="kw">ftable</span>( t3 )
f3</code></pre></div>
<pre><code>##        G1 G2
##             
## C1 D1  10  6
##    D2   7 11
##    D3  11 10
## C2 D1   7  8
##    D2   9  9
##    D3   4  8</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(f3)</code></pre></div>
<pre><code>##  &#39;ftable&#39; int [1:6, 1:2] 10 7 11 7 9 4 6 11 10 8 ...
##  - attr(*, &quot;row.vars&quot;)=List of 2
##   ..$ : chr [1:2] &quot;C1&quot; &quot;C2&quot;
##   ..$ : chr [1:3] &quot;D1&quot; &quot;D2&quot; &quot;D3&quot;
##  - attr(*, &quot;col.vars&quot;)=List of 1
##   ..$ : chr [1:2] &quot;G1&quot; &quot;G2&quot;</code></pre>
</div>
<div id="four-dimension-data" class="section level3">
<h3><span class="header-section-number">4.2.4</span> Four Dimension Data</h3>
<p>When table contain three or more dimension, use <code>ftable (flat table)</code> to put multi dimension table into one flat output</p>
<div class="sourceCode"><pre class="sourceCode r bg-success"><code class="sourceCode r">t4 =<span class="st"> </span><span class="kw">table</span>( my.df<span class="op">$</span>com, my.df<span class="op">$</span>dept, my.df<span class="op">$</span>grp, my.df<span class="op">$</span>team )
t4</code></pre></div>
<pre class="bg-info"><code>## , ,  = G1,  = T1
## 
##     
##      D1 D2 D3
##   C1  4  5  4
##   C2  4  5  1
## 
## , ,  = G2,  = T1
## 
##     
##      D1 D2 D3
##   C1  3  6  6
##   C2  5  5  4
## 
## , ,  = G1,  = T2
## 
##     
##      D1 D2 D3
##   C1  6  2  7
##   C2  3  4  3
## 
## , ,  = G2,  = T2
## 
##     
##      D1 D2 D3
##   C1  3  5  4
##   C2  3  4  4</code></pre>
<div class="sourceCode"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span class="kw">str</span>(t4)</code></pre></div>
<pre class="bg-info"><code>##  &#39;table&#39; int [1:2, 1:3, 1:2, 1:2] 4 4 5 5 4 1 3 5 6 5 ...
##  - attr(*, &quot;dimnames&quot;)=List of 4
##   ..$ : chr [1:2] &quot;C1&quot; &quot;C2&quot;
##   ..$ : chr [1:3] &quot;D1&quot; &quot;D2&quot; &quot;D3&quot;
##   ..$ : chr [1:2] &quot;G1&quot; &quot;G2&quot;
##   ..$ : chr [1:2] &quot;T1&quot; &quot;T2&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r bg-success"><code class="sourceCode r">f4 =<span class="st"> </span><span class="kw">ftable</span>( t4 )
f4</code></pre></div>
<pre class="bg-info"><code>##           T1 T2
##                
## C1 D1 G1   4  6
##       G2   3  3
##    D2 G1   5  2
##       G2   6  5
##    D3 G1   4  7
##       G2   6  4
## C2 D1 G1   4  3
##       G2   5  3
##    D2 G1   5  4
##       G2   5  4
##    D3 G1   1  3
##       G2   4  4</code></pre>
<div class="sourceCode"><pre class="sourceCode r bg-success"><code class="sourceCode r"><span class="kw">str</span>(f4)</code></pre></div>
<pre class="bg-info"><code>##  &#39;ftable&#39; int [1:12, 1:2] 4 3 5 6 4 6 4 5 5 5 ...
##  - attr(*, &quot;row.vars&quot;)=List of 3
##   ..$ : chr [1:2] &quot;C1&quot; &quot;C2&quot;
##   ..$ : chr [1:3] &quot;D1&quot; &quot;D2&quot; &quot;D3&quot;
##   ..$ : chr [1:2] &quot;G1&quot; &quot;G2&quot;
##  - attr(*, &quot;col.vars&quot;)=List of 1
##   ..$ : chr [1:2] &quot;T1&quot; &quot;T2&quot;</code></pre>
</div>
<div id="making-table-proportion" class="section level3">
<h3><span class="header-section-number">4.2.5</span> Making Table Proportion</h3>
<p><code>prop.table</code> <strong>converts</strong> <code>table</code> or <code>ftable</code> object into proportion. It can calculate table-wise, column-wise or row-wise proportion.</p>
<blockquote>
<p>prop.table (x,margin=NULL)<br />
<span class="math inline">\(\quad\)</span> x = table object<br />
<span class="math inline">\(\quad\)</span> margin = NULL: proportion table-wise, 1-row_wise, 2-column_wise</p>
</blockquote>
<div id="proportion-table-on-table-object" class="section level4">
<h4><span class="header-section-number">4.2.5.1</span> Proportion Table on ‘table’ object</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">prop.table</span>( t1 )</code></pre></div>
<pre><code>## 
##   C1   C2 
## 0.55 0.45</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">prop.table</span>( t2 )</code></pre></div>
<pre><code>##     
##        D1   D2   D3
##   C1 0.16 0.18 0.21
##   C2 0.15 0.18 0.12</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">prop.table</span>( t2, <span class="dt">margin=</span><span class="dv">1</span> )</code></pre></div>
<pre><code>##     
##             D1        D2        D3
##   C1 0.2909091 0.3272727 0.3818182
##   C2 0.3333333 0.4000000 0.2666667</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">prop.table</span>( t2, <span class="dt">margin=</span><span class="dv">2</span> )</code></pre></div>
<pre><code>##     
##             D1        D2        D3
##   C1 0.5161290 0.5000000 0.6363636
##   C2 0.4838710 0.5000000 0.3636364</code></pre>
</div>
<div id="proportion-table-on-ftable-object" class="section level4">
<h4><span class="header-section-number">4.2.5.2</span> Proportion Table on ‘ftable’ object</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">prop.table</span>( f3 )</code></pre></div>
<pre><code>##          G1   G2
##                 
## C1 D1  0.10 0.06
##    D2  0.07 0.11
##    D3  0.11 0.10
## C2 D1  0.07 0.08
##    D2  0.09 0.09
##    D3  0.04 0.08</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">prop.table</span>( f4 )</code></pre></div>
<pre><code>##             T1   T2
##                    
## C1 D1 G1  0.04 0.06
##       G2  0.03 0.03
##    D2 G1  0.05 0.02
##       G2  0.06 0.05
##    D3 G1  0.04 0.07
##       G2  0.06 0.04
## C2 D1 G1  0.04 0.03
##       G2  0.05 0.03
##    D2 G1  0.05 0.04
##       G2  0.05 0.04
##    D3 G1  0.01 0.03
##       G2  0.04 0.04</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">prop.table</span>( f3, <span class="dt">margin=</span><span class="dv">1</span> )</code></pre></div>
<pre><code>##               G1        G2
##                           
## C1 D1  0.6250000 0.3750000
##    D2  0.3888889 0.6111111
##    D3  0.5238095 0.4761905
## C2 D1  0.4666667 0.5333333
##    D2  0.5000000 0.5000000
##    D3  0.3333333 0.6666667</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">prop.table</span>( f4, <span class="dt">margin=</span><span class="dv">1</span> )</code></pre></div>
<pre><code>##                  T1        T2
##                              
## C1 D1 G1  0.4000000 0.6000000
##       G2  0.5000000 0.5000000
##    D2 G1  0.7142857 0.2857143
##       G2  0.5454545 0.4545455
##    D3 G1  0.3636364 0.6363636
##       G2  0.6000000 0.4000000
## C2 D1 G1  0.5714286 0.4285714
##       G2  0.6250000 0.3750000
##    D2 G1  0.5555556 0.4444444
##       G2  0.5555556 0.4444444
##    D3 G1  0.2500000 0.7500000
##       G2  0.5000000 0.5000000</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">prop.table</span>( f3, <span class="dt">margin=</span><span class="dv">2</span> )</code></pre></div>
<pre><code>##                G1         G2
##                             
## C1 D1  0.20833333 0.11538462
##    D2  0.14583333 0.21153846
##    D3  0.22916667 0.19230769
## C2 D1  0.14583333 0.15384615
##    D2  0.18750000 0.17307692
##    D3  0.08333333 0.15384615</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">prop.table</span>( f4, <span class="dt">margin=</span><span class="dv">2</span> )</code></pre></div>
<pre><code>##                   T1         T2
##                                
## C1 D1 G1  0.07692308 0.12500000
##       G2  0.05769231 0.06250000
##    D2 G1  0.09615385 0.04166667
##       G2  0.11538462 0.10416667
##    D3 G1  0.07692308 0.14583333
##       G2  0.11538462 0.08333333
## C2 D1 G1  0.07692308 0.06250000
##       G2  0.09615385 0.06250000
##    D2 G1  0.09615385 0.08333333
##       G2  0.09615385 0.08333333
##    D3 G1  0.01923077 0.06250000
##       G2  0.07692308 0.08333333</code></pre>
</div>
</div>
<div id="adding-margin-info-to-table" class="section level3">
<h3><span class="header-section-number">4.2.6</span> Adding Margin Info To Table</h3>
<blockquote>
<p>addmargins (x, margin=NULL)<br />
<span class="math inline">\(\quad\)</span> x = table or ftable object<br />
<span class="math inline">\(\quad\)</span> margin = NULL: row and column-sum, 1-col_sum, 2-row_sum</p>
</blockquote>
<div id="margin-info-on-table-object" class="section level4">
<h4><span class="header-section-number">4.2.6.1</span> Margin Info on ‘table’ object</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">addmargins</span>( t2)</code></pre></div>
<pre><code>##      
##        D1  D2  D3 Sum
##   C1   16  18  21  55
##   C2   15  18  12  45
##   Sum  31  36  33 100</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">addmargins</span>( t2,<span class="dt">margin=</span><span class="dv">1</span> )</code></pre></div>
<pre><code>##      
##       D1 D2 D3
##   C1  16 18 21
##   C2  15 18 12
##   Sum 31 36 33</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">addmargins</span>( t2,<span class="dt">margin=</span><span class="dv">2</span> )</code></pre></div>
<pre><code>##     
##      D1 D2 D3 Sum
##   C1 16 18 21  55
##   C2 15 18 12  45</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">addmargins</span>( t3 )</code></pre></div>
<pre><code>## , ,  = G1
## 
##      
##        D1  D2  D3 Sum
##   C1   10   7  11  28
##   C2    7   9   4  20
##   Sum  17  16  15  48
## 
## , ,  = G2
## 
##      
##        D1  D2  D3 Sum
##   C1    6  11  10  27
##   C2    8   9   8  25
##   Sum  14  20  18  52
## 
## , ,  = Sum
## 
##      
##        D1  D2  D3 Sum
##   C1   16  18  21  55
##   C2   15  18  12  45
##   Sum  31  36  33 100</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">addmargins</span>( t4 )</code></pre></div>
<pre><code>## , ,  = G1,  = T1
## 
##      
##        D1  D2  D3 Sum
##   C1    4   5   4  13
##   C2    4   5   1  10
##   Sum   8  10   5  23
## 
## , ,  = G2,  = T1
## 
##      
##        D1  D2  D3 Sum
##   C1    3   6   6  15
##   C2    5   5   4  14
##   Sum   8  11  10  29
## 
## , ,  = Sum,  = T1
## 
##      
##        D1  D2  D3 Sum
##   C1    7  11  10  28
##   C2    9  10   5  24
##   Sum  16  21  15  52
## 
## , ,  = G1,  = T2
## 
##      
##        D1  D2  D3 Sum
##   C1    6   2   7  15
##   C2    3   4   3  10
##   Sum   9   6  10  25
## 
## , ,  = G2,  = T2
## 
##      
##        D1  D2  D3 Sum
##   C1    3   5   4  12
##   C2    3   4   4  11
##   Sum   6   9   8  23
## 
## , ,  = Sum,  = T2
## 
##      
##        D1  D2  D3 Sum
##   C1    9   7  11  27
##   C2    6   8   7  21
##   Sum  15  15  18  48
## 
## , ,  = G1,  = Sum
## 
##      
##        D1  D2  D3 Sum
##   C1   10   7  11  28
##   C2    7   9   4  20
##   Sum  17  16  15  48
## 
## , ,  = G2,  = Sum
## 
##      
##        D1  D2  D3 Sum
##   C1    6  11  10  27
##   C2    8   9   8  25
##   Sum  14  20  18  52
## 
## , ,  = Sum,  = Sum
## 
##      
##        D1  D2  D3 Sum
##   C1   16  18  21  55
##   C2   15  18  12  45
##   Sum  31  36  33 100</code></pre>
</div>
<div id="margin-info-on-ftable-object" class="section level4">
<h4><span class="header-section-number">4.2.6.2</span> Margin Info on ‘ftable’ object</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">addmargins</span>( f3 )</code></pre></div>
<pre><code>##           Sum
##     10  6  16
##      7 11  18
##     11 10  21
##      7  8  15
##      9  9  18
##      4  8  12
## Sum 48 52 100</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">addmargins</span>( f4 )</code></pre></div>
<pre><code>##           Sum
##      4  6  10
##      3  3   6
##      5  2   7
##      6  5  11
##      4  7  11
##      6  4  10
##      4  3   7
##      5  3   8
##      5  4   9
##      5  4   9
##      1  3   4
##      4  4   8
## Sum 52 48 100</code></pre>
</div>
</div>
<div id="proportion-table-with-margin" class="section level3">
<h3><span class="header-section-number">4.2.7</span> Proportion Table with Margin</h3>
<p>First to obtain the proportion table, then only add the margin.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">addmargins</span>( <span class="kw">prop.table</span>( t2 ))    <span class="co"># add both column and row margin</span></code></pre></div>
<pre><code>##      
##         D1   D2   D3  Sum
##   C1  0.16 0.18 0.21 0.55
##   C2  0.15 0.18 0.12 0.45
##   Sum 0.31 0.36 0.33 1.00</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">addmargins</span>( <span class="kw">prop.table</span>( t2 ), <span class="dv">1</span>) <span class="co"># add column margin</span></code></pre></div>
<pre><code>##      
##         D1   D2   D3
##   C1  0.16 0.18 0.21
##   C2  0.15 0.18 0.12
##   Sum 0.31 0.36 0.33</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">addmargins</span>( <span class="kw">prop.table</span>( t2 ), <span class="dv">2</span>) <span class="co"># add row margin</span></code></pre></div>
<pre><code>##     
##        D1   D2   D3  Sum
##   C1 0.16 0.18 0.21 0.55
##   C2 0.15 0.18 0.12 0.45</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">addmargins</span>( <span class="kw">prop.table</span>( t3 ))</code></pre></div>
<pre><code>## , ,  = G1
## 
##      
##         D1   D2   D3  Sum
##   C1  0.10 0.07 0.11 0.28
##   C2  0.07 0.09 0.04 0.20
##   Sum 0.17 0.16 0.15 0.48
## 
## , ,  = G2
## 
##      
##         D1   D2   D3  Sum
##   C1  0.06 0.11 0.10 0.27
##   C2  0.08 0.09 0.08 0.25
##   Sum 0.14 0.20 0.18 0.52
## 
## , ,  = Sum
## 
##      
##         D1   D2   D3  Sum
##   C1  0.16 0.18 0.21 0.55
##   C2  0.15 0.18 0.12 0.45
##   Sum 0.31 0.36 0.33 1.00</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">addmargins</span>( <span class="kw">prop.table</span>( t4 ))</code></pre></div>
<pre><code>## , ,  = G1,  = T1
## 
##      
##         D1   D2   D3  Sum
##   C1  0.04 0.05 0.04 0.13
##   C2  0.04 0.05 0.01 0.10
##   Sum 0.08 0.10 0.05 0.23
## 
## , ,  = G2,  = T1
## 
##      
##         D1   D2   D3  Sum
##   C1  0.03 0.06 0.06 0.15
##   C2  0.05 0.05 0.04 0.14
##   Sum 0.08 0.11 0.10 0.29
## 
## , ,  = Sum,  = T1
## 
##      
##         D1   D2   D3  Sum
##   C1  0.07 0.11 0.10 0.28
##   C2  0.09 0.10 0.05 0.24
##   Sum 0.16 0.21 0.15 0.52
## 
## , ,  = G1,  = T2
## 
##      
##         D1   D2   D3  Sum
##   C1  0.06 0.02 0.07 0.15
##   C2  0.03 0.04 0.03 0.10
##   Sum 0.09 0.06 0.10 0.25
## 
## , ,  = G2,  = T2
## 
##      
##         D1   D2   D3  Sum
##   C1  0.03 0.05 0.04 0.12
##   C2  0.03 0.04 0.04 0.11
##   Sum 0.06 0.09 0.08 0.23
## 
## , ,  = Sum,  = T2
## 
##      
##         D1   D2   D3  Sum
##   C1  0.09 0.07 0.11 0.27
##   C2  0.06 0.08 0.07 0.21
##   Sum 0.15 0.15 0.18 0.48
## 
## , ,  = G1,  = Sum
## 
##      
##         D1   D2   D3  Sum
##   C1  0.10 0.07 0.11 0.28
##   C2  0.07 0.09 0.04 0.20
##   Sum 0.17 0.16 0.15 0.48
## 
## , ,  = G2,  = Sum
## 
##      
##         D1   D2   D3  Sum
##   C1  0.06 0.11 0.10 0.27
##   C2  0.08 0.09 0.08 0.25
##   Sum 0.14 0.20 0.18 0.52
## 
## , ,  = Sum,  = Sum
## 
##      
##         D1   D2   D3  Sum
##   C1  0.16 0.18 0.21 0.55
##   C2  0.15 0.18 0.12 0.45
##   Sum 0.31 0.36 0.33 1.00</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">addmargins</span>( <span class="kw">prop.table</span>( f3 ))</code></pre></div>
<pre><code>##                Sum
##     0.10 0.06 0.16
##     0.07 0.11 0.18
##     0.11 0.10 0.21
##     0.07 0.08 0.15
##     0.09 0.09 0.18
##     0.04 0.08 0.12
## Sum 0.48 0.52 1.00</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">addmargins</span>( <span class="kw">prop.table</span>( f4 ))</code></pre></div>
<pre><code>##                Sum
##     0.04 0.06 0.10
##     0.03 0.03 0.06
##     0.05 0.02 0.07
##     0.06 0.05 0.11
##     0.04 0.07 0.11
##     0.06 0.04 0.10
##     0.04 0.03 0.07
##     0.05 0.03 0.08
##     0.05 0.04 0.09
##     0.05 0.04 0.09
##     0.01 0.03 0.04
##     0.04 0.04 0.08
## Sum 0.52 0.48 1.00</code></pre>
</div>
</div>
<div id="data-aggregation" class="section level2">
<h2><span class="header-section-number">4.3</span> Data Aggregation</h2>
<p>This chapter explore multiple methods to group data columns and computes value within groups:</p>
<ol style="list-style-type: decimal">
<li>apply</li>
<li>tapply</li>
<li>aggregate (10x slower than apply)</li>
</ol>
<div id="tapply-1" class="section level3">
<h3><span class="header-section-number">4.3.1</span> tapply</h3>
<blockquote>
<p><strong><code>tapply ( X, INDEX, FUN, na.rm = FALSE )</code></strong><br />
<span class="math inline">\(quad\)</span> <code>X = value vector</code><br />
<span class="math inline">\(quad\)</span> <code>INDEX = groups data, can be factor, number of string</code><br />
<span class="math inline">\(quad\)</span> <code>FUN = function to apply to elements in X according to group specified in INDEX</code><br />
<span class="math inline">\(quad\)</span> <code>na.rm = FALSE</code></p>
</blockquote>
<p><code>tapply</code> will divide the vector (X) into groups (INDEX), and perform computation (FUN) on each group.<br />
The output:</p>
<ol style="list-style-type: decimal">
<li>Is whatever FUN returns for each group<br />
</li>
<li><strong>INDEX as dimnames</strong> attribute (accessible through <strong>names()</strong> )</li>
</ol>
<p>Please take note that if there are <NA> in the vector X, some FUNC may fail to return value, such as mean, sum. So it is essential to specify <code>na.rm = TRUE</code>.</p>
<p><strong>FUN that returns vector</strong> - output is a vector</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tapply</span>(my.df<span class="op">$</span>value1, my.df<span class="op">$</span>com, <span class="dt">FUN=</span>mean)
<span class="kw">names</span>( <span class="kw">tapply</span>(my.df<span class="op">$</span>value1, my.df<span class="op">$</span>com, <span class="dt">FUN=</span>mean) )</code></pre></div>
<pre><code>##       C1       C2 
## 50.48732 51.12221 
## [1] &quot;C1&quot; &quot;C2&quot;</code></pre>
<p><strong>FUN that returns non-vector</strong> - output is <strong>list</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tapply</span>(my.df<span class="op">$</span>value1, my.df<span class="op">$</span>com, <span class="dt">FUN=</span>summary)
<span class="kw">names</span>( <span class="kw">tapply</span>(my.df<span class="op">$</span>value1, my.df<span class="op">$</span>com, <span class="dt">FUN=</span>summary) )</code></pre></div>
<pre><code>## $C1
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   33.83   48.04   51.29   50.49   53.47   61.37 
## 
## $C2
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   41.96   48.15   51.60   51.12   53.39   64.60 
## 
## [1] &quot;C1&quot; &quot;C2&quot;</code></pre>
</div>
<div id="aggretate---base-r" class="section level3">
<h3><span class="header-section-number">4.3.2</span> aggretate - base R</h3>
<p><strong>Aggregate</strong> is a very useful base R function and provides quick way to group data and values:</p>
<ul>
<li>Input in <strong>list/data.frame</strong>, computes and <strong>output new data.frame</strong>.<br />
</li>
<li>It groups categorical variable(s) and compute value variable(s) based on function FUN.<br />
</li>
<li>FUN can be <strong>min, max, mean, sd, sum or length (frequency count)</strong>.<br />
</li>
<li><strong>ONLY ONE function</strong> is supported, and it applies to all value variables !!!</li>
</ul>
<div id="basic-syntax-formula-method---data-source-is-data.frame" class="section level4">
<h4><span class="header-section-number">4.3.2.1</span> Basic Syntax (formula method) - data source is data.frame</h4>
<p>The <strong>formula method</strong> use <strong>‘data’</strong> parameter and therefore apply for single data source only. The objective is simplicy and without flexibility to customize column names</p>
<blockquote>
<p><strong>aggregate (data = df, formula, FUN = function) </strong><br />
Formula in the form: <strong>value~categorical</strong></p>
</blockquote>
<blockquote>
<p>one value variable ~ one categorical variable</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">aggregate</span> (<span class="dt">data =</span> my.df, value1 <span class="op">~</span><span class="st"> </span>grp, <span class="dt">FUN =</span> length)</code></pre></div>
<pre><code>##   grp value1
## 1  G1     48
## 2  G2     52</code></pre>
<blockquote>
<p>one value variable ~ multiple categorical variables</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">aggregate</span> (<span class="dt">data =</span> my.df, value1 <span class="op">~</span><span class="st"> </span>grp <span class="op">+</span><span class="st"> </span>dept, <span class="dt">FUN =</span> length)</code></pre></div>
<pre><code>##   grp dept value1
## 1  G1   D1     17
## 2  G2   D1     14
## 3  G1   D2     16
## 4  G2   D2     20
## 5  G1   D3     15
## 6  G2   D3     18</code></pre>
<blockquote>
<p>multiple value variables ~ one categorical variable, <strong>use cbind()</strong></p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">aggregate</span> (<span class="dt">data =</span> my.df, <span class="kw">cbind</span>(value1,value2) <span class="op">~</span><span class="st"> </span>grp, <span class="dt">FUN =</span> length)</code></pre></div>
<pre><code>##   grp value1 value2
## 1  G1     48     48
## 2  G2     52     52</code></pre>
<blockquote>
<p>multiple value variables ~ multiple categorical variable</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">aggregate</span> (<span class="dt">data =</span> my.df, <span class="kw">cbind</span>(value1,value2) <span class="op">~</span><span class="st"> </span>grp <span class="op">+</span><span class="st"> </span>dept, <span class="dt">FUN =</span> length)</code></pre></div>
<pre><code>##   grp dept value1 value2
## 1  G1   D1     17     17
## 2  G2   D1     14     14
## 3  G1   D2     16     16
## 4  G2   D2     20     20
## 5  G1   D3     15     15
## 6  G2   D3     18     18</code></pre>
<blockquote>
<p><strong>ALL</strong> value variables ~ multiple categorical variable, <strong>use dot notation</strong><br />
Change from FUN=length to sum results in <strong>error</strong> because sum() cannot be applied to non-numerical variable ‘team’</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">aggregate</span> (<span class="dt">data =</span> my.df, . <span class="op">~</span><span class="st"> </span>grp <span class="op">+</span><span class="st"> </span>dept, <span class="dt">FUN =</span> length)</code></pre></div>
<pre><code>##   grp dept com team value1 value2 value3
## 1  G1   D1  17   17     17     17     17
## 2  G2   D1  14   14     14     14     14
## 3  G1   D2  16   16     16     16     16
## 4  G2   D2  20   20     20     20     20
## 5  G1   D3  15   15     15     15     15
## 6  G2   D3  18   18     18     18     18</code></pre>
</div>
<div id="advance-syntax-by-method---data-source-is-either-list-or-data.frame" class="section level4">
<h4><span class="header-section-number">4.3.2.2</span> Advance Syntax (by method) - data source is either list or data.frame</h4>
<p>The <strong>advantage</strong> of ’<strong>by method’</strong> are:</p>
<ul>
<li>Can use list/data.frame subset method to choose column to display, hence flexible<br />
</li>
<li>Can customize output column names (list subset method only)<br />
</li>
<li>Flexibility to use multiple data sources, hence <strong>‘data’ is not used</strong> and has no effect if specified</li>
</ul>
<blockquote>
<p>Using <strong>list subseting:</strong> column name is not preserved, hence must specify meaningful column names. If not supplied, generic names and undesirable column names derived from data value will be used as column name<br />
<em><strong>aggregate (x = list(…value_variables…), by = list(…categorical_variables…), FUN = function)</strong></em></p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">aggregate</span> (<span class="dt">x =</span>  <span class="kw">list</span>( <span class="dt">v1_mean =</span> my.df<span class="op">$</span>value1, my.df<span class="op">$</span>value2 ), 
           <span class="dt">by =</span> <span class="kw">list</span>( my.df<span class="op">$</span>grp, <span class="dt">DEPT =</span> my.df<span class="op">$</span>dept), <span class="dt">FUN=</span>mean)</code></pre></div>
<pre><code>##   Group.1 DEPT  v1_mean
## 1      G1   D1 49.19603
## 2      G2   D1 50.23397
## 3      G1   D2 50.64011
## 4      G2   D2 52.20157
## 5      G1   D3 51.81631
## 6      G2   D3 50.34312
##   c.18.2601290329418..17.1401638941593..19.4617142391631..23.0294246448329..
## 1                                                                   19.74277
## 2                                                                   20.99601
## 3                                                                   19.87320
## 4                                                                   19.65301
## 5                                                                   19.13836
## 6                                                                   20.54948</code></pre>
<blockquote>
<p>Using <strong>data.frame subseting:</strong> column names are preserved and no option to change. Notice attempt below to change the column name does not succeed<br />
<em><strong><em>aggregate( x = df[,c(…)], by = df[,c(…)]), FUN = function) </em></strong></em><br />
<em><strong><em>aggregate( x = df[, p:q], by = df[,s:t]), FUN = function) </em></strong></em></p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">aggregate</span>(<span class="dt">x=</span>my.df[, <span class="kw">c</span>(<span class="dt">v1_mean=</span><span class="st">&#39;value1&#39;</span>, <span class="st">&#39;value2&#39;</span>)], <span class="dt">by=</span>my.df[,<span class="kw">c</span>(<span class="dt">GRP=</span><span class="st">&#39;grp&#39;</span>, <span class="st">&#39;dept&#39;</span>)], <span class="dt">FUN=</span>mean)
<span class="co"># aggregate(x = my.df[, 4:5], by = my.df[, 1:2], FUN = mean) # produce similar result as above</span></code></pre></div>
<pre><code>##   grp dept   value1   value2
## 1  G1   D1 49.19603 19.74277
## 2  G2   D1 50.23397 20.99601
## 3  G1   D2 50.64011 19.87320
## 4  G2   D2 52.20157 19.65301
## 5  G1   D3 51.81631 19.13836
## 6  G2   D3 50.34312 20.54948</code></pre>
</div>
</div>
</div>
<div id="r-with-sql-emulation" class="section level2">
<h2><span class="header-section-number">4.4</span> R with SQL Emulation</h2>
<p>Running SQL statement on existing data.frame are useful to derive summarization and aggregation for someone who are familiar with SQL.</p>
<div id="library" class="section level3">
<h3><span class="header-section-number">4.4.1</span> Library</h3>
<p><strong>sqldf</strong> library is required. It has dependency on gsubfn, proto and RSQLite packages.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sqldf)</code></pre></div>
</div>
<div id="run-the-code" class="section level3">
<h3><span class="header-section-number">4.4.2</span> Run The Code</h3>
<p>R data.frame variable is specified in <strong>‘FROM’</strong> clause.<br />
Note that <code>.</code> is a SQL operator, any variable with ‘.’ must be contained within <strong>single quote</strong>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sqldf</span>(<span class="st">&quot;</span>
<span class="st">  SELECT com, dept, count(*) AS qty, AVG(value1) AS v1_mean, SUM(value2) AS v2_sum</span>
<span class="st">  FROM &#39;my.df&#39;  </span>
<span class="st">  GROUP BY com, dept</span>
<span class="st">&quot;</span>)</code></pre></div>
<pre><code>##   com dept qty  v1_mean   v2_sum
## 1  C1   D1  16 48.57577 312.0188
## 2  C1   D2  18 51.93834 351.8293
## 3  C1   D3  21 50.69999 421.0995
## 4  C2   D1  15 50.82638 317.5524
## 5  C2   D2  18 51.07683 359.2020
## 6  C2   D3  12 51.56008 235.8664</code></pre>
<!--chapter:end:04-data_summ.Rmd-->
</div>
</div>
</div>
<div id="data-preprocessing" class="section level1">
<h1><span class="header-section-number">5</span> Data Preprocessing</h1>
<div id="library-1" class="section level2">
<h2><span class="header-section-number">5.1</span> Library</h2>
<p>Below are the external libraries used in this section.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&#39;lubridate&#39;</span>)</code></pre></div>
</div>
<div id="sample-data-1" class="section level2">
<h2><span class="header-section-number">5.2</span> Sample Data</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my.df &lt;-<span class="st"> </span><span class="kw">read.csv</span> ( <span class="dt">file=</span><span class="st">&quot;./datasets/import_sample.csv&quot;</span>, 
    <span class="dt">na.strings=</span><span class="kw">c</span>(<span class="st">&#39;NA&#39;</span>,<span class="st">&#39;NULL&#39;</span>,<span class="st">&#39;&#39;</span>),
    <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span> )
my.df</code></pre></div>
<pre><code>##     X   X.1 dept gender   weight height date_birth amount  date_last
## 1   1 ID101   D1   Male 35.00000    173   1/7/1973    100  2/29/2016
## 2   2 ID102   D2 Female 37.10000    164  28/2/1980    121   4/1/2017
## 3   3 ID103   D3 Female 43.12000    178 31/12/1978    152 10/31/2015
## 4   4 ID104   D1   Male 38.12300    182  12/1/1997    133  11/1/2016
## 5   5 ID105   D1   Male 54.12340    159   2/1/1982    143  9/30/2016
## 6  NA ID106   D3 Female 34.12345    166  26/7/1973    155 11/27/2015
## 7   7 ID107   D2   Male 49.12346    153  21/8/1985    117  3/31/2017
## 8   8 ID108   D3 Female 75.10000    151   9/8/1983    135   2/1/2015
## 9   9 ID109   D2   Male 52.10000    169       &lt;NA&gt;    128       &lt;NA&gt;
## 10 10 ID110   D3   &lt;NA&gt; 88.80000    171       &lt;NA&gt;    141       &lt;NA&gt;
##    date.first
## 1  2013-07-31
## 2  2013-08-31
## 3  2014-12-31
## 4  2015-02-28
## 5  2012-06-15
## 6  2013-04-28
## 7  2014-03-01
## 8        &lt;NA&gt;
## 9        &lt;NA&gt;
## 10       &lt;NA&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(my.df)</code></pre></div>
<pre><code>## &#39;data.frame&#39;:    10 obs. of  10 variables:
##  $ X         : int  1 2 3 4 5 NA 7 8 9 10
##  $ X.1       : chr  &quot;ID101&quot; &quot;ID102&quot; &quot;ID103&quot; &quot;ID104&quot; ...
##  $ dept      : chr  &quot;D1&quot; &quot;D2&quot; &quot;D3&quot; &quot;D1&quot; ...
##  $ gender    : chr  &quot;Male&quot; &quot;Female&quot; &quot;Female&quot; &quot;Male&quot; ...
##  $ weight    : num  35 37.1 43.1 38.1 54.1 ...
##  $ height    : int  173 164 178 182 159 166 153 151 169 171
##  $ date_birth: chr  &quot;1/7/1973&quot; &quot;28/2/1980&quot; &quot;31/12/1978&quot; &quot;12/1/1997&quot; ...
##  $ amount    : int  100 121 152 133 143 155 117 135 128 141
##  $ date_last : chr  &quot;2/29/2016&quot; &quot;4/1/2017&quot; &quot;10/31/2015&quot; &quot;11/1/2016&quot; ...
##  $ date.first: chr  &quot;2013-07-31&quot; &quot;2013-08-31&quot; &quot;2014-12-31&quot; &quot;2015-02-28&quot; ...</code></pre>
</div>
<div id="column-manipulation" class="section level2">
<h2><span class="header-section-number">5.3</span> Column Manipulation</h2>
<div id="duplicating-columns" class="section level3">
<h3><span class="header-section-number">5.3.1</span> Duplicating Columns</h3>
<p>Duplicate single column using <code>$</code> selector</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my.df<span class="op">$</span>Z1 =<span class="st"> </span>my.df<span class="op">$</span>X
my.df<span class="op">$</span>Z2 =<span class="st"> </span>my.df<span class="op">$</span>X
<span class="kw">str</span>(my.df)</code></pre></div>
<pre><code>## &#39;data.frame&#39;:    10 obs. of  12 variables:
##  $ X         : int  1 2 3 4 5 NA 7 8 9 10
##  $ X.1       : chr  &quot;ID101&quot; &quot;ID102&quot; &quot;ID103&quot; &quot;ID104&quot; ...
##  $ dept      : chr  &quot;D1&quot; &quot;D2&quot; &quot;D3&quot; &quot;D1&quot; ...
##  $ gender    : chr  &quot;Male&quot; &quot;Female&quot; &quot;Female&quot; &quot;Male&quot; ...
##  $ weight    : num  35 37.1 43.1 38.1 54.1 ...
##  $ height    : int  173 164 178 182 159 166 153 151 169 171
##  $ date_birth: chr  &quot;1/7/1973&quot; &quot;28/2/1980&quot; &quot;31/12/1978&quot; &quot;12/1/1997&quot; ...
##  $ amount    : int  100 121 152 133 143 155 117 135 128 141
##  $ date_last : chr  &quot;2/29/2016&quot; &quot;4/1/2017&quot; &quot;10/31/2015&quot; &quot;11/1/2016&quot; ...
##  $ date.first: chr  &quot;2013-07-31&quot; &quot;2013-08-31&quot; &quot;2014-12-31&quot; &quot;2015-02-28&quot; ...
##  $ Z1        : int  1 2 3 4 5 NA 7 8 9 10
##  $ Z2        : int  1 2 3 4 5 NA 7 8 9 10</code></pre>
</div>
<div id="delete-columns" class="section level3">
<h3><span class="header-section-number">5.3.2</span> Delete Columns</h3>
<p>Delete <strong>single column</strong> using <code>$</code> column selector, setting to NULL.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my.df<span class="op">$</span>Z1 =<span class="st"> </span><span class="ot">NULL</span></code></pre></div>
<p><strong>Delete multiple columns</strong> using multiple columns selector <code>[,vector]</code>, with vector containing column numbers or names, setting to NULL.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my.df[,<span class="kw">c</span>(<span class="st">&#39;X&#39;</span>,<span class="st">&#39;Z2&#39;</span>)] =<span class="st"> </span><span class="ot">NULL</span>
<span class="kw">str</span>(my.df)</code></pre></div>
<pre><code>## &#39;data.frame&#39;:    10 obs. of  9 variables:
##  $ X.1       : chr  &quot;ID101&quot; &quot;ID102&quot; &quot;ID103&quot; &quot;ID104&quot; ...
##  $ dept      : chr  &quot;D1&quot; &quot;D2&quot; &quot;D3&quot; &quot;D1&quot; ...
##  $ gender    : chr  &quot;Male&quot; &quot;Female&quot; &quot;Female&quot; &quot;Male&quot; ...
##  $ weight    : num  35 37.1 43.1 38.1 54.1 ...
##  $ height    : int  173 164 178 182 159 166 153 151 169 171
##  $ date_birth: chr  &quot;1/7/1973&quot; &quot;28/2/1980&quot; &quot;31/12/1978&quot; &quot;12/1/1997&quot; ...
##  $ amount    : int  100 121 152 133 143 155 117 135 128 141
##  $ date_last : chr  &quot;2/29/2016&quot; &quot;4/1/2017&quot; &quot;10/31/2015&quot; &quot;11/1/2016&quot; ...
##  $ date.first: chr  &quot;2013-07-31&quot; &quot;2013-08-31&quot; &quot;2014-12-31&quot; &quot;2015-02-28&quot; ...</code></pre>
</div>
<div id="renaming-columns" class="section level3">
<h3><span class="header-section-number">5.3.3</span> Renaming Columns</h3>
<p><strong>colnames</strong> returns vector of names attribute of data.frame.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">attributes</span>(my.df)
<span class="kw">colnames</span>(my.df)</code></pre></div>
<pre><code>## $names
## [1] &quot;X.1&quot;        &quot;dept&quot;       &quot;gender&quot;     &quot;weight&quot;     &quot;height&quot;    
## [6] &quot;date_birth&quot; &quot;amount&quot;     &quot;date_last&quot;  &quot;date.first&quot;
## 
## $row.names
##  [1]  1  2  3  4  5  6  7  8  9 10
## 
## $class
## [1] &quot;data.frame&quot;
## 
## [1] &quot;X.1&quot;        &quot;dept&quot;       &quot;gender&quot;     &quot;weight&quot;     &quot;height&quot;    
## [6] &quot;date_birth&quot; &quot;amount&quot;     &quot;date_last&quot;  &quot;date.first&quot;</code></pre>
<p>Use <strong>colnames</strong> to rename single or multiple columns. Use <code>[]</code> to select the specific column(s).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colnames</span>(my.df)[<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">9</span>)] =<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;id&#39;</span>,<span class="st">&#39;date_first&#39;</span>)
<span class="kw">colnames</span>(my.df)</code></pre></div>
<pre><code>## [1] &quot;id&quot;         &quot;dept&quot;       &quot;gender&quot;     &quot;weight&quot;     &quot;height&quot;    
## [6] &quot;date_birth&quot; &quot;amount&quot;     &quot;date_last&quot;  &quot;date_first&quot;</code></pre>
</div>
</div>
<div id="missing-data" class="section level2">
<h2><span class="header-section-number">5.4</span> Missing Data</h2>
<div id="detecting-completeincomplete-vectorrow" class="section level3">
<h3><span class="header-section-number">5.4.1</span> Detecting Complete/Incomplete Vector/Row</h3>
<p><strong>complete.cases</strong> returns logical vector for elements that <strong>doesn’t</strong> contain <NA>, with TRUE. It can be applied to both vector or data.frame.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">complete.cases</span>(my.df<span class="op">$</span>date_birth)   <span class="co"># vector example</span>
<span class="kw">complete.cases</span>(my.df)              <span class="co"># data.frame example</span></code></pre></div>
<pre><code>##  [1]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE FALSE
##  [1]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE</code></pre>
<p><strong>Negate</strong> complete.cases resulting TRUE for rows containing <NA>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">!</span><span class="kw">complete.cases</span>(my.df<span class="op">$</span>date_birth)  <span class="co"># vector example</span>
<span class="op">!</span><span class="kw">complete.cases</span>(my.df)             <span class="co"># data.frame example</span></code></pre></div>
<pre><code>##  [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE
##  [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE</code></pre>
<p>Result from complete.cases is useful to <strong>retrieve incomplete</strong> rows for further investigation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my.df[<span class="op">!</span><span class="kw">complete.cases</span>(my.df),]</code></pre></div>
<pre><code>##       id dept gender weight height date_birth amount date_last date_first
## 8  ID108   D3 Female   75.1    151   9/8/1983    135  2/1/2015       &lt;NA&gt;
## 9  ID109   D2   Male   52.1    169       &lt;NA&gt;    128      &lt;NA&gt;       &lt;NA&gt;
## 10 ID110   D3   &lt;NA&gt;   88.8    171       &lt;NA&gt;    141      &lt;NA&gt;       &lt;NA&gt;</code></pre>
</div>
<div id="removing-missing-data" class="section level3">
<h3><span class="header-section-number">5.4.2</span> Removing Missing Data</h3>
<p><strong>na.omit</strong> returns data with <NA> removed. The advantage of this method compare to <strong>complete.cases</strong> are:<br />
- <strong>simpler syntax</strong>, filtering using [rows,] not require<br />
- <strong>additonal attribute</strong>, accessible through <code>na.action()</code>, providing information on element number removed</p>
<p><strong>Remove Missing elements with <NA> in rows</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">na.omit</span>(my.df<span class="op">$</span>date_birth) <span class="co"># vector example</span>
<span class="kw">str</span>(<span class="kw">na.omit</span>(my.df<span class="op">$</span>date_birth))
## [1] &quot;1/7/1973&quot;   &quot;28/2/1980&quot;  &quot;31/12/1978&quot; &quot;12/1/1997&quot;  &quot;2/1/1982&quot;  
## [6] &quot;26/7/1973&quot;  &quot;21/8/1985&quot;  &quot;9/8/1983&quot;  
## attr(,&quot;na.action&quot;)
## [1]  9 10
## attr(,&quot;class&quot;)
## [1] &quot;omit&quot;
##  atomic [1:8] 1/7/1973 28/2/1980 31/12/1978 12/1/1997 ...
##  - attr(*, &quot;na.action&quot;)=Class &#39;omit&#39;  int [1:2] 9 10</code></pre></div>
<p><strong>Remove missing rows with <NA></strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># my.df[complete.cases(my.df),]   # longer method which is less elegant</span>
my.df =<span class="st"> </span><span class="kw">na.omit</span>(my.df)            <span class="co"># data.frame example</span>
<span class="kw">na.action</span>(my.df)                  <span class="co"># number of rows removed</span></code></pre></div>
<pre><code>##  8  9 10 
##  8  9 10 
## attr(,&quot;class&quot;)
## [1] &quot;omit&quot;</code></pre>
</div>
</div>
<div id="merging-data" class="section level2">
<h2><span class="header-section-number">5.5</span> Merging Data</h2>
</div>
<div id="string-manipulation" class="section level2">
<h2><span class="header-section-number">5.6</span> String Manipulation</h2>
<div id="extration" class="section level3">
<h3><span class="header-section-number">5.6.1</span> Extration</h3>
</div>
<div id="removal" class="section level3">
<h3><span class="header-section-number">5.6.2</span> Removal</h3>
</div>
<div id="concatenation" class="section level3">
<h3><span class="header-section-number">5.6.3</span> Concatenation</h3>
</div>
</div>
<div id="date-manipulation" class="section level2">
<h2><span class="header-section-number">5.7</span> Date Manipulation</h2>
<div id="parsing-date" class="section level3">
<h3><span class="header-section-number">5.7.1</span> Parsing Date</h3>
<p>The example below demonstrates conversion of date columns from formated string.</p>
<p><strong>Before Conversion</strong>, verify that all dates column are actually <code>chr</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(my.df)</code></pre></div>
<pre><code>## &#39;data.frame&#39;:    7 obs. of  9 variables:
##  $ id        : chr  &quot;ID101&quot; &quot;ID102&quot; &quot;ID103&quot; &quot;ID104&quot; ...
##  $ dept      : chr  &quot;D1&quot; &quot;D2&quot; &quot;D3&quot; &quot;D1&quot; ...
##  $ gender    : chr  &quot;Male&quot; &quot;Female&quot; &quot;Female&quot; &quot;Male&quot; ...
##  $ weight    : num  35 37.1 43.1 38.1 54.1 ...
##  $ height    : int  173 164 178 182 159 166 153
##  $ date_birth: chr  &quot;1/7/1973&quot; &quot;28/2/1980&quot; &quot;31/12/1978&quot; &quot;12/1/1997&quot; ...
##  $ amount    : int  100 121 152 133 143 155 117
##  $ date_last : chr  &quot;2/29/2016&quot; &quot;4/1/2017&quot; &quot;10/31/2015&quot; &quot;11/1/2016&quot; ...
##  $ date_first: chr  &quot;2013-07-31&quot; &quot;2013-08-31&quot; &quot;2014-12-31&quot; &quot;2015-02-28&quot; ...
##  - attr(*, &quot;na.action&quot;)=Class &#39;omit&#39;  Named int [1:3] 8 9 10
##   .. ..- attr(*, &quot;names&quot;)= chr [1:3] &quot;8&quot; &quot;9&quot; &quot;10&quot;</code></pre>
<p>Two ways to convert string to date:</p>
<ul>
<li><strong>as.Date</strong> can convert vector into <code>date</code> data type. A format parameter has to be specified to match the source format. Otherwise <code>as.Date</code> will try default format of “%Y-%m-%d” then “%Y/%m/%d”<br />
</li>
<li>lubridate::dmy, mdy, ymd - this is more elegant because manual format is not required. However, it converts only string data. If the data source is factor, <strong>convert it to string</strong> first or use <strong><code>as.Date()</code></strong> instead</li>
</ul>
<p>In both methods, unmatched rows with unrecognized format will throw an error.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my.df<span class="op">$</span>date_birth =<span class="st"> </span><span class="kw">as.Date</span>( my.df<span class="op">$</span>date_birth, <span class="dt">format =</span> <span class="st">&quot;%d/%m/%Y&quot;</span> )  <span class="co"># base R</span>
my.df<span class="op">$</span>date_last  =<span class="st"> </span><span class="kw">mdy</span>( my.df<span class="op">$</span>date_last  )    <span class="co"># lubridate </span>
my.df<span class="op">$</span>date_first =<span class="st"> </span><span class="kw">ymd</span>( my.df<span class="op">$</span>date_first )    <span class="co"># lubridate</span>
<span class="kw">str</span>(my.df)</code></pre></div>
<pre><code>## &#39;data.frame&#39;:    7 obs. of  9 variables:
##  $ id        : chr  &quot;ID101&quot; &quot;ID102&quot; &quot;ID103&quot; &quot;ID104&quot; ...
##  $ dept      : chr  &quot;D1&quot; &quot;D2&quot; &quot;D3&quot; &quot;D1&quot; ...
##  $ gender    : chr  &quot;Male&quot; &quot;Female&quot; &quot;Female&quot; &quot;Male&quot; ...
##  $ weight    : num  35 37.1 43.1 38.1 54.1 ...
##  $ height    : int  173 164 178 182 159 166 153
##  $ date_birth: Date, format: &quot;1973-07-01&quot; &quot;1980-02-28&quot; ...
##  $ amount    : int  100 121 152 133 143 155 117
##  $ date_last : Date, format: &quot;2016-02-29&quot; &quot;2017-04-01&quot; ...
##  $ date_first: Date, format: &quot;2013-07-31&quot; &quot;2013-08-31&quot; ...
##  - attr(*, &quot;na.action&quot;)=Class &#39;omit&#39;  Named int [1:3] 8 9 10
##   .. ..- attr(*, &quot;names&quot;)= chr [1:3] &quot;8&quot; &quot;9&quot; &quot;10&quot;</code></pre>
</div>
<div id="daysmonthsyear-difference" class="section level3">
<h3><span class="header-section-number">5.7.2</span> Days/Months/Year Difference</h3>
<div id="days-difference" class="section level4">
<h4><span class="header-section-number">5.7.2.1</span> Days Difference</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my.df<span class="op">$</span>date_last
my.df<span class="op">$</span>date_first
my.df<span class="op">$</span>date_last <span class="op">-</span><span class="st"> </span>my.df<span class="op">$</span>date_first</code></pre></div>
<pre><code>## [1] &quot;2016-02-29&quot; &quot;2017-04-01&quot; &quot;2015-10-31&quot; &quot;2016-11-01&quot; &quot;2016-09-30&quot;
## [6] &quot;2015-11-27&quot; &quot;2017-03-31&quot;
## [1] &quot;2013-07-31&quot; &quot;2013-08-31&quot; &quot;2014-12-31&quot; &quot;2015-02-28&quot; &quot;2012-06-15&quot;
## [6] &quot;2013-04-28&quot; &quot;2014-03-01&quot;
## Time differences in days
## [1]  943 1309  304  612 1568  943 1126</code></pre>
</div>
<div id="months-difference" class="section level4">
<h4><span class="header-section-number">5.7.2.2</span> Months Difference</h4>
<p>Combination of <code>lubridate::interval</code> and <code>lubridate operator</code> provides a integer vector of months elapsed between two date:<br />
- The result can be negative if first date parameter &gt; second date parameter<br />
- lubridate ‘intelligently’ knows interval is from end of month to end of month interval</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">interval</span>( <span class="kw">ymd</span>(<span class="st">&#39;2016-03-30&#39;</span>), <span class="kw">ymd</span>(<span class="st">&#39;2016-04-29&#39;</span>) ) <span class="op">%/%</span><span class="st"> </span><span class="kw">months</span>(<span class="dv">1</span>) <span class="co"># end day no. &lt; begining day no.</span>
<span class="kw">interval</span>( <span class="kw">ymd</span>(<span class="st">&#39;2016-03-30&#39;</span>), <span class="kw">ymd</span>(<span class="st">&#39;2016-04-30&#39;</span>) ) <span class="op">%/%</span><span class="st"> </span><span class="kw">months</span>(<span class="dv">1</span>) <span class="co"># end day no. == beginning day no.</span>
<span class="kw">interval</span>( <span class="kw">ymd</span>(<span class="st">&#39;2016-03-31&#39;</span>), <span class="kw">ymd</span>(<span class="st">&#39;2016-04-30&#39;</span>) ) <span class="op">%/%</span><span class="st"> </span><span class="kw">months</span>(<span class="dv">1</span>) <span class="co"># end of month to end of month</span></code></pre></div>
<pre><code>## [1] 0
## [1] 1
## [1] 1</code></pre>
<p>Apply this to data frame / vector.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my.df<span class="op">$</span>date_first
my.df<span class="op">$</span>date_last
<span class="kw">interval</span>( my.df<span class="op">$</span>date_first, my.df<span class="op">$</span>date_last ) <span class="op">%/%</span><span class="st"> </span><span class="kw">months</span>(<span class="dv">1</span>) </code></pre></div>
<pre><code>## [1] &quot;2013-07-31&quot; &quot;2013-08-31&quot; &quot;2014-12-31&quot; &quot;2015-02-28&quot; &quot;2012-06-15&quot;
## [6] &quot;2013-04-28&quot; &quot;2014-03-01&quot;
## [1] &quot;2016-02-29&quot; &quot;2017-04-01&quot; &quot;2015-10-31&quot; &quot;2016-11-01&quot; &quot;2016-09-30&quot;
## [6] &quot;2015-11-27&quot; &quot;2017-03-31&quot;
## [1] 31 43 10 20 51 30 36</code></pre>
</div>
<div id="years-difference" class="section level4">
<h4><span class="header-section-number">5.7.2.3</span> Years Difference</h4>
<p>Use <strong><code>lubridate::year</code> function to find the year (integer) of a given date</strong>. Difference of the year() results from the birthdate and current date is the <strong>Age</strong>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">year</span>(<span class="kw">now</span>()) <span class="op">-</span><span class="st"> </span><span class="kw">year</span>(my.df<span class="op">$</span>date_birth)</code></pre></div>
<pre><code>## [1] 44 37 39 20 35 44 32</code></pre>
<p>However in <strong>insurance</strong> industry, only a <strong>full year</strong> is considred for age.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">interval</span>( <span class="kw">ymd</span>(<span class="st">&#39;2016-02-29&#39;</span>), <span class="kw">ymd</span>(<span class="st">&#39;2017-02-27&#39;</span>) ) <span class="op">%/%</span><span class="st"> </span><span class="kw">years</span>(<span class="dv">1</span>) <span class="co"># a day short for a year</span>
<span class="kw">interval</span>( <span class="kw">ymd</span>(<span class="st">&#39;2016-02-29&#39;</span>), <span class="kw">ymd</span>(<span class="st">&#39;2017-02-28&#39;</span>) ) <span class="op">%/%</span><span class="st"> </span><span class="kw">years</span>(<span class="dv">1</span>) <span class="co"># EoM to EoM</span></code></pre></div>
<pre><code>## [1] 0
## [1] 1</code></pre>
<p>Apply this to data frame / vector.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my.df<span class="op">$</span>date_first
my.df<span class="op">$</span>date_last
<span class="kw">interval</span>( my.df<span class="op">$</span>date_first, my.df<span class="op">$</span>date_last ) <span class="op">%/%</span><span class="st"> </span><span class="kw">years</span>(<span class="dv">1</span>) </code></pre></div>
<pre><code>## [1] &quot;2013-07-31&quot; &quot;2013-08-31&quot; &quot;2014-12-31&quot; &quot;2015-02-28&quot; &quot;2012-06-15&quot;
## [6] &quot;2013-04-28&quot; &quot;2014-03-01&quot;
## [1] &quot;2016-02-29&quot; &quot;2017-04-01&quot; &quot;2015-10-31&quot; &quot;2016-11-01&quot; &quot;2016-09-30&quot;
## [6] &quot;2015-11-27&quot; &quot;2017-03-31&quot;
## [1] 2 3 0 1 4 2 3</code></pre>
</div>
</div>
<div id="daysmonhtsyears-later" class="section level3">
<h3><span class="header-section-number">5.7.3</span> Days/Monhts/Years Later</h3>
<p><strong>Adding days</strong> is as simple as <strong>add number of days</strong> to the date variables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my.df<span class="op">$</span>date_last</code></pre></div>
<pre><code>## [1] &quot;2016-02-29&quot; &quot;2017-04-01&quot; &quot;2015-10-31&quot; &quot;2016-11-01&quot; &quot;2016-09-30&quot;
## [6] &quot;2015-11-27&quot; &quot;2017-03-31&quot;</code></pre>
<p>Adding month(s) is tricky on the <strong>last day of month</strong>. Use <strong><code>lubridate operator</code> for correct solution</strong>, because it takes cares of last day of month including February of leap years.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my.df<span class="op">$</span>date_last
my.df<span class="op">$</span>date_last   <span class="op">+</span><span class="st">  </span><span class="kw">months</span>(<span class="dv">1</span>)   <span class="co"># 1 month later, bad solution, can result in &lt;NA&gt;</span>
my.df<span class="op">$</span>date_last <span class="op">%m+%</span><span class="st"> </span><span class="kw">months</span>(<span class="dv">1</span>)   <span class="co"># 1 month later, good solution</span></code></pre></div>
<pre><code>## [1] &quot;2016-02-29&quot; &quot;2017-04-01&quot; &quot;2015-10-31&quot; &quot;2016-11-01&quot; &quot;2016-09-30&quot;
## [6] &quot;2015-11-27&quot; &quot;2017-03-31&quot;
## [1] &quot;2016-03-29&quot; &quot;2017-05-01&quot; NA           &quot;2016-12-01&quot; &quot;2016-10-30&quot;
## [6] &quot;2015-12-27&quot; NA          
## [1] &quot;2016-03-29&quot; &quot;2017-05-01&quot; &quot;2015-11-30&quot; &quot;2016-12-01&quot; &quot;2016-10-30&quot;
## [6] &quot;2015-12-27&quot; &quot;2017-04-30&quot;</code></pre>
<p>Adding year(s) is similar to adding month(s) above.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my.df<span class="op">$</span>date_last
my.df<span class="op">$</span>date_last   <span class="op">+</span><span class="st">  </span><span class="kw">years</span>(<span class="dv">1</span>)   <span class="co"># 1 month later, bad solution</span>
my.df<span class="op">$</span>date_last <span class="op">%m+%</span><span class="st"> </span><span class="kw">years</span>(<span class="dv">1</span>)   <span class="co"># 1 month later, good solution</span></code></pre></div>
<pre><code>## [1] &quot;2016-02-29&quot; &quot;2017-04-01&quot; &quot;2015-10-31&quot; &quot;2016-11-01&quot; &quot;2016-09-30&quot;
## [6] &quot;2015-11-27&quot; &quot;2017-03-31&quot;
## [1] NA           &quot;2018-04-01&quot; &quot;2016-10-31&quot; &quot;2017-11-01&quot; &quot;2017-09-30&quot;
## [6] &quot;2016-11-27&quot; &quot;2018-03-31&quot;
## [1] &quot;2017-02-28&quot; &quot;2018-04-01&quot; &quot;2016-10-31&quot; &quot;2017-11-01&quot; &quot;2017-09-30&quot;
## [6] &quot;2016-11-27&quot; &quot;2018-03-31&quot;</code></pre>
</div>
<div id="last-day-of-month" class="section level3">
<h3><span class="header-section-number">5.7.4</span> Last Day of Month</h3>
<p><strong><code>libridate::ceiling_date</code></strong> rounds up the date to the nearest unit.</p>
<p>When rounding up a date to the **next nearest month*, it results the <strong>first day of next month</strong>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my.df<span class="op">$</span>date_last
<span class="kw">ceiling_date</span>(my.df<span class="op">$</span>date_last, <span class="st">&quot;month&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;2016-02-29&quot; &quot;2017-04-01&quot; &quot;2015-10-31&quot; &quot;2016-11-01&quot; &quot;2016-09-30&quot;
## [6] &quot;2015-11-27&quot; &quot;2017-03-31&quot;
## [1] &quot;2016-03-01&quot; &quot;2017-05-01&quot; &quot;2015-11-01&quot; &quot;2016-12-01&quot; &quot;2016-10-01&quot;
## [6] &quot;2015-12-01&quot; &quot;2017-04-01&quot;</code></pre>
<p><strong>Substracting this date by one</strong> will return last day of the month.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ceiling_date</span>(my.df<span class="op">$</span>date_last, <span class="st">&quot;month&quot;</span>) <span class="op">-</span><span class="st"> </span><span class="kw">days</span>(<span class="dv">1</span>)</code></pre></div>
<pre><code>## [1] &quot;2016-02-29&quot; &quot;2017-04-30&quot; &quot;2015-10-31&quot; &quot;2016-11-30&quot; &quot;2016-09-30&quot;
## [6] &quot;2015-11-30&quot; &quot;2017-03-31&quot;</code></pre>
</div>
</div>
<div id="number-manipulation" class="section level2">
<h2><span class="header-section-number">5.8</span> Number Manipulation</h2>
<div id="sample-data-2" class="section level3">
<h3><span class="header-section-number">5.8.1</span> Sample Data</h3>
<p>Scaling section will use sample data generated as below:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1234</span>)
my.df =<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">id =</span> <span class="kw">paste</span>(<span class="st">&#39;ID_&#39;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>),
  <span class="dt">value1 =</span> <span class="kw">sample</span>(<span class="dv">50</span><span class="op">:</span><span class="dv">100</span>, <span class="dv">5</span>),
  <span class="dt">value2 =</span> <span class="kw">sample</span>(<span class="dv">10</span><span class="op">:</span><span class="dv">50</span>, <span class="dv">5</span>),
  <span class="dt">stringsAsFactors =</span> F
)
my.df</code></pre></div>
<pre><code>##     id value1 value2
## 1 ID_1     55     36
## 2 ID_2     81     10
## 3 ID_3     79     19
## 4 ID_4     98     35
## 5 ID_5     90     29</code></pre>
</div>
<div id="z-score-scaling" class="section level3">
<h3><span class="header-section-number">5.8.2</span> Z-Score Scaling</h3>
<p><code>scale</code> apply transformation <strong>column-wise</strong>, for columns within matrix or dataframe<br />
<code>scale</code> return a <strong>matrix</strong></p>
<blockquote>
<p><code>scale (x, center=T, scale=T)</code> # default S-Score transformation<br />
<span class="math inline">\(\quad\)</span> <code>center = T (default) means value minus with mean</code><br />
<span class="math inline">\(\quad\)</span> <code>scale  = T (default) means value divide by sd</code><br />
<span class="math inline">\(\quad\)</span> <span class="math inline">\(\quad\)</span> <code>output scaled:center --&gt; mean</code><br />
<span class="math inline">\(\quad\)</span> <span class="math inline">\(\quad\)</span> <code>output scaled:scale  --&gt; sd</code></p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">scale</span>( my.df[,<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>] )</code></pre></div>
<pre><code>##           value1     value2
## [1,] -1.58066858  0.9170971
## [2,]  0.02469795 -1.4206014
## [3,] -0.09879179 -0.6113981
## [4,]  1.07436067  0.8271856
## [5,]  0.58040174  0.2877167
## attr(,&quot;scaled:center&quot;)
## value1 value2 
##   80.6   25.8 
## attr(,&quot;scaled:scale&quot;)
##   value1   value2 
## 16.19568 11.12205</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">scale</span>( my.df[,<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>], <span class="dt">scale=</span>F )</code></pre></div>
<pre><code>##      value1 value2
## [1,]  -25.6   10.2
## [2,]    0.4  -15.8
## [3,]   -1.6   -6.8
## [4,]   17.4    9.2
## [5,]    9.4    3.2
## attr(,&quot;scaled:center&quot;)
## value1 value2 
##   80.6   25.8</code></pre>
</div>
<div id="min-max-scaling" class="section level3">
<h3><span class="header-section-number">5.8.3</span> Min Max Scaling</h3>
<p>Min-Max scaling will transform all numbers between 0 and 1.<br />
Easiest way to perform this transformation is to write a function then <code>apply</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">min_max =<span class="st"> </span><span class="cf">function</span>(x){(x<span class="op">-</span><span class="kw">min</span>(x))<span class="op">/</span>(<span class="kw">max</span>(x)<span class="op">-</span><span class="kw">min</span>(x))}
<span class="kw">apply</span>( my.df[,<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>], <span class="dt">MARGIN =</span> <span class="dv">2</span>, <span class="dt">FUN =</span> min_max )  ## 2 means column-wise</code></pre></div>
<pre><code>##         value1    value2
## [1,] 0.0000000 1.0000000
## [2,] 0.6046512 0.0000000
## [3,] 0.5581395 0.3461538
## [4,] 1.0000000 0.9615385
## [5,] 0.8139535 0.7307692</code></pre>
</div>
</div>
<div id="artificial-grouping" class="section level2">
<h2><span class="header-section-number">5.9</span> Artificial Grouping</h2>
<p>Artificial group can be created based on existing numeric data. Such as age_group based on age.</p>
<div id="grouping-with-numeric-breakpoints" class="section level3">
<h3><span class="header-section-number">5.9.1</span> Grouping with Numeric Breakpoints</h3>
<p>Simulate data with x,y,z variables. p simulates priority scoring.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x =<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">10</span>, <span class="dt">mean =</span> <span class="dv">10</span>)
y =<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">10</span>, <span class="dt">mean =</span> <span class="dv">10</span>)
p =<span class="st"> </span>x <span class="op">*</span><span class="st"> </span>y</code></pre></div>
<p>Articial groups is created first by identifying the <strong>number of groups</strong>, generate the break points vector, then <strong>cut</strong> the data base on <strong>break points</strong> and return <strong>factor</strong> as output.</p>
<p>Automatically calculate breakpoints by distributing numbers into the min-max range, in low to high order:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">num_groups =<span class="st"> </span><span class="dv">4</span>
breakPoints =<span class="st"> </span><span class="kw">seq</span>(<span class="kw">min</span>(p), <span class="kw">max</span>(p), <span class="dt">length.out =</span> num_groups <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)
breakPoints</code></pre></div>
<pre><code>## [1]  85.59917  92.47633  99.35348 106.23063 113.10779</code></pre>
<blockquote>
<p><code>cut ( x, breaks, right = TRUE, include.lowest = FALSE)</code><br />
<span class="math inline">\(\quad\)</span> <code>x: numeric vector to be cutted</code><br />
<span class="math inline">\(\quad\)</span> <code>breaks: numeric vector ranging from low to high (in order)</code><br />
<span class="math inline">\(\quad\)</span> <code>include.lowest: FALSE - ommit element matching lowest number in breaks</code><br />
<span class="math inline">\(\quad\)</span> <code>right: TRUE - close end on right;open end on left</code></p>
</blockquote>
<p>The result from <strong>cut</strong> is factor based on order from breakPoints. Therefore, once convert into numeric, the group number is in order of low to high accoriding to breakPoints.</p>
<p>Verify that group (g) has been assigned for each priority (p).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">g =<span class="st"> </span><span class="kw">as.numeric</span>( <span class="kw">cut</span>( p, breakPoints, <span class="dt">include.lowest=</span><span class="ot">TRUE</span>))
<span class="kw">data.frame</span>(p,g)</code></pre></div>
<pre><code>##            p g
## 1  103.90189 3
## 2   89.43620 1
## 3   85.91982 1
## 4   86.45631 1
## 5  113.10779 4
## 6   96.50497 2
## 7   85.59917 1
## 8   88.17396 1
## 9  105.27011 3
## 10 101.99212 3</code></pre>
</div>
<div id="grouping-based-on-custom-criteria" class="section level3">
<h3><span class="header-section-number">5.9.2</span> Grouping based on Custom Criteria</h3>
<p>???</p>
<!--chapter:end:05-pre_process.Rmd-->
</div>
</div>
</div>
<div id="find-order-and-filter-data" class="section level1">
<h1><span class="header-section-number">6</span> Find, Order and Filter Data</h1>
<div id="sample-data-3" class="section level2">
<h2><span class="header-section-number">6.1</span> Sample Data</h2>
<p>Sample data used simulate two categorical-alike feature, and two numeric value feature:</p>
<ul>
<li><strong>dept</strong> is random character between ‘D1’, ‘D2’ and ‘D3’<br />
</li>
<li><strong>grp</strong> is random character with randomly generated ‘G1’, ‘G2’<br />
</li>
<li><strong>value1</strong> represents numeric value, normally distributed at mean 50<br />
</li>
<li><strong>value2</strong> is numeric value, normally distributed at mean 25</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1234</span>)
my.df =<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">dept =</span> <span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dv">10</span>, <span class="dt">replace =</span> T),
  <span class="dt">value1 =</span> <span class="kw">rnorm</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">mean =</span> <span class="dv">50</span>, <span class="dt">sd =</span> <span class="dv">5</span>),
  <span class="dt">stringsAsFactors =</span> F
)

my.vector =<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>,<span class="dv">18</span>, <span class="dt">rep=</span>T)

<span class="kw">head</span>(my.df)
<span class="kw">head</span>(my.vector)</code></pre></div>
<pre><code>##   dept   value1
## 1    1 52.53028
## 2    2 47.12630
## 3    2 47.26684
## 4    2 47.17774
## 5    3 45.54981
## 6    2 47.61404
## [1] 46 27 31 51 19 76</code></pre>
</div>
<div id="finding-data" class="section level2">
<h2><span class="header-section-number">6.2</span> Finding Data</h2>
<p>Find the <strong>first match row number(s)</strong> of specific element(s).</p>
<blockquote>
<p><code>match ( x, y )</code><br />
<span class="math inline">\(\quad\)</span> <code>x = vector of criteria</code><br />
<span class="math inline">\(\quad\)</span> <code>y = vector of elements to find from</code></p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">match</span>(<span class="dv">2</span>, my.df<span class="op">$</span>dept)
<span class="kw">match</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), my.df<span class="op">$</span>dept)</code></pre></div>
<pre><code>## [1] 2
## [1] 1 2</code></pre>
</div>
<div id="ordering-data" class="section level2">
<h2><span class="header-section-number">6.3</span> Ordering Data</h2>
<p>The key <strong>idea</strong> of ordering data is to produce an ‘order’ vector representing the <strong>position</strong> of the element. Then apply the order list to vector/data.frame to produce sorted result.</p>
<p><strong>order</strong> make ordering based on a <strong>numeric vector</strong>. The order result can be applied to vector or data.frame.</p>
<blockquote>
<p><strong><code>order</code></strong> <code>( x,             x must be numeric number</code><br />
<span class="math inline">\(\quad\)</span> <code>decreasing = FALSE,   ascending or descending</code><br />
<span class="math inline">\(\quad\)</span> <code>na.last = TRUE)       if TRUE, NA value are put last</code></p>
</blockquote>
<div id="ordering-vector" class="section level3">
<h3><span class="header-section-number">6.3.1</span> Ordering Vector</h3>
<p>Create the order.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">the.order =<span class="st"> </span><span class="kw">order</span> (my.vector, <span class="dt">decreasing=</span>T) 
the.order</code></pre></div>
<pre><code>##  [1]  9 10  6 17 12 14 11  4 16 18  1 15 13  3  2  8  7  5</code></pre>
<p>Apply the order on variable.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">the.order =<span class="st"> </span><span class="kw">order</span> (my.vector, <span class="dt">decreasing=</span>T) 
the.order
my.vector[ the.order ]</code></pre></div>
<pre><code>##  [1]  9 10  6 17 12 14 11  4 16 18  1 15 13  3  2  8  7  5
##  [1] 100  81  76  68  65  63  56  51  51  49  46  33  32  31  27  26  21
## [18]  19</code></pre>
</div>
<div id="ordering-data-frame" class="section level3">
<h3><span class="header-section-number">6.3.2</span> Ordering Data Frame</h3>
<p><strong>One Level Ordering</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">the.order =<span class="st"> </span><span class="kw">order</span>(my.df<span class="op">$</span>dept, <span class="dt">decreasing=</span><span class="ot">TRUE</span>)
my.df[the.order,]</code></pre></div>
<pre><code>##    dept   value1
## 5     3 45.54981
## 2     2 47.12630
## 3     2 47.26684
## 4     2 47.17774
## 6     2 47.61404
## 9     2 50.32229
## 10    2 54.79747
## 1     1 52.53028
## 7     1 45.00807
## 8     1 46.11873</code></pre>
<p><strong>Multi Level Ordering</strong></p>
<p>Specify more than one column for multi-level ordering.However, all levels follow the same decreasing (ascending/desceding).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">attach</span>(my.df)
the.order =<span class="st"> </span><span class="kw">order</span>(dept, value1, <span class="dt">decreasing=</span><span class="ot">TRUE</span>)
my.df[the.order,]
<span class="kw">detach</span>(my.df)</code></pre></div>
<pre><code>##    dept   value1
## 5     3 45.54981
## 10    2 54.79747
## 9     2 50.32229
## 6     2 47.61404
## 3     2 47.26684
## 4     2 47.17774
## 2     2 47.12630
## 1     1 52.53028
## 8     1 46.11873
## 7     1 45.00807</code></pre>
</div>
</div>
<div id="filtering-data" class="section level2">
<h2><span class="header-section-number">6.4</span> Filtering Data</h2>
<p>There are two methods of filtering data, using logical vector or subset() function.</p>
<p>With both methods, <strong>row.names are retained</strong> in the output vector/dataframe.</p>
<ul>
<li><strong>subset()</strong> is a general function that can be used to filter vector, matrix and data.frame<br />
</li>
<li>logical vector method - derive a conditional criteria that produce a logical vector, then apply to element selection</li>
<li><code>which()</code> takes logical vector and return actual indices of TRUE elements. The output from which can be use for subsetting</li>
</ul>
<div id="subseting-vector" class="section level3">
<h3><span class="header-section-number">6.4.1</span> Subseting Vector</h3>
<p>All methods show in below section has similar results.</p>
<div id="using-subset" class="section level4">
<h4><span class="header-section-number">6.4.1.1</span> Using subset()</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my.vector =<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">100</span>
<span class="kw">subset</span>( my.vector, my.vector<span class="op">&gt;</span><span class="dv">10</span> <span class="op">&amp;</span><span class="st"> </span>my.vector<span class="op">&lt;</span><span class="dv">20</span>)</code></pre></div>
<pre><code>## [1] 11 12 13 14 15 16 17 18 19</code></pre>
</div>
<div id="using-logical-vector" class="section level4">
<h4><span class="header-section-number">6.4.1.2</span> Using logical vector</h4>
<p>Essentially, the below has similar results as using subset()..</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my.vector =<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">100</span>
lvector =<span class="st"> </span>my.vector<span class="op">&gt;</span><span class="dv">10</span> <span class="op">&amp;</span><span class="st"> </span>my.vector<span class="op">&lt;</span><span class="dv">20</span>
my.vector[ lvector ]</code></pre></div>
<pre><code>## [1] 11 12 13 14 15 16 17 18 19</code></pre>
</div>
<div id="using-row-numbers-vector" class="section level4">
<h4><span class="header-section-number">6.4.1.3</span> Using row numbers vector</h4>
<p><strong><code>which</code></strong> returns the <strong>true indices of a logical object</strong>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my.vector =<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">100</span>
<span class="kw">which</span> (my.vector<span class="op">&gt;</span><span class="dv">10</span> <span class="op">&amp;</span><span class="st"> </span>my.vector<span class="op">&lt;</span><span class="dv">20</span>)
my.vector[<span class="kw">which</span> (my.vector<span class="op">&gt;</span><span class="dv">10</span> <span class="op">&amp;</span><span class="st"> </span>my.vector<span class="op">&gt;</span><span class="dv">10</span><span class="op">&amp;</span><span class="st"> </span>my.vector<span class="op">&lt;</span><span class="dv">20</span>)]</code></pre></div>
<pre><code>## [1] 11 12 13 14 15 16 17 18 19
## [1] 11 12 13 14 15 16 17 18 19</code></pre>
<p><strong>‘which’</strong> has a useful form to return row number with max or min value</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my.vector =<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">100</span>
<span class="kw">which.min</span> (my.vector)
my.vector[<span class="kw">which.min</span>(my.vector)]

<span class="kw">which.max</span> (my.vector)
my.vector[<span class="kw">which.max</span>(my.vector)]</code></pre></div>
<pre><code>## [1] 1
## [1] 1
## [1] 100
## [1] 100</code></pre>
</div>
</div>
<div id="subseting-data-frame" class="section level3">
<h3><span class="header-section-number">6.4.2</span> Subseting Data Frame</h3>
<p>All methods show in below section has similar results.</p>
<div id="using-subset-1" class="section level4">
<h4><span class="header-section-number">6.4.2.1</span> Using subset()</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my.df =<span class="st"> </span><span class="kw">data.frame</span>( 
  <span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">100</span>,
  <span class="dt">y =</span> <span class="dv">300</span><span class="op">:</span><span class="dv">201</span>
)
<span class="kw">subset</span>( my.df, x<span class="op">&lt;</span><span class="dv">10</span> <span class="op">&amp;</span><span class="st"> </span>y<span class="op">&lt;</span><span class="dv">300</span> )</code></pre></div>
<pre><code>##   x   y
## 2 2 299
## 3 3 298
## 4 4 297
## 5 5 296
## 6 6 295
## 7 7 294
## 8 8 293
## 9 9 292</code></pre>
</div>
<div id="using-logical-vector-1" class="section level4">
<h4><span class="header-section-number">6.4.2.2</span> Using logical vector</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lvector =<span class="st"> </span>my.df<span class="op">$</span>x<span class="op">&lt;</span><span class="dv">10</span> <span class="op">&amp;</span><span class="st"> </span>my.df<span class="op">$</span>y<span class="op">&lt;</span><span class="dv">300</span>
my.df [ lvector, ]</code></pre></div>
<pre><code>##   x   y
## 2 2 299
## 3 3 298
## 4 4 297
## 5 5 296
## 6 6 295
## 7 7 294
## 8 8 293
## 9 9 292</code></pre>
</div>
<div id="using-row-numbers-vector-1" class="section level4">
<h4><span class="header-section-number">6.4.2.3</span> Using row numbers vector</h4>
<p><strong><code>which</code></strong> returns the <strong>true indices of a logical object</strong>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">z =<span class="st"> </span><span class="kw">which</span> (my.df<span class="op">$</span>x<span class="op">&lt;</span><span class="dv">10</span> <span class="op">&amp;</span><span class="st"> </span>my.df<span class="op">$</span>y<span class="op">&lt;</span><span class="dv">300</span>)
my.df [ z, ]</code></pre></div>
<pre><code>##   x   y
## 2 2 299
## 3 3 298
## 4 4 297
## 5 5 296
## 6 6 295
## 7 7 294
## 8 8 293
## 9 9 292</code></pre>
<!--chapter:end:06-sort_filter.Rmd-->
</div>
</div>
</div>
</div>
<div id="graphic-visualization" class="section level1">
<h1><span class="header-section-number">7</span> Graphic Visualization</h1>
<p>This chapter compares various method to plotting using base-R and ggplot.</p>
<div id="library-used" class="section level2">
<h2><span class="header-section-number">7.1</span> Library used</h2>
<ul>
<li>Loading necessary library as below:</li>
<li>Base R library already included functions: ** hist, plot, barplot, boxplot**</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)    ## ggplot, qplot</code></pre></div>
</div>
<div id="sample-data-4" class="section level2">
<h2><span class="header-section-number">7.2</span> Sample Data</h2>
<p>This chapter uses the sample data generate with below code. The idea is to simulate two categorical-alike feature, and two numeric value feature:</p>
<ul>
<li><strong>dept</strong> is random character between ‘D1’, ‘D2’, ‘D3’, ‘D4’ and ‘D5’<br />
</li>
<li><strong>grp</strong> is random character with randomly generated ‘G1’, ‘G2’<br />
</li>
<li><strong>value1</strong> represents numeric value, normally distributed at mean 50<br />
</li>
<li><strong>value2</strong> is numeric value, normally distributed at mean 25</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1234</span>)
my.df =<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">dept =</span> <span class="kw">paste</span>(<span class="st">&#39;D&#39;</span>,<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">100</span>, <span class="dt">replace =</span> T),<span class="dt">sep=</span><span class="st">&#39;&#39;</span>),
  <span class="dt">grp  =</span> <span class="kw">paste</span>(<span class="st">&#39;G&#39;</span>,<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dv">100</span>, <span class="dt">replace =</span> T),<span class="dt">sep=</span><span class="st">&#39;&#39;</span>),
  <span class="dt">value1 =</span> <span class="kw">rnorm</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>, <span class="dt">mean =</span> <span class="dv">50</span>, <span class="dt">sd =</span> <span class="dv">5</span>),
  <span class="dt">value2 =</span> <span class="kw">rnorm</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>, <span class="dt">mean =</span> <span class="dv">20</span>, <span class="dt">sd =</span> <span class="dv">3</span>),
  <span class="dt">stringsAsFactors =</span> F
)
<span class="kw">head</span>(my.df)</code></pre></div>
<pre><code>##   dept grp   value1   value2
## 1   D1  G1 52.07262 21.45568
## 2   D4  G2 47.62641 22.09031
## 3   D4  G1 50.32997 20.55654
## 4   D4  G1 47.48761 22.10220
## 5   D5  G1 45.87001 20.93504
## 6   D4  G1 50.83495 22.28139</code></pre>
</div>
<div id="histogram" class="section level2">
<h2><span class="header-section-number">7.3</span> Histogram</h2>
<div id="single-dimension-data-1" class="section level3">
<h3><span class="header-section-number">7.3.1</span> Single Dimension Data</h3>
<ul>
<li>Require <strong>x</strong> as numerical data</li>
<li>In <strong>hist</strong>, <strong>binwidth</strong> setting is not available, only breaks (number of bins) can be specified</li>
<li>Default hist/ggplot/qplot number of bins is <strong>30</strong></li>
<li>In <strong>qplot</strong>, single x numerical variable <strong>default to histogram</strong></li>
<li>You can’t specify both <strong>bins/breaks</strong> and <strong>bindwidth</strong> together, as it implies each other</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))
<span class="kw">hist</span>  (my.df<span class="op">$</span>value1) <span class="co"># default breaks = 30</span>
<span class="kw">hist</span>  (my.df<span class="op">$</span>value1, <span class="dt">breaks=</span><span class="dv">3</span>)</code></pre></div>
<p><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-110-1.png" width="864" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">qplot</span> (<span class="dt">data =</span> my.df, <span class="dt">x=</span>value1)
<span class="kw">qplot</span> (<span class="dt">data =</span> my.df, <span class="dt">x=</span>value1, <span class="dt">geom=</span><span class="st">&#39;histogram&#39;</span>)
<span class="kw">qplot</span> (<span class="dt">data =</span> my.df, <span class="dt">x=</span>value1, <span class="dt">bins=</span><span class="dv">15</span>)
<span class="kw">ggplot</span>(<span class="dt">data =</span> my.df, <span class="kw">aes</span>(<span class="dt">x=</span>value1)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>() <span class="co"># default bins = 30</span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> my.df, <span class="kw">aes</span>(<span class="dt">x=</span>value1)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">15</span>)
<span class="kw">ggplot</span>(<span class="dt">data =</span> my.df, <span class="kw">aes</span>(<span class="dt">x=</span>value1)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">10</span>)</code></pre></div>
<p><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-111-1.png" width="256.6656" /><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-111-2.png" width="256.6656" /><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-111-3.png" width="256.6656" /><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-111-4.png" width="256.6656" /><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-111-5.png" width="256.6656" /><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-111-6.png" width="256.6656" /></p>
</div>
<div id="two-dimension-data-1" class="section level3">
<h3><span class="header-section-number">7.3.2</span> Two Dimension Data</h3>
<ul>
<li>x = numerical data<br />
</li>
<li>fill = categorica-alike data</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">qplot</span> (<span class="dt">data =</span> my.df, <span class="dt">x=</span>value1,  <span class="dt">fill=</span>grp, <span class="dt">geom=</span><span class="st">&#39;histogram&#39;</span>)
<span class="kw">ggplot</span>(<span class="dt">data =</span> my.df, <span class="kw">aes</span>(<span class="dt">x=</span>value1, <span class="dt">fill=</span>grp)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>()</code></pre></div>
<p><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-112-1.png" width="384" /><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-112-2.png" width="384" /></p>
</div>
</div>
<div id="scatter-plot" class="section level2">
<h2><span class="header-section-number">7.4</span> Scatter Plot</h2>
<div id="two-dimension-data-2" class="section level3">
<h3><span class="header-section-number">7.4.1</span> Two Dimension Data</h3>
<ul>
<li>Use scatter plot to represent <strong>correlation</strong> between two numeric variables</li>
<li>x = number, y = number<br />
</li>
<li>qplot default to <strong>geom_point</strong> when two numerical value is supplied for x and y</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>  (my.df<span class="op">$</span>value1, my.df<span class="op">$</span>value2)</code></pre></div>
<p><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-113-1.png" width="768" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">qplot</span> (<span class="dt">data =</span> my.df, <span class="dt">x =</span> value1, <span class="dt">y =</span> value2)
<span class="kw">qplot</span> (<span class="dt">data =</span> my.df, <span class="dt">x =</span> value1, <span class="dt">y =</span> value2, <span class="dt">geom=</span><span class="st">&#39;point&#39;</span>)
<span class="kw">ggplot</span>(<span class="dt">data =</span> my.df, <span class="kw">aes</span>(<span class="dt">x=</span>value1, <span class="dt">y=</span>value2)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-114-1.png" width="256.6656" /><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-114-2.png" width="256.6656" /><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-114-3.png" width="256.6656" /></p>
</div>
<div id="two-one-dimension-data" class="section level3">
<h3><span class="header-section-number">7.4.2</span> Two + One Dimension Data</h3>
<ul>
<li>Base-R does not support extra dimension visualization</li>
<li>In <strong>qplot/ggplot</strong>, the third dimension of data can be represented by assigning <strong>color</strong> parameter to the third variable</li>
<li>Note that <strong>fill has not effect</strong> on scatter plot. <strong>fill</strong> should only be used for bar like chart eg. <strong>geom_hist</strong> or <strong>gem_bar</strong></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>  (my.df<span class="op">$</span>value1, my.df<span class="op">$</span>value2)</code></pre></div>
<p><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-115-1.png" width="768" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">qplot</span> (<span class="dt">data =</span> my.df, <span class="dt">x =</span> value1, <span class="dt">y =</span> value2, <span class="dt">color =</span> grp, <span class="dt">geom=</span><span class="st">&#39;point&#39;</span>)
<span class="kw">ggplot</span>(<span class="dt">data =</span> my.df, <span class="kw">aes</span>(<span class="dt">x=</span>value1, <span class="dt">y=</span>value2, <span class="dt">color =</span> grp)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()
<span class="kw">ggplot</span>(<span class="dt">data =</span> my.df, <span class="kw">aes</span>(<span class="dt">x=</span>value1, <span class="dt">y=</span>value2, <span class="dt">fill =</span> grp)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-116-1.png" width="256.6656" /><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-116-2.png" width="256.6656" /><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-116-3.png" width="256.6656" /></p>
</div>
</div>
<div id="bar-chart" class="section level2">
<h2><span class="header-section-number">7.5</span> Bar Chart</h2>
<div id="single-dimension-data-2" class="section level3">
<h3><span class="header-section-number">7.5.1</span> Single Dimension Data</h3>
<ul>
<li>Use bar to repfresent <strong>frequency</strong> chart</li>
<li><strong>plot</strong> requre a factor to plot frequency chart</li>
<li><strong>barplot</strong> require conversion of vector into <strong>table</strong> for plotting</li>
<li><strong>qplot</strong> default to <strong>geom_bar</strong> when <strong>single categorical-alike</strong> feature is used</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))
<span class="kw">plot</span>(<span class="kw">as.factor</span>(my.df<span class="op">$</span>dept))
<span class="kw">barplot</span>(<span class="kw">table</span>(my.df<span class="op">$</span>dept))</code></pre></div>
<p><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-117-1.png" width="768" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">qplot</span> (<span class="dt">data =</span> my.df, <span class="dt">x=</span>dept)
<span class="kw">qplot</span> (<span class="dt">data =</span> my.df, <span class="dt">x=</span>dept, <span class="dt">geom=</span><span class="st">&#39;bar&#39;</span>)
<span class="kw">ggplot</span>(<span class="dt">data =</span> my.df, <span class="kw">aes</span>(<span class="dt">x=</span>dept)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>()</code></pre></div>
<p><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-118-1.png" width="256.6656" /><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-118-2.png" width="256.6656" /><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-118-3.png" width="256.6656" /></p>
</div>
<div id="two-one-dimension-data-1" class="section level3">
<h3><span class="header-section-number">7.5.2</span> Two + One Dimension Data</h3>
<ul>
<li>Use <strong>fill</strong> to introduce extra variable visualizion in filling the bar</li>
<li>Use <strong>color</strong> to have the extra variable represented with <strong>border</strong> color</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">qplot</span> (<span class="dt">data =</span> my.df, dept, <span class="dt">fill =</span> grp)
<span class="kw">qplot</span> (<span class="dt">data =</span> my.df, <span class="dt">x =</span> dept, <span class="dt">fill =</span> grp, <span class="dt">geom=</span><span class="st">&#39;bar&#39;</span>)
<span class="kw">ggplot</span>(<span class="dt">data =</span> my.df, <span class="kw">aes</span>(<span class="dt">x =</span> dept, <span class="dt">fill =</span> grp)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>()
<span class="kw">ggplot</span>(<span class="dt">data =</span> my.df, <span class="kw">aes</span>(<span class="dt">x =</span> dept, <span class="dt">color=</span> grp)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>()</code></pre></div>
<p><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-119-1.png" width="256.6656" /><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-119-2.png" width="256.6656" /><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-119-3.png" width="256.6656" /><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-119-4.png" width="256.6656" /></p>
</div>
<div id="reordering" class="section level3">
<h3><span class="header-section-number">7.5.3</span> Reordering</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">qplot</span> (<span class="dt">data =</span> my.df, <span class="dt">x=</span>dept)
<span class="kw">qplot</span> (<span class="dt">data =</span> my.df, <span class="dt">x=</span>dept, <span class="dt">geom=</span><span class="st">&#39;bar&#39;</span>)
<span class="kw">ggplot</span>(<span class="dt">data =</span> my.df, <span class="kw">aes</span>(<span class="dt">x=</span>dept)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>()</code></pre></div>
<p><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-121-1.png" width="256.6656" /><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-121-2.png" width="256.6656" /><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-121-3.png" width="256.6656" /></p>
</div>
<div id="positioning" class="section level3">
<h3><span class="header-section-number">7.5.4</span> Positioning</h3>
<ul>
<li><strong>qplot does not</strong> support positioning</li>
<li>For <strong>ggplot/qplot</strong>, default position is <strong>stack</strong></li>
<li>position = ‘dodge’ similar to <strong>position = position_dodge()</strong>, however the later is more flexible with ability to adjust overlapping level between sub-bar (default is 0.9)</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">g =<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> my.df, <span class="kw">aes</span>(<span class="dt">x=</span>dept, <span class="dt">fill=</span>grp)) 
g <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">position=</span><span class="st">&#39;stack&#39;</span>) <span class="co"># default position</span>
g <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">position=</span><span class="st">&#39;dodge&#39;</span>)
g <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">position=</span><span class="kw">position_dodge</span>()) <span class="co"># default 0.9</span>
g <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">position=</span><span class="kw">position_dodge</span>(<span class="fl">0.5</span>))
g <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">position=</span><span class="kw">position_dodge</span>(<span class="fl">1.0</span>))</code></pre></div>
<p><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-122-1.png" width="256.6656" /><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-122-2.png" width="256.6656" /><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-122-3.png" width="256.6656" /><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-122-4.png" width="256.6656" /><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-122-5.png" width="256.6656" /></p>
</div>
<div id="in-bar-text-labeling" class="section level3">
<h3><span class="header-section-number">7.5.5</span> In-Bar Text Labeling</h3>
</div>
</div>
<div id="box-plot" class="section level2">
<h2><span class="header-section-number">7.6</span> Box Plot</h2>
<div id="one-dimension-data" class="section level3">
<h3><span class="header-section-number">7.6.1</span> One Dimension Data</h3>
<ul>
<li>In boxplot(), only single variable need to be supplied</li>
<li>In <strong>ggplot/qplot</strong>, variable x and y is required. Variable y is the actual value, variable x is the group variable. Case of one dimension, use x=’’ when no grouping is desired</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">boxplot</span>(my.df<span class="op">$</span>value1)
<span class="kw">qplot</span>  (<span class="dt">data =</span> my.df, <span class="dt">x =</span> <span class="st">&#39;&#39;</span> ,  <span class="dt">y =</span> value1, <span class="dt">geom=</span><span class="st">&#39;boxplot&#39;</span>)
<span class="kw">ggplot</span> (<span class="dt">data =</span> my.df, <span class="kw">aes</span>( <span class="dt">x=</span> <span class="st">&#39;&#39;</span>, <span class="dt">y=</span>value1 )) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()</code></pre></div>
<p><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-123-1.png" width="256.6656" /><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-123-2.png" width="256.6656" /><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-123-3.png" width="256.6656" /></p>
</div>
<div id="two-dimension-data-3" class="section level3">
<h3><span class="header-section-number">7.6.2</span> Two Dimension Data</h3>
<ul>
<li>In <strong>boxplot</strong>, use ~ to specify <strong>y~x</strong>, where <strong>x</strong> is grouping variable</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">boxplot</span>(<span class="dt">data =</span> my.df, value1<span class="op">~</span>grp)
<span class="kw">qplot</span>  (<span class="dt">data =</span> my.df, <span class="dt">x =</span> grp , <span class="dt">y =</span> value1, <span class="dt">geom=</span><span class="st">&#39;boxplot&#39;</span>)
<span class="kw">ggplot</span> (<span class="dt">data =</span> my.df, <span class="kw">aes</span>(<span class="dt">x=</span>grp, <span class="dt">y=</span>value1)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()</code></pre></div>
<p><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-124-1.png" width="256.6656" /><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-124-2.png" width="256.6656" /><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-124-3.png" width="256.6656" /></p>
</div>
<div id="two-one-dimension-data-2" class="section level3">
<h3><span class="header-section-number">7.6.3</span> Two + One Dimension Data</h3>
<ul>
<li>Extra dimension can be included in for <strong>x-axis</strong></li>
<li>In <strong>boxplot</strong>, use <strong>+</strong> to specify extra dimension</li>
<li>In <strong>qplot/ggplot</strong>, use <strong>interaction</strong> to specify extra dimension</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">boxplot</span>(<span class="dt">data =</span> my.df, value1<span class="op">~</span>grp<span class="op">+</span>dept)</code></pre></div>
<p><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-125-1.png" width="772.8" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">qplot</span>  (<span class="dt">data =</span> my.df, <span class="dt">x=</span><span class="kw">interaction</span>(grp,dept) , <span class="dt">y=</span>value1, <span class="dt">geom=</span><span class="st">&#39;boxplot&#39;</span>)
<span class="kw">ggplot</span> (<span class="dt">data =</span> my.df, <span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">interaction</span>(grp,dept) , <span class="dt">y=</span>value1)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()</code></pre></div>
<p><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-126-1.png" width="772.8" /><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-126-2.png" width="772.8" /></p>
</div>
</div>
<div id="pie-chart" class="section level2">
<h2><span class="header-section-number">7.7</span> Pie Chart</h2>
<!--chapter:end:07-visualization.Rmd-->
</div>
</div>
<div id="statistics" class="section level1">
<h1><span class="header-section-number">8</span> Statistics</h1>
<div id="sample-data-5" class="section level2">
<h2><span class="header-section-number">8.1</span> Sample Data</h2>
<p>This chapter uses the sample data generate with below code. The idea is to simulate two categorical-alike feature, and two numeric value feature:</p>
<ul>
<li><strong>dept</strong> is random character between ‘D1’, ‘D2’, ‘D3’, ‘D4’ and ‘D5’<br />
</li>
<li><strong>grp</strong> is random character with randomly generated ‘G1’, ‘G2’<br />
</li>
<li><strong>value1</strong> represents numeric value, normally distributed at mean 50<br />
</li>
<li><strong>value2</strong> is numeric value, normally distributed at mean 25</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">is.matrix</span>(state.x77)
<span class="kw">str</span>(state.x77)
<span class="kw">dimnames</span>(state.x77)[<span class="dv">1</span>]
<span class="kw">dimnames</span>(state.x77)[<span class="dv">2</span>]
<span class="kw">head</span>(state.x77)</code></pre></div>
<pre><code>## [1] TRUE
##  num [1:50, 1:8] 3615 365 2212 2110 21198 ...
##  - attr(*, &quot;dimnames&quot;)=List of 2
##   ..$ : chr [1:50] &quot;Alabama&quot; &quot;Alaska&quot; &quot;Arizona&quot; &quot;Arkansas&quot; ...
##   ..$ : chr [1:8] &quot;Population&quot; &quot;Income&quot; &quot;Illiteracy&quot; &quot;Life Exp&quot; ...
## [[1]]
##  [1] &quot;Alabama&quot;        &quot;Alaska&quot;         &quot;Arizona&quot;        &quot;Arkansas&quot;      
##  [5] &quot;California&quot;     &quot;Colorado&quot;       &quot;Connecticut&quot;    &quot;Delaware&quot;      
##  [9] &quot;Florida&quot;        &quot;Georgia&quot;        &quot;Hawaii&quot;         &quot;Idaho&quot;         
## [13] &quot;Illinois&quot;       &quot;Indiana&quot;        &quot;Iowa&quot;           &quot;Kansas&quot;        
## [17] &quot;Kentucky&quot;       &quot;Louisiana&quot;      &quot;Maine&quot;          &quot;Maryland&quot;      
## [21] &quot;Massachusetts&quot;  &quot;Michigan&quot;       &quot;Minnesota&quot;      &quot;Mississippi&quot;   
## [25] &quot;Missouri&quot;       &quot;Montana&quot;        &quot;Nebraska&quot;       &quot;Nevada&quot;        
## [29] &quot;New Hampshire&quot;  &quot;New Jersey&quot;     &quot;New Mexico&quot;     &quot;New York&quot;      
## [33] &quot;North Carolina&quot; &quot;North Dakota&quot;   &quot;Ohio&quot;           &quot;Oklahoma&quot;      
## [37] &quot;Oregon&quot;         &quot;Pennsylvania&quot;   &quot;Rhode Island&quot;   &quot;South Carolina&quot;
## [41] &quot;South Dakota&quot;   &quot;Tennessee&quot;      &quot;Texas&quot;          &quot;Utah&quot;          
## [45] &quot;Vermont&quot;        &quot;Virginia&quot;       &quot;Washington&quot;     &quot;West Virginia&quot; 
## [49] &quot;Wisconsin&quot;      &quot;Wyoming&quot;       
## 
## [[1]]
## [1] &quot;Population&quot; &quot;Income&quot;     &quot;Illiteracy&quot; &quot;Life Exp&quot;   &quot;Murder&quot;    
## [6] &quot;HS Grad&quot;    &quot;Frost&quot;      &quot;Area&quot;      
## 
##            Population Income Illiteracy Life Exp Murder HS Grad Frost
## Alabama          3615   3624        2.1    69.05   15.1    41.3    20
## Alaska            365   6315        1.5    69.31   11.3    66.7   152
## Arizona          2212   4530        1.8    70.55    7.8    58.1    15
## Arkansas         2110   3378        1.9    70.66   10.1    39.9    65
## California      21198   5114        1.1    71.71   10.3    62.6    20
## Colorado         2541   4884        0.7    72.06    6.8    63.9   166
##              Area
## Alabama     50708
## Alaska     566432
## Arizona    113417
## Arkansas    51945
## California 156361
## Colorado   103766</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1234</span>)
my.df =<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">dept =</span> <span class="kw">paste</span>(<span class="st">&#39;D&#39;</span>,<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">100</span>, <span class="dt">replace =</span> T),<span class="dt">sep=</span><span class="st">&#39;&#39;</span>),
  <span class="dt">grp  =</span> <span class="kw">paste</span>(<span class="st">&#39;G&#39;</span>,<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dv">100</span>, <span class="dt">replace =</span> T),<span class="dt">sep=</span><span class="st">&#39;&#39;</span>),
  <span class="dt">value1 =</span> <span class="kw">rnorm</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>, <span class="dt">mean =</span> <span class="dv">50</span>, <span class="dt">sd =</span> <span class="dv">5</span>),
  <span class="dt">value2 =</span> <span class="kw">rnorm</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>, <span class="dt">mean =</span> <span class="dv">20</span>, <span class="dt">sd =</span> <span class="dv">3</span>),
  <span class="dt">stringsAsFactors =</span> T
)
<span class="kw">head</span>(my.df)</code></pre></div>
<pre><code>##   dept grp   value1   value2
## 1   D1  G1 52.07262 21.45568
## 2   D4  G2 47.62641 22.09031
## 3   D4  G1 50.32997 20.55654
## 4   D4  G1 47.48761 22.10220
## 5   D5  G1 45.87001 20.93504
## 6   D4  G1 50.83495 22.28139</code></pre>
</div>
<div id="descriptive-summary" class="section level2">
<h2><span class="header-section-number">8.2</span> Descriptive Summary</h2>
<div id="single-vector" class="section level3">
<h3><span class="header-section-number">8.2.1</span> Single Vector</h3>
<ul>
<li><strong>summary</strong> provides min, max, quantiles, mean for numerical vector. But it doesn’t provide standard deviation.</li>
<li>Other functions below take single vector as input, and output a single value</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(my.df<span class="op">$</span>value1)
<span class="kw">mean</span>   (my.df<span class="op">$</span>value1)
<span class="kw">max</span>    (my.df<span class="op">$</span>value1)
<span class="kw">median</span> (my.df<span class="op">$</span>value1)
<span class="kw">sd</span>     (my.df<span class="op">$</span>value1)    <span class="co"># standard deviation</span>
<span class="kw">var</span>    (my.df<span class="op">$</span>value1)    <span class="co"># variance</span>
<span class="kw">length</span> (my.df<span class="op">$</span>value1)    <span class="co"># number of elements</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   35.72   47.20   50.16   50.21   53.14   65.22 
## [1] 50.20622
## [1] 65.21883
## [1] 50.16402
## [1] 5.160937
## [1] 26.63527
## [1] 100</code></pre>
</div>
<div id="multiple-vectors" class="section level3">
<h3><span class="header-section-number">8.2.2</span> Multiple Vectors</h3>
<ul>
<li><strong>summary</strong> can be used for multiple columns in a data frame, which each columns is evaluated</li>
<li>For factor data, <strong>summary</strong> provides frequency count</li>
<li>For individual functions (<strong>mean, max, min, sd, var</strong>) that take only single vecotr and output single value, use <strong>sapply</strong> to provide calculation for multiple columns of a dataframe</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span> (my.df)
<span class="kw">sapply</span> (my.df[,<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>], min)
<span class="kw">sapply</span> (my.df[,<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>], max)
<span class="kw">sapply</span> (my.df[,<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>], median)
<span class="kw">sapply</span> (my.df[,<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>], sd)
<span class="kw">sapply</span> (my.df[,<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>], var)</code></pre></div>
<pre><code>##  dept    grp         value1          value2     
##  D1:25   G1:48   Min.   :35.72   Min.   :10.30  
##  D2:26   G2:52   1st Qu.:47.20   1st Qu.:18.87  
##  D3:17           Median :50.16   Median :20.83  
##  D4:17           Mean   :50.21   Mean   :20.46  
##  D5:15           3rd Qu.:53.14   3rd Qu.:22.05  
##                  Max.   :65.22   Max.   :28.76  
##   value1   value2 
## 35.72121 10.30054 
##   value1   value2 
## 65.21883 28.75742 
##   value1   value2 
## 50.16402 20.83363 
##   value1   value2 
## 5.160937 2.880463 
##    value1    value2 
## 26.635268  8.297068</code></pre>
</div>
<div id="custom-function" class="section level3">
<h3><span class="header-section-number">8.2.3</span> Custom Function</h3>
<ul>
<li>Custom function can be built to accept single vector and return single vector</li>
<li>Use <strong>sapply</strong> with the custom function to sweep through multiple columns in a dataframe and return a matrix (with row and col names) as a result</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mystats =<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">na.omit=</span><span class="ot">FALSE</span>){
  <span class="cf">if</span> (na.omit)
    x =x[<span class="op">!</span><span class="kw">is.na</span>(x)]
  m =<span class="st"> </span><span class="kw">mean</span>(x)
  med =<span class="st"> </span><span class="kw">median</span>(x)
  v =<span class="st"> </span><span class="kw">var</span>(x)
  s =<span class="st"> </span><span class="kw">sd</span>(x)
  n =<span class="st"> </span><span class="kw">length</span>(x)
  skew =<span class="st"> </span><span class="kw">sum</span>((x<span class="op">-</span>m)<span class="op">^</span><span class="dv">3</span><span class="op">/</span>s<span class="op">^</span><span class="dv">3</span>)<span class="op">/</span>n
  kurt =<span class="st"> </span><span class="kw">sum</span>((x<span class="op">-</span>m)<span class="op">^</span><span class="dv">4</span><span class="op">/</span>s<span class="op">^</span><span class="dv">4</span>)<span class="op">/</span>n <span class="op">-</span><span class="st"> </span><span class="dv">3</span>
  <span class="kw">return</span>(<span class="kw">c</span>(<span class="dt">length=</span>n, <span class="dt">mean=</span>m, <span class="dt">median=</span>med, <span class="dt">stdev=</span>s, <span class="dt">skew=</span>skew, <span class="dt">kurtosis=</span>kurt))
}

<span class="kw">sapply</span>(my.df[,<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>], mystats)</code></pre></div>
<pre><code>##                value1      value2
## length   100.00000000 100.0000000
## mean      50.20621590  20.4638110
## median    50.16401641  20.8336304
## stdev      5.16093675   2.8804631
## skew      -0.01832526  -0.2217617
## kurtosis   0.52800386   1.0046773</code></pre>
</div>
</div>
<div id="t-test" class="section level2">
<h2><span class="header-section-number">8.3</span> T-Test</h2>
</div>
<div id="covariance-correlation" class="section level2">
<h2><span class="header-section-number">8.4</span> Covariance / Correlation</h2>
<p>If two variables are independent, their <strong>covariance/correlation is 0</strong>.<br />
<strong>But</strong>, having a covariance/correlation of 0 does not imply the variables are independent.</p>
<div id="covariance" class="section level3">
<h3><span class="header-section-number">8.4.1</span> Covariance</h3>
<p><span class="math display">\[Pearson - Cov(X,Y)= \frac{\sum_{i=1}^n (X_i-\bar{X})*(Y_i-\bar{Y})}{n-1}\]</span></p>
<ul>
<li>Covariance doesn’t really tell you about the strength of the relationship between the two variables. - A large covariance can simply means the variables are made of large numbers, <strong>doesn’t means that the relation are strong</strong>.<br />
</li>
<li>Hence <strong>correlation (scaled covariance)</strong> is a better indicator of the relation strenght.</li>
</ul>
</div>
<div id="correlation" class="section level3">
<h3><span class="header-section-number">8.4.2</span> Correlation</h3>
<p><span class="math display">\[Pearson-Cor(X,Y)= \frac{Cov(X,Y)}{sd(X)sd(Y)}\]</span></p>
<ul>
<li>Correlation is a <strong>scaled version</strong> of covariance that takes on values between -1 and 1<br />
</li>
<li>Correlation are used to measure the <strong>strength</strong> of relationship among linearly related quntitative variables (numerical)<br />
</li>
<li>0 indicates no correlation. +1 and -1 indicates perfect correlation</li>
</ul>
<blockquote>
<p><strong><code>cor(x, y, use= , method= )</code></strong><br />
<span class="math inline">\(\quad\)</span> <strong><code>x</code></strong><code>= matrix or dataframe</code><br />
<span class="math inline">\(\quad\)</span> <strong><code>y</code></strong><code>= matrix or dataframe, default = x</code><br />
<span class="math inline">\(\quad\)</span> <strong><code>method</code></strong><code>= pearson, spearman, kendall, default is pearson</code><br />
<span class="math inline">\(\quad\)</span> <strong><code>use</code></strong><code>= everthing:missing value will set to missing, complete.obs:listwise deletion, pairwise.complete.obs:pairwise deletion</code></p>
</blockquote>
<ul>
<li>If y is not specified, you get <strong>cross matrices</strong> by default (all variables crossed with all other variables).</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">states =<span class="st"> </span>state.x77[,<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]
<span class="kw">cor</span>(states) 
<span class="kw">cor</span>(states, <span class="dt">method =</span> <span class="st">&#39;kendall&#39;</span>) </code></pre></div>
<pre><code>##             Population     Income Illiteracy    Life Exp     Murder
## Population  1.00000000  0.2082276  0.1076224 -0.06805195  0.3436428
## Income      0.20822756  1.0000000 -0.4370752  0.34025534 -0.2300776
## Illiteracy  0.10762237 -0.4370752  1.0000000 -0.58847793  0.7029752
## Life Exp   -0.06805195  0.3402553 -0.5884779  1.00000000 -0.7808458
## Murder      0.34364275 -0.2300776  0.7029752 -0.78084575  1.0000000
##             Population      Income Illiteracy    Life Exp     Murder
## Population  1.00000000  0.08408163  0.2123063 -0.06865555  0.2364983
## Income      0.08408163  1.00000000 -0.1970811  0.21904389 -0.1448450
## Illiteracy  0.21230629 -0.19708113  1.0000000 -0.42852098  0.5155359
## Life Exp   -0.06865555  0.21904389 -0.4285210  1.00000000 -0.5997547
## Murder      0.23649826 -0.14484495  0.5155359 -0.59975465  1.0000000</code></pre>
<ul>
<li>If x and y are specified, you can produce <strong>non squared correlation matrices</strong> with only the variables specified for both x and y axis</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cor</span>(states[,<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>], states[,<span class="dv">3</span><span class="op">:</span><span class="dv">5</span>])</code></pre></div>
<pre><code>##            Illiteracy    Life Exp     Murder
## Population  0.1076224 -0.06805195  0.3436428
## Income     -0.4370752  0.34025534 -0.2300776
## Illiteracy  1.0000000 -0.58847793  0.7029752
## Life Exp   -0.5884779  1.00000000 -0.7808458
## Murder      0.7029752 -0.78084575  1.0000000</code></pre>
</div>
<div id="correlation-test-for-significance" class="section level3">
<h3><span class="header-section-number">8.4.3</span> Correlation Test for significance</h3>
<p>From the <code>cor</code> function, we know that Murder rate and Illiteracy are highly correlated (&gt;0.7). However, is this merely by chance, or it is statistically significant that there are indeed correlated ?</p>
<p>To answer this question, we need to perform hypotesis testing:</p>
<ul>
<li><span class="math inline">\(H_0\)</span> : (population) correlation betwen Murder rate and Illiteracy <strong>is</strong> zero<br />
</li>
<li><span class="math inline">\(H_1\)</span> : (sample) correlation between Murder rate and Illiteracy <strong>is not</strong> zero</li>
</ul>
<p>We then test our sample data using <code>cor.test</code> to find out the p-value:</p>
<ul>
<li>If p-value &lt; 0.025 (two sided test), means <span class="math inline">\(H_1\)</span> is significant, therefore reject <span class="math inline">\(H_0\)</span>.<br />
</li>
<li>If p-value &gt; 0.025 (two sided test), means <span class="math inline">\(H_0\)</span> is significant, therefore accept <span class="math inline">\(H_0\)</span>.</li>
</ul>
<blockquote>
<p><strong><code>cor.test(x, y, method = , alternative= , conf.level= )</code></strong><br />
<span class="math inline">\(\quad\)</span> <strong><code>x</code></strong><code>= vector 1</code><br />
<span class="math inline">\(\quad\)</span> <strong><code>y</code></strong><code>= vector 2</code><br />
<span class="math inline">\(\quad\)</span> <strong><code>method</code></strong><code>= pearson (default), spearman, kendall</code><br />
<span class="math inline">\(\quad\)</span> <strong><code>alternative</code></strong><code>= two.sided (default), less, more</code><br />
<span class="math inline">\(\quad\)</span> <strong><code>conf.level</code></strong> <code>= 0.95(default), any value between 0 to 1</code></p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cor.test</span> (states[,<span class="st">&#39;Murder&#39;</span>], states[,<span class="st">&#39;Illiteracy&#39;</span>])</code></pre></div>
<pre><code>## 
##  Pearson&#39;s product-moment correlation
## 
## data:  states[, &quot;Murder&quot;] and states[, &quot;Illiteracy&quot;]
## t = 6.8479, df = 48, p-value = 1.258e-08
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  0.5279280 0.8207295
## sample estimates:
##       cor 
## 0.7029752</code></pre>
<p>If <span class="math inline">\(H_0\)</span> is true, then chance of observing the sample data (with correlation of 0.7) is 1.258e-08 (too low to be true). Hence we reject <span class="math inline">\(H_0\)</span>, and accept <span class="math inline">\(H_1\)</span> that there is indeed a significant correlation between the variables.</p>
<!--chapter:end:08-statistics.Rmd-->
</div>
</div>
</div>
<div id="clustering-analysis" class="section level1">
<h1><span class="header-section-number">9</span> Clustering Analysis</h1>
<ul>
<li>Cluster analysis is a data-reduction technique designed to uncover subgroups of observations within a dataset<br />
</li>
<li>It reduce a large number of observations to a much smaller number of clusters or types<br />
</li>
<li>A cluster is defined as a group of observations that are more similar to each other than they are to the observations in other groups</li>
</ul>
<div id="library-2" class="section level2">
<h2><span class="header-section-number">9.1</span> Library</h2>
<p>Below summarizes all packages, their functions and purposes used in this <strong>Clustering Analysis</strong> chapter.</p>
<table>
<colgroup>
<col width="2%" />
<col width="13%" />
<col width="10%" />
<col width="72%" />
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>Package</th>
<th>Function</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Base - R</td>
<td>dist</td>
<td>Calculate distance between data points with methods: euclidean, maximum, cenberra, minkowski, manhattan</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>scale</td>
<td>Scale data (minus mean, div by SD)</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td>hclust</td>
<td>Build hirerchical cluster model (no cutting)</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>kmeans</td>
<td>Build k-means cluster model</td>
</tr>
<tr class="odd">
<td>2</td>
<td>factoextra</td>
<td>fviz_nbclust</td>
<td>Optimum number of cluster (K) visual analysis, methods: wss, silhoutte</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>hcut</td>
<td>Build hirerchical cluster model (with cutting)</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td>fviz_dend</td>
<td>Visualize h-cluster model in dendrogram graph as ggplot object</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>fviz_cluster</td>
<td>Visualize data points with cluster grouping as ggplot object</td>
</tr>
<tr class="odd">
<td>3</td>
<td>NbClust</td>
<td>NbClust</td>
<td>30 indices to analyze optimal number of cluster, K</td>
</tr>
<tr class="even">
<td>4</td>
<td>flexclust</td>
<td>randIndex</td>
<td>Agreement measure for two cluster results</td>
</tr>
</tbody>
</table>
</div>
<div id="application" class="section level2">
<h2><span class="header-section-number">9.2</span> Application</h2>
<p>Finding groups within data and distinguishing observation in your data set that are similar from those that are different. The objective is to find the right balance between similarities and differences. On the one hand we want to treat similar cases in a similar way to benefit from economies of scale.</p>
<p>Finding groups within data will allow you to allocate your effort more efficiently:</p>
<ul>
<li>Leveraging synergies between cases that are similar<br />
</li>
<li>Allocating specific case houses to different cases if needed in order to maximize your effectiveness</li>
</ul>
<p>Example Usages are:</p>
<ul>
<li><p><strong>Business</strong> : researchers use cluster analysis for customer segmentation. Customers are arranged into clusters based on the similarity of their demographics and buying behaviours. Marketing campaings are then tailored to appeal to the groups</p></li>
<li><p><strong>Human Resource</strong> : you’re concerned by the number of employees leaving the firm. As an HR manager, you want to retain your best employees within the company but you cannot follow-up with each one of them too often as that would be very time consuming. Instead, you may rely on an HR analytic solution to understand what are the most frequent situations explaining why an employee decides to leave, with variables like number of completed projects for the past 12 months/utilization, age, last project evaluation, time spent in company, position, number of newborn, etc.</p></li>
<li><p><strong>Psychological</strong>: researchers cluster data on the symptoms and demographics of depressed patients, seeking to uncover subtypes of depression, with the hope of finding more effective targeted treatments and a better understanding of the disorder.</p></li>
<li><p><strong>Medical</strong>: researchers use cluster analysis to help catalog gene-expression patterns obtained from DNA microarray data. This can help them to understand normal growth and development and the underlying causes of many human diseases</p></li>
<li><p><strong>Information Retrieval</strong>: The world wide web consists of billions of Web pages, and the results of a query to a search engine can return thousands of pages. Clustering can be used to group these search results into a small number of clusters, each of which captures a particular aspect of the query. For example, a query of “movie” might return Web pages grouped into categories such as reviews, trailers, starts and theaters. Each category (Cluster) can be bnorken into subcategories (sub-clusters), producing a hierachical structure that further assists a user’s exploration of the query results.</p></li>
</ul>
</div>
<div id="sample-data-6" class="section level2">
<h2><span class="header-section-number">9.3</span> Sample Data</h2>
<p>Sample data used in this chapter emulate two dimensional data points with three groups with clear grouping when visualize.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1234</span>)
my.df =<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">id =</span> <span class="kw">paste</span>(<span class="st">&#39;ID_&#39;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">15</span>, <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>),
  <span class="dt">grp =</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&#39;G1&#39;</span>, <span class="dv">5</span>), <span class="kw">rep</span>(<span class="st">&#39;G2&#39;</span>, <span class="dv">5</span>), <span class="kw">rep</span>(<span class="st">&#39;G3&#39;</span>, <span class="dv">5</span>)),
  <span class="dt">value1 =</span> <span class="kw">c</span>( <span class="kw">round</span>(<span class="kw">rnorm</span>(<span class="dv">5</span>, <span class="dt">mean =</span> <span class="dv">10</span>,  <span class="dt">sd =</span> <span class="dv">3</span>)),
              <span class="kw">round</span>(<span class="kw">rnorm</span>(<span class="dv">5</span>, <span class="dt">mean =</span> <span class="dv">10</span>, <span class="dt">sd =</span> <span class="dv">3</span>)),
              <span class="kw">round</span>(<span class="kw">rnorm</span>(<span class="dv">5</span>, <span class="dt">mean =</span> <span class="dv">30</span>, <span class="dt">sd =</span> <span class="dv">3</span>))),
  <span class="dt">value2 =</span> <span class="kw">c</span>( <span class="kw">round</span>(<span class="kw">rnorm</span>(<span class="dv">5</span>, <span class="dt">mean =</span> <span class="dv">10</span>, <span class="dt">sd =</span> <span class="dv">3</span>)),
              <span class="kw">round</span>(<span class="kw">rnorm</span>(<span class="dv">5</span>, <span class="dt">mean =</span> <span class="dv">20</span>, <span class="dt">sd =</span> <span class="dv">3</span>)),
              <span class="kw">round</span>(<span class="kw">rnorm</span>(<span class="dv">5</span>, <span class="dt">mean =</span> <span class="dv">20</span>, <span class="dt">sd =</span> <span class="dv">3</span>))),
  <span class="dt">stringsAsFactors =</span> F
)
<span class="kw">rownames</span>(my.df) =<span class="st"> </span>my.df[,<span class="dv">1</span>]
<span class="kw">str</span>(my.df)
<span class="kw">plot</span>(my.df<span class="op">$</span>value1, my.df<span class="op">$</span>value2)</code></pre></div>
<p><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-136-1.png" width="864" /></p>
<pre><code>## &#39;data.frame&#39;:    15 obs. of  4 variables:
##  $ id    : chr  &quot;ID_1&quot; &quot;ID_2&quot; &quot;ID_3&quot; &quot;ID_4&quot; ...
##  $ grp   : chr  &quot;G1&quot; &quot;G1&quot; &quot;G1&quot; &quot;G1&quot; ...
##  $ value1: num  6 11 13 3 11 12 8 8 8 7 ...
##  $ value2: num  10 8 7 7 17 20 19 19 21 18 ...</code></pre>
</div>
<div id="general-steps" class="section level2">
<h2><span class="header-section-number">9.4</span> General Steps</h2>
<ol style="list-style-type: decimal">
<li><strong>Choose appropriate attributes</strong>
<ul>
<li>This is the most important steps.</li>
<li>Choose attributes that that actions can be taken upon</li>
<li>A sohisticated cluster analysis can’t compensate for a poor choice of variables <br><br></li>
</ul></li>
<li><p><strong>Scale Data</strong></p>
<p><strong>When NOT to scale </strong></p>
<p>If you have attributes with a well-defined meaning. Say, latitude and longitude, then you should not scale your data, because this will cause distortion</p>
<p><strong>When To Scale </strong></p>
<ul>
<li><p>If you have mixed numerical data, where each attribute is something entirely different (say, shoe size and weight), has different units attached (lb, tons, m, kg …) then these values aren’t really comparable anyway; z-standardizing them is a best-practise to give equal weight to them</p></li>
<li><p>If variables vary in range, then the variable with the largest value will have the greatest impact on result. This is undesirable</p></li>
<li><p>Therefore data must be scaled so that they can be compared fairly</p></li>
</ul>
<p><strong>Methods of Scaling</strong></p>
Popular scaling methods are:
<ul>
<li>Normalize to mean=0 and sd=1<br />
</li>
<li>Divide by Max<br />
</li>
<li>Minus min, divide by Min-Max range <br><br></li>
</ul></li>
<li><strong>Screen for Outliers</strong>
<ul>
<li>Outliers can distort results. Screen to remove them <br><br></li>
</ul></li>
<li><strong>Calculate Data Point Distances</strong>
<ul>
<li>Popular measure of distance between two data point is Euclidean distance</li>
<li>Others are Manhattan, Canberra, Asymmetric Binary, Maximum and Minkowski also available <br><br></li>
</ul></li>
<li><p><strong>Chosoe a Clustering Alrorithm, and Inter-Custer Distance Method</strong></p></li>
<li><p><strong>Try few Clustering Solutions</strong></p>
<ul>
<li>Decide the best clustering algorithm, cluster distance method and <strong>number of cluster, K</strong><br />
</li>
<li>Use <code>NbClus</code> as a tool to guide choosing K (number of cluster)</li>
</ul></li>
<li><strong>Visualize the result</strong>
<ul>
<li>Visualization can help you determine the meaning and usefulness of the cluster solution<br />
</li>
<li><strong>Hierarchical</strong> clustering are usually presented as a dendrogram<br />
</li>
<li><strong>Partitioning</strong> results are typically visualized using a bivariate cluster plot <br><br></li>
</ul></li>
<li><strong>Intepret the Cluster</strong>
<ul>
<li>Once a cluster solution has been obtained, you must interpret (and possibly name) the clusters</li>
<li>What do the observations in a cluster have in common?</li>
<li>How do they differ from the observations in other clusters?</li>
<li>This step is typically accomplished by obtaining summary statistics for each variable by cluster</li>
<li>For continuous data, the mean or median for each variable within each cluster is calculated.</li>
<li>For mixed data (data that contain categorical variables), the summary statistics will also include modes or category distributions <br><br></li>
</ul></li>
<li><strong>Validate Result</strong>
<ul>
<li>Validating the cluster solution involves asking the question:
<ul>
<li>“Are these groupings in some sense real, and not a manifestation of unique aspects of this dataset or statistical technique?”<br />
</li>
<li>If a different cluster method or different sample is employed, would the same clusters be obtained?<br />
</li>
<li>If actual grouping data is known, run randIndex to measure the degree of agreement<br />
</li>
<li>The fpc, clv, and clValid packages each contain functions for evaluating the stability of a clustering solution (not discussed here)</li>
</ul></li>
</ul></li>
</ol>
</div>
<div id="distance-algorithm" class="section level2">
<h2><span class="header-section-number">9.5</span> Distance Algorithm</h2>
<p>The choice of an appropriate metric will influence the shape of the clusters, as some elements may be close to one another according to one distance and farther away according to another.</p>
<p>For example, in a two dimensional data, the distance between the point (1,1) and the origin (0,0) can be 2 under <strong>Manhattan distance</strong>, <span class="math inline">\(\sqrt{2}\)</span> under <strong>Euclidean distance</strong>, or 1 under <strong>Maximum distance</strong>.</p>
<p><strong><code>dist</code></strong> is used to measure distance for all <strong>numeric</strong> elements in dataframe or matrix. Supplying non-numeric columns for <code>dist</code> will incur warning.</p>
<blockquote>
<p><strong><code>dist</code></strong><code>( x, method = )   default method = 'euclidean'</code><br />
<span class="math inline">\(\quad\)</span> <code>method = 'euclidean', &quot;maximum&quot;, &quot;manhattan&quot;, &quot;canberra&quot;, &quot;binary&quot; or &quot;minkowski&quot;</code></p>
</blockquote>
<div id="euclidean-distance" class="section level3">
<h3><span class="header-section-number">9.5.1</span> Euclidean Distance</h3>
<p><span class="math display">\[Euclidean-d(p,q) = \sqrt{\sum_{i=1}^n (p_i-q_i)^2} \quad,n = dimension\]</span></p>
<ul>
<li>The Euclidean distance is a distance measure between two points or or vectors in a two- or multidimensional (Euclidean) space <strong>based on Pythagoras’ theorem</strong><br />
</li>
<li>The distance is calculated by taking the square root of the sum of the squared pair-wise distances of every dimension</li>
</ul>
<p>Below command measures distance for numeric columns of <strong>all data points</strong> in my.df, using <strong>euclidean</strong> algorithmn.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data.scaled =<span class="st"> </span><span class="kw">scale</span>(my.df[,<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>])  <span class="co"># Z-Score scaling</span>
d.euclidean =<span class="st"> </span><span class="kw">dist</span>( data.scaled )          <span class="co"># Euclidean distance</span>
<span class="kw">round</span> (d.euclidean,<span class="dv">1</span>)</code></pre></div>
<pre><code>##       ID_1 ID_2 ID_3 ID_4 ID_5 ID_6 ID_7 ID_8 ID_9 ID_10 ID_11 ID_12 ID_13
## ID_2   0.6                                                                
## ID_3   0.9  0.3                                                           
## ID_4   0.6  0.8  1.0                                                      
## ID_5   1.4  1.7  1.9  2.1                                                 
## ID_6   2.0  2.3  2.5  2.6  0.6                                            
## ID_7   1.7  2.1  2.4  2.4  0.5  0.4                                       
## ID_8   1.7  2.1  2.4  2.4  0.5  0.4  0.0                                  
## ID_9   2.1  2.5  2.7  2.7  0.8  0.4  0.4  0.4                             
## ID_10  1.5  2.0  2.2  2.1  0.4  0.6  0.2  0.2  0.6                        
## ID_11  2.5  2.3  2.3  3.0  1.7  1.8  2.1  2.1  2.2   2.1                  
## ID_12  3.1  3.1  3.2  3.7  1.8  1.5  1.9  1.9  1.8   2.1   1.2            
## ID_13  2.5  2.4  2.4  3.1  1.6  1.6  1.9  1.9  2.1   2.0   0.2   1.0      
## ID_14  3.0  2.9  3.0  3.6  1.9  1.7  2.1  2.1  2.1   2.2   0.8   0.5   0.6
## ID_15  2.9  2.7  2.7  3.5  2.1  2.1  2.4  2.4  2.5   2.5   0.4   1.1   0.5
##       ID_14
## ID_2       
## ID_3       
## ID_4       
## ID_5       
## ID_6       
## ID_7       
## ID_8       
## ID_9       
## ID_10      
## ID_11      
## ID_12      
## ID_13      
## ID_14      
## ID_15   0.6</code></pre>
</div>
<div id="manhattan-distance" class="section level3">
<h3><span class="header-section-number">9.5.2</span> Manhattan Distance</h3>
<p><span class="math display">\[Manhattan - d(p,q) = \sum_{i=1}^n |p_i-q_i| \quad,n = dimension\]</span></p>
<ul>
<li>The Manhattan distance (sometimes also called <strong>Taxicab</strong> distance) metric is related to the Euclidean distance</li>
<li>But instead of calculating the shortest diagonal path (“beeline”) between two points, it calculates the distance based on gridlines</li>
</ul>
<p>Below command measures distance for numeric columns of <strong>all data points</strong> in my.df, using <strong>manhattan</strong> algorithm.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data.scaled =<span class="st"> </span><span class="kw">scale</span>(my.df[,<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>])  <span class="co"># Z-Score scaling</span>
d.manhattan =<span class="st"> </span><span class="kw">dist</span>( data.scaled, <span class="dt">method=</span><span class="st">&#39;manhattan&#39;</span>)
<span class="kw">round</span> (d.manhattan, <span class="dv">1</span>)</code></pre></div>
<pre><code>##       ID_1 ID_2 ID_3 ID_4 ID_5 ID_6 ID_7 ID_8 ID_9 ID_10 ID_11 ID_12 ID_13
## ID_2   0.9                                                                
## ID_3   1.2  0.4                                                           
## ID_4   0.9  1.0  1.0                                                      
## ID_5   1.8  1.7  2.1  2.7                                                 
## ID_6   2.5  2.4  2.6  3.4  0.7                                            
## ID_7   1.9  2.4  2.8  2.8  0.7  0.6                                       
## ID_8   1.9  2.4  2.8  2.8  0.7  0.6  0.0                                  
## ID_9   2.3  2.8  3.2  3.2  1.1  0.6  0.4  0.4                             
## ID_10  1.6  2.3  2.7  2.5  0.6  0.9  0.3  0.3  0.7                        
## ID_11  3.3  3.3  3.3  4.2  1.9  2.4  2.6  2.6  3.0   2.5                  
## ID_12  4.3  4.2  4.2  5.2  2.5  1.8  2.4  2.4  2.0   2.7   1.3            
## ID_13  3.4  3.4  3.4  4.3  1.6  2.1  2.3  2.3  2.7   2.2   0.3   1.1      
## ID_14  4.2  4.1  4.1  5.1  2.4  1.7  2.3  2.3  2.3   2.6   0.9   0.7   0.8
## ID_15  3.9  3.8  3.8  4.8  2.1  2.6  2.8  2.8  3.2   2.7   0.6   1.5   0.5
##       ID_14
## ID_2       
## ID_3       
## ID_4       
## ID_5       
## ID_6       
## ID_7       
## ID_8       
## ID_9       
## ID_10      
## ID_11      
## ID_12      
## ID_13      
## ID_14      
## ID_15   0.9</code></pre>
</div>
<div id="maximum-distance" class="section level3">
<h3><span class="header-section-number">9.5.3</span> Maximum Distance</h3>
<p><span class="math display">\[d(x,y)= sup|x_j - y_j|, 1≤ j ≤ d\]</span></p>
</div>
<div id="canberra-distance" class="section level3">
<h3><span class="header-section-number">9.5.4</span> Canberra Distance</h3>
<p><span class="math display">\[\sum_{j=1}^{d}|x_j - y_j|) / (|x_j|+|y_j|)\]</span></p>
</div>
<div id="minkowski-distance" class="section level3">
<h3><span class="header-section-number">9.5.5</span> Minkowski Distance</h3>
<p>The Minkowski distance is a generalized form of the <strong>Euclidean distance</strong> (if m=2) and the <strong>Manhattan distance</strong> (if m=1).</p>
<p><span class="math display">\[\left(\sum_{i=1}^n |p_i-q_i|^p\right)^{1/m}\]</span></p>
</div>
</div>
<div id="optimum-number-of-clusters-k" class="section level2">
<h2><span class="header-section-number">9.6</span> Optimum Number of Clusters (K)</h2>
<p>There are three (3) popular methods for determining the optimal number of clusters.</p>
<ol style="list-style-type: decimal">
<li><p>Elbow Method Applicable for partioning clustering, such as k-means</p></li>
<li><p>Average Silhoutte Method</p></li>
<li><p>Gap Statistics (not discussed here)</p></li>
</ol>
<p>There is no guarantee that they will agree with each other. In fact, they probably won’t. However, use this as a guidine and test few highest criteria score to determinee final number of cluster.</p>
<div id="elbow-method" class="section level3">
<h3><span class="header-section-number">9.6.1</span> Elbow Method</h3>
<div id="elbow-concept" class="section level4">
<h4><span class="header-section-number">9.6.1.1</span> Elbow Concept</h4>
<p>The objective of partitioning clustering (such as K-Mean) is to define clusters such that the total intra-cluster variation (known as total within-cluster variation or total within-cluster sum of square, wss) is minimized.</p>
</div>
<div id="elbow-algorithm" class="section level4">
<h4><span class="header-section-number">9.6.1.2</span> Elbow Algorithm</h4>
<ol style="list-style-type: decimal">
<li>Run K-mean clustering algorithm for K=1 to n<br />
</li>
<li>For each K, calculate the within-cluster-sum-of-square (wss)<br />
</li>
<li>Plot the curve of wss against the number of clusters K<br />
</li>
<li>The location of bend (knee) in the plot is generally considered as the indicator of the appropriate number of clusters</li>
</ol>
<p>When the WSS value stop decreasing significantly (at the knee), then the number of clusters probably had reached its optimum. Although this approach is heuristic, it still provide a good guideline for K selection.</p>
</div>
<div id="elbow-codes-for-k-mean---do-it-yourself" class="section level4">
<h4><span class="header-section-number">9.6.1.3</span> Elbow Codes (for K-mean) - Do It Yourself!</h4>
<p>The method presented here does not require any external library ! However, it requires writing a funciton to calculate WSS and plot the results.</p>
<p><strong>Define the The Algorithmn</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Algorithmn: Compute k-means and plot wss for k=2 to k=15</span>
wssplot =<span class="st"> </span><span class="cf">function</span>(data, <span class="dt">nc=</span><span class="dv">15</span>, <span class="dt">seed=</span><span class="dv">1234</span>){
            wss &lt;-<span class="st"> </span>(<span class="kw">nrow</span>(data)<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span><span class="kw">sum</span>(<span class="kw">apply</span>(data,<span class="dv">2</span>,var))
            <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span>nc) {
              <span class="kw">set.seed</span>(seed)
              wss[i] &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">kmeans</span>(data, <span class="dt">centers=</span>i)<span class="op">$</span>withinss)
            }
            <span class="kw">plot</span>(<span class="dv">1</span><span class="op">:</span>nc, wss, <span class="dt">type=</span><span class="st">&quot;b&quot;</span>, 
                <span class="dt">xlab=</span><span class="st">&quot;Number of Clusters (K)&quot;</span>,
                <span class="dt">ylab=</span><span class="st">&quot;Total Within Groups Sum of Squares&quot;</span>)
            wss
}</code></pre></div>
<p><strong>Run The Code</strong></p>
<p>If number of observations &lt;=nc(default 15), specify smaller nc.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">wssplot</span>(data.scaled, <span class="dt">nc=</span><span class="dv">8</span>)
<span class="kw">abline</span>(<span class="dt">v=</span><span class="dv">3</span>, <span class="dt">lty=</span><span class="dv">2</span>)     <span class="co"># mark the optimum K after facts </span>
## [1] 28.000000 12.865178  2.467904  2.191659  2.038777  0.785887  1.396947
## [8]  1.030988</code></pre></div>
<p><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-140-1.png" width="864" /></p>
<p>The wssplot above indicates that there is a <strong>distinct drop</strong> in the within-groups sum of squares when moving <strong>from 1 to 3 clusters</strong>. After three clusters, this <strong>decrease drops off</strong>, suggestign that a three-cluster solution may be a good fit to the data.</p>
</div>
<div id="elbow-codes---using-factoextrafviz_nbclusthcut" class="section level4">
<h4><span class="header-section-number">9.6.1.4</span> Elbow Codes - using <code>factoextra::fviz_nbclust,hcut</code></h4>
<ul>
<li><code>factoextra</code> combined functions to calculate ‘silhoutte’ and output <code>ggplot</code> object<br />
</li>
<li>For k-mean wss analysis, <code>kmeans</code> helper function from base-R is required<br />
</li>
<li>For pam wss analysis, <code>cluster:pam</code> helper function is required<br />
</li>
<li>For h-cluster wss analysis, <code>hcut</code> helper function by its own library is used. Somehow base-R <code>hclust</code> is not supproted</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(factoextra)
<span class="kw">library</span>(cluster)

<span class="kw">fviz_nbclust</span>(data.scaled, kmeans, <span class="dt">method =</span> <span class="st">&quot;wss&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">subtitle=</span><span class="st">&#39;kmeans&#39;</span>)
<span class="kw">fviz_nbclust</span>(data.scaled, pam,    <span class="dt">method =</span> <span class="st">&quot;wss&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">subtitle=</span><span class="st">&#39;pam&#39;</span>)
<span class="kw">fviz_nbclust</span>(data.scaled, hcut,   <span class="dt">method =</span> <span class="st">&quot;wss&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">subtitle=</span><span class="st">&#39;hcut&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">3</span>, <span class="dt">linetype =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-142-1.png" width="254.4" /><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-142-2.png" width="254.4" /><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-142-3.png" width="254.4" /></p>
</div>
</div>
<div id="average-silhoutte-method" class="section level3">
<h3><span class="header-section-number">9.6.2</span> Average Silhoutte Method</h3>
<div id="average-silhoutte-concept" class="section level4">
<h4><span class="header-section-number">9.6.2.1</span> Average Silhoutte Concept</h4>
<p>Average silhouette method computes the average silhouette of observations for different values of k. The <strong>optimal number</strong> of clusters k is the one that <strong>maximize the average silhouette</strong> over a range of possible values for k (Kaufman and Rousseeuw [1990]).</p>
<p>Silhouette analysis can be used to study the <strong>separation distance between the resulting clusters</strong>. The silhouette plot displays a measure of how close each point in one cluster is to points in the neighboring clusters and thus provides a way to assess parameters like number of clusters visually. This measure has a range of [-1, 1].</p>
<p>Silhouette coefficients (as these values are referred to as) <strong>near +1 indicate that the sample is far away from the neighboring clusters</strong>. A value of 0 indicates that the sample is on or very close to the decision boundary between two neighboring clusters and negative values indicate that those samples might have been assigned to the wrong cluster.</p>
</div>
<div id="average-silhoutte-algorithm" class="section level4">
<h4><span class="header-section-number">9.6.2.2</span> Average Silhoutte Algorithm</h4>
<ol style="list-style-type: decimal">
<li>Compute clustering algorithm (e.g., k-means clustering) for different values of k<br />
</li>
<li>For each k, calculate the average silhouette of observations (avg.sil)<br />
</li>
<li>Plot the curve of avg.sil according to the number of clusters k<br />
</li>
<li>The location of the maximum is considered as the appropriate number of clusters</li>
</ol>
</div>
<div id="average-silhoutte-code---factoextrafviz_nbclust" class="section level4">
<h4><span class="header-section-number">9.6.2.3</span> Average Silhoutte Code - <code>factoextra:fviz_nbclust</code></h4>
<p>Example code below shows silhoute analysis for kmeans, pam and h-cluster:</p>
<ul>
<li><code>factoextra</code> combined functions to calculate ‘silhoutte’ and output ggplot object<br />
</li>
<li>For k-mean silhoutte analysis, <code>kmeans</code> helper function from base-R is required<br />
</li>
<li>For pam silhoutte analysis, <code>cluster:pam</code> helper function is required<br />
</li>
<li>For h-cluster silhoutte analysis, <code>hcut</code> helper function by its own library is used. Somehow base-R <code>hclust</code> is not supproted</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(factoextra)
<span class="kw">library</span>(cluster)

<span class="kw">fviz_nbclust</span>(data.scaled, kmeans, <span class="dt">method =</span> <span class="st">&quot;silhouette&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">subtitle=</span><span class="st">&#39;kmeans&#39;</span>)
<span class="kw">fviz_nbclust</span>(data.scaled, pam,    <span class="dt">method =</span> <span class="st">&quot;silhouette&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">subtitle=</span><span class="st">&#39;pam&#39;</span>)
<span class="kw">fviz_nbclust</span>(data.scaled, hcut,   <span class="dt">method =</span> <span class="st">&quot;silhouette&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">subtitle=</span><span class="st">&#39;hcut&#39;</span>)</code></pre></div>
<p><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-144-1.png" width="254.4" /><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-144-2.png" width="254.4" /><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-144-3.png" width="254.4" /></p>
</div>
</div>
<div id="nbclust-package-with-30-indices" class="section level3">
<h3><span class="header-section-number">9.6.3</span> NbClust Package (with 30 Indices)</h3>
<p><code>NbClust</code> package offers numerous 26 indices for determining the best number of clusters in a cluster analysis.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&#39;NbClust&#39;</span>)</code></pre></div>
<ul>
<li>Multiple indices are computed <strong>simultaneously</strong> - a clear advantage<br />
</li>
<li>Paramter <code>index='all'</code> will utilize all indices to evaluate the optimum number of clusters<br />
</li>
<li><code>Nbclust</code> returns a list that contains all evaluation statistic based on the indices used<br />
</li>
<li>Results of the evaluation is stored in <code>Best.nc</code> vector<br />
</li>
<li>Using <code>table</code> and <code>barplot</code> is best way to visualize the result of best K</li>
</ul>
<p><strong>Supported Indices are</strong></p>
<ul>
<li>kl, ch, hartigan, ccc, scott, marriot, trcovw, tracew, friedman, rubin, cindex, db, silhouette, duda, pseudot2, beale, ratkowsky, ball, ptbiserial, gap, frey, mcclain, gamma, gplus, tau, dunn, hubert, sdindex, dindex, sdbw<br />
</li>
<li><strong>‘all’</strong> (all indices except GAP, Gamma, Gplus and Tau)<br />
</li>
<li>‘alllong’ (all indices with Gap, Gamma, Gplus and Tau included)</li>
</ul>
<blockquote>
<p><strong><code>NbClust( data=, diss=NULL, distance='euclidean', min.nc=2, max.nc=15,</code></strong><br />
<strong><code>method=NULL, index='all', alphaBeale=0.1)</code></strong><br />
<span class="math inline">\(\quad\)</span> <code>data = matrix or dataframe</code><br />
<span class="math inline">\(\quad\)</span> <code>diss = dissimilarity matrix, if not NULL, then distance should be NULL</code><br />
<span class="math inline">\(\quad\)</span> <code>distance = &quot;euclidean&quot;, &quot;maximum&quot;, &quot;manhattan&quot;, &quot;canberra&quot;, &quot;binary&quot;, &quot;minkowski&quot; or &quot;NULL&quot;</code><br />
<span class="math inline">\(\quad\)</span> <code>min.nc = minimum number of clusters</code><br />
<span class="math inline">\(\quad\)</span> <code>max.nc = maximum number of clusters</code><br />
<span class="math inline">\(\quad\)</span> <code>method = &quot;ward.D&quot;, &quot;ward.D2&quot;, &quot;single&quot;, &quot;complete&quot;, &quot;average&quot;, &quot;mcquitty&quot;, &quot;median&quot;, &quot;centroid&quot;, &quot;kmeans&quot;</code><br />
<span class="math inline">\(\quad\)</span> <code>index = 'all' to use all indices for evaluation</code></p>
</blockquote>
<p><code>NbClust</code> <strong>output</strong> an object with below values:</p>
<blockquote>
<p><strong><code>Best.nc</code></strong> <code>: Best number of clusters proposed by each index and the corresponding index value</code><br />
<strong><code>Best.partition</code></strong><code>: vector of cluster group for every observation</code></p>
</blockquote>
<div id="run-the-code-1" class="section level4">
<h4><span class="header-section-number">9.6.3.1</span> Run The Code</h4>
<p>Run <code>NbClust</code> for <code>average (h-clustering)</code> and <code>kmeans</code> method.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nbc.hclust =<span class="st"> </span><span class="kw">NbClust</span>(data.scaled, <span class="dt">distance=</span><span class="st">&quot;euclidean&quot;</span>, <span class="dt">min.nc=</span><span class="dv">2</span>, <span class="dt">max.nc=</span><span class="dv">8</span>, <span class="dt">method=</span><span class="st">&quot;average&quot;</span>)
nbc.kmeans =<span class="st"> </span><span class="kw">NbClust</span>(data.scaled,                       <span class="dt">min.nc=</span><span class="dv">2</span>, <span class="dt">max.nc=</span><span class="dv">8</span>, <span class="dt">method=</span><span class="st">&quot;kmeans&quot;</span>)</code></pre></div>
</div>
<div id="visualize-the-result" class="section level4">
<h4><span class="header-section-number">9.6.3.2</span> Visualize The Result</h4>
<p><strong>Visualize using Base-R</strong></p>
<p>As output <code>Best.nc[1,]</code> shows, majority indices favor three (3) clusters.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>( nbc.hclust<span class="op">$</span>Best.n[<span class="dv">1</span>,] )
<span class="kw">barplot</span>( <span class="kw">table</span>(nbc.hclust<span class="op">$</span>Best.n[<span class="dv">1</span>,] ),
  <span class="dt">xlab=</span><span class="st">&quot;Numer of Clusters&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Number of Criteria&quot;</span>,
  <span class="dt">main=</span><span class="st">&quot;Number of Clusters Chosen by 26 Criteria</span><span class="ch">\n</span><span class="st">h-cluster&quot;</span>)

<span class="kw">table</span>( nbc.kmeans<span class="op">$</span>Best.nc[<span class="dv">1</span>,] )
<span class="kw">barplot</span>( <span class="kw">table</span>(nbc.kmeans<span class="op">$</span>Best.nc[<span class="dv">1</span>,] ),
  <span class="dt">xlab=</span><span class="st">&quot;Numer of Clusters&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Number of Criteria&quot;</span>,
  <span class="dt">main=</span><span class="st">&quot;Number of Clusters Chosen by 26 Criteria</span><span class="ch">\n</span><span class="st">kmeans&quot;</span>)
## 
##  0  1  2  3  5  6  7  8 
##  2  1  2 14  2  1  2  2 
## 
##  0  1  2  3  5  7  8 
##  2  1  2 15  1  1  4</code></pre></div>
<p><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-148-1.png" width="384" /><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-148-2.png" width="384" /></p>
<p><strong>Visualize using <code>factoextra::fviz_nbclust()</code></strong></p>
<p>Single function <code>fviz_nbclust()</code> from <code>factoextra</code> library will use value in <strong>NbClust</strong> object to visualize the optimal cluster number. <code>fviz_nbclus</code> output <code>ggplot</code> object, hence can be easily customized.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&#39;factoextra&#39;</span>)
<span class="kw">fviz_nbclust</span>(nbc.hclust) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">subtitle=</span><span class="st">&#39;H-Cluster&#39;</span>)
<span class="kw">fviz_nbclust</span>(nbc.kmeans) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">subtitle=</span><span class="st">&#39;K-Means&#39;</span>)</code></pre></div>
<p><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-149-1.png" width="384" /><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-149-2.png" width="384" /></p>
</div>
</div>
</div>
<div id="clustering-algorithm-compared" class="section level2">
<h2><span class="header-section-number">9.7</span> Clustering Algorithm Compared</h2>
<table>
<colgroup>
<col width="3%" />
<col width="20%" />
<col width="40%" />
<col width="36%" />
</colgroup>
<thead>
<tr class="header">
<th></th>
<th align="left">Description</th>
<th align="left">h-cluster</th>
<th align="left">k-means</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td align="left">Computation Time</td>
<td align="left">Fast. Linear to number of observation</td>
<td align="left">Slow: Quadradric to number of observation</td>
</tr>
<tr class="even">
<td>2</td>
<td align="left">Initial K needed</td>
<td align="left">No</td>
<td align="left">Yes</td>
</tr>
<tr class="odd">
<td>3</td>
<td align="left">Fine Tuning</td>
<td align="left">Experiment with different method of Linkage</td>
<td align="left">Experiment with different K centroids</td>
</tr>
<tr class="even">
<td>4</td>
<td align="left">Perform Well in</td>
<td align="left">Hierachical Nature Data Set</td>
<td align="left">Spherical Data Points</td>
</tr>
<tr class="odd">
<td>5</td>
<td align="left">Perform Bad in</td>
<td align="left">Large data sets</td>
<td align="left">U-Shape, Outliers</td>
</tr>
<tr class="even">
<td>6</td>
<td align="left">Unique Advantages</td>
<td align="left">Good for hirechical discovery</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td>7</td>
<td align="left">R Library</td>
<td align="left">Base R, factoextra</td>
<td align="left">Base R</td>
</tr>
</tbody>
</table>
</div>
<div id="hierarchical-clustering" class="section level2">
<h2><span class="header-section-number">9.8</span> Hierarchical Clustering</h2>
<ul>
<li>Hierarchical clustering is a widely used data analysis tool<br />
</li>
<li>The idea is to build a binary tree of the data that successively merges similar groups of points<br />
</li>
<li>Number of clusters (K) is required as import<br />
</li>
<li>It is an unsupervised learning</li>
</ul>
<div id="clustering-algorithm" class="section level3">
<h3><span class="header-section-number">9.8.1</span> Clustering Algorithm</h3>
<p>This is how Hierarchical Clustering works:<br />
1. Initially, put each data point in <strong>its own cluster</strong><br />
2. <strong>Calucate the distances</strong> between each cluster and all other clusters (inter-cluster distance)<br />
3. <strong>Combine the two clusters</strong> with the smallest distance - This reduce cluster number by one<br />
4. Repeat step (2) and (3) until all clusters have been <strong>merged into single cluster</strong> <br></p>
</div>
<div id="inter-cluster-distance-method" class="section level3">
<h3><span class="header-section-number">9.8.2</span> Inter Cluster Distance Method</h3>
<p>Once distance for all data points has been measured, decide which of the five (5) methods below to measure distance between clusters:</p>
<ol style="list-style-type: decimal">
<li><strong>Single Linkage</strong>:<br />
Shortest distance among all data points betweentwo clusters<br />
</li>
<li><strong>Complete Linkage (common)</strong>:<br />
Longest distance among all data points between two clusters<br />
</li>
<li><strong>Average Linkage (common)</strong>:<br />
Average distance of all points between two clusters</li>
<li><strong>Centroid</strong>:<br />
Find the centroid of each cluster and calculate the distance between centroids between two clusters</li>
</ol>
<p>Please note that the <strong>Inter Cluster Distance Method</strong> above uses <strong>Distance Algorithmn</strong> such as ‘euclidean’, “maximum”, “manhattan”, “canberra”, “binary” or “minkowski” to calculate actual distance value.</p>
</div>
<div id="run-the-code-2" class="section level3">
<h3><span class="header-section-number">9.8.3</span> Run The Code</h3>
<p>Generally, step (A), (B) and (C) are followed for H-clustering analysis.</p>
<p><strong>A. Before running H-Clustering</strong></p>
<ol style="list-style-type: decimal">
<li>Fiter Data (choose only numeric columns)<br />
</li>
<li>Scale Data (if required)<br />
</li>
<li>Calculate distance, using</li>
</ol>
<p><strong>B. Performing H-Clustering</strong></p>
<ol style="list-style-type: decimal">
<li>Build H-Cluster model, require input of <strong>inter-cluster distance method</strong><br />
</li>
<li>Derive cluster by **cutting* into K number of clusters</li>
</ol>
<p><strong>C. Visualize</strong></p>
<ol style="list-style-type: decimal">
<li>Display frequency, number of observations for each cluster group<br />
</li>
<li>Plot dendrogram, superimpose cluster group into the plot</li>
</ol>
<div id="using-base-r-utilities" class="section level4">
<h4><span class="header-section-number">9.8.3.1</span> Using Base-R Utilities</h4>
<blockquote>
<p><strong><code>hclust (d, method ='complete')</code></strong><br />
<span class="math inline">\(\quad\)</span> <code>d      = distance calculated using dist()</code><br />
<span class="math inline">\(\quad\)</span> <code>method = 'single', 'complete', 'average', 'centroid' as cluster distance method</code></p>
</blockquote>
<p><strong>Filter, Scale, Calculate Distance</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data.scaled =<span class="st"> </span><span class="kw">scale</span>(my.df[,<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>])   <span class="co"># scale data</span>
d.euclidean =<span class="st"> </span><span class="kw">dist</span>( data.scaled )  <span class="co"># calculate distance</span></code></pre></div>
<p><strong>Build H-Cluster Model, Cutting into clusters</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit.average  =<span class="st"> </span><span class="kw">hclust</span> (d.euclidean, <span class="dt">method=</span><span class="st">&#39;average&#39;</span>)  <span class="co"># build the model</span>
clusters =<span class="st"> </span><span class="kw">cutree</span> (fit.average, <span class="dt">k=</span><span class="dv">3</span>)                   <span class="co"># derive the clusters</span>
clusters
##  ID_1  ID_2  ID_3  ID_4  ID_5  ID_6  ID_7  ID_8  ID_9 ID_10 ID_11 ID_12 
##     1     1     1     1     2     2     2     2     2     2     3     3 
## ID_13 ID_14 ID_15 
##     3     3     3</code></pre></div>
<p><strong>Display frequency table, Visualize with dendogram, superimpose cluster group</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">barplot</span>( <span class="kw">table</span>(clusters), <span class="dt">xlab=</span><span class="st">&#39;Cluster Group Number&#39;</span>, <span class="dt">ylab=</span><span class="st">&#39;No. of Observations&#39;</span> ) 
<span class="kw">plot</span>( fit.average, <span class="dt">main=</span><span class="st">&#39;HCluster, Average-Linkage</span><span class="ch">\n</span><span class="st">3 Clusters Solution&#39;</span> )
<span class="kw">rect.hclust</span>( fit.average, <span class="dt">k=</span><span class="dv">3</span>, <span class="dt">border =</span> <span class="dv">2</span><span class="op">:</span><span class="dv">5</span> )</code></pre></div>
<p><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-153-1.png" width="384" /><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-153-2.png" width="384" /></p>
</div>
<div id="using-factoextra-package" class="section level4">
<h4><span class="header-section-number">9.8.3.2</span> Using <code>factoextra</code> Package</h4>
<p><code>factoextra</code> provides single function <code>hcut</code> to <strong>scale</strong>, <strong>calcuate distance</strong> and <strong>cutting</strong> into cluster groups. Which is <strong>handy</strong>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;factoextra&quot;</span>)</code></pre></div>
<blockquote>
<p><code>hcut(x, k = 2, hc_method = &quot;ward.D2&quot;, hc_metric = &quot;euclidean&quot;, stand = FALSE, graph = FALSE)</code><br />
<span class="math inline">\(\quad\)</span> <code>x         = matrix or dataframe</code><br />
<span class="math inline">\(\quad\)</span> <code>k         = number of clusters to cut</code><br />
<span class="math inline">\(\quad\)</span> <code>hc_method = inter-cluster distance method: ward.D, ward.D2, single, complete, average</code><br />
<span class="math inline">\(\quad\)</span> <code>hc_metric = distance calc method: euclidean, manhattan, maximum, canberra, binary, &quot;minkowski</code><br />
<span class="math inline">\(\quad\)</span> <code>stand     = TRUE: scale x with z-score, FALSE: not to scale x</code></p>
</blockquote>
<p><code>hcut</code> output below useful values (not all displayed):</p>
<blockquote>
<p><span class="math inline">\(\quad\)</span> <code>data    = original data (if stand=FALSE), scaled data (if stand=TRUE)</code><br />
<span class="math inline">\(\quad\)</span> <code>nbclust = number of clusters</code><br />
<span class="math inline">\(\quad\)</span> <code>cluster = cluster group number assigned for each observation</code><br />
<span class="math inline">\(\quad\)</span> <code>size    = frequency vector, number of observations for each cluster</code><br />
<span class="math inline">\(\quad\)</span> <code>method  = inter-cluster distance method applied</code><br />
<span class="math inline">\(\quad\)</span> <code>dist.method  = distance method applied</code></p>
</blockquote>
<p><strong>Filter, Scale, Calculate Distance, Build H-Cluster Model, Cutting into Clusters</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit.hc =<span class="st"> </span><span class="kw">hcut</span>(my.df[,<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>], <span class="dt">k=</span><span class="dv">3</span>, <span class="dt">hc_method=</span><span class="st">&#39;average&#39;</span>, <span class="dt">hc_metric=</span><span class="st">&#39;euclidean&#39;</span>, <span class="dt">stand =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><strong>Display frequency table, Visualize with dendogram, superimpose cluster group</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">barplot</span>( <span class="kw">table</span>(fit.hc<span class="op">$</span>cluster), <span class="dt">xlab=</span><span class="st">&#39;Cluster Group Number&#39;</span>, <span class="dt">ylab=</span><span class="st">&#39;No. of Observations&#39;</span> ) 
<span class="kw">fviz_dend</span>(fit.hc, <span class="dt">rect =</span> <span class="ot">TRUE</span>, <span class="dt">rect_border =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">cex =</span> <span class="fl">0.5</span>, <span class="dt">lower_rect =</span> <span class="op">-</span><span class="fl">0.5</span>, <span class="dt">horiz =</span> T)</code></pre></div>
<p><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-157-1.png" width="384" /><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-157-2.png" width="384" /></p>
</div>
</div>
</div>
<div id="k-mean-clustering" class="section level2">
<h2><span class="header-section-number">9.9</span> K-Mean Clustering</h2>
<ul>
<li><strong>K-mean</strong> is the <strong>most common partitioning</strong> clustering algorithm<br />
</li>
<li>Partitioning means data points need to be initally partioned into few clusters to start the process with<br />
</li>
<li>The other partitioning clustering method is <strong>Medoids</strong></li>
</ul>
<div id="clustering-algorithm-1" class="section level3">
<h3><span class="header-section-number">9.9.1</span> Clustering Algorithm</h3>
<ol style="list-style-type: decimal">
<li><p><strong>Define K number of centroids (data points)</strong></p></li>
<li><p><strong>Cluster Assignment</strong><br />
Each observation is assigned to the nearest centroid, using <strong>euclidean</strong> distance</p></li>
<li><p><strong>Update Centroids</strong><br />
After all observations had been assigned to the centroids, a new centroids is calculated</p></li>
<li><p><strong>Repeat step (2) - (3) until convergence</strong><br />
Convergence means none of the observations changed cluster membership</p></li>
</ol>
</div>
<div id="run-the-code-3" class="section level3">
<h3><span class="header-section-number">9.9.2</span> Run The Code</h3>
<p>Generally, step (A), (B) and (C) are followed for H-clustering analysis.</p>
<p><strong>A. Before running H-Clustering</strong></p>
<ol style="list-style-type: decimal">
<li>Fiter Data (choose only numeric columns)<br />
</li>
<li>Scale Data (if required)</li>
</ol>
<p><strong>B. Performing H-Clustering</strong></p>
<ol style="list-style-type: decimal">
<li>Build K-Means Cluster model, require input
<ul>
<li>Number of initial centers (clusters K)</li>
<li>K-Means Algorithmn</li>
<li>Number of tries to seed random centers, before choosing the best model</li>
</ul></li>
</ol>
<p><strong>C. Visualize</strong></p>
<ol style="list-style-type: decimal">
<li>Display frequency, number of observations for each cluster group<br />
</li>
<li>Plot graph, superimpose cluster group into the plot</li>
</ol>
<div id="section" class="section level4">
<h4><span class="header-section-number">9.9.2.1</span> </h4>
<blockquote>
<p><strong><code>kmeans( x, centers, nstart=1, algorithmn='Hartiga-Wong' )</code></strong><br />
<span class="math inline">\(\quad\)</span> <code>x = matrix or dataframe</code><br />
<span class="math inline">\(\quad\)</span> <code>centers   = number of centroids</code><br />
<span class="math inline">\(\quad\)</span> <code>nstart    = how many times to randomly try seeding centroids</code><br />
<span class="math inline">\(\quad\)</span> <code>algorithm = &quot;Hartigan-Wong&quot;-default, &quot;Lloyd&quot;, &quot;Forgy&quot;, &quot;MacQueen&quot;</code></p>
</blockquote>
<p><strong>nstart=25</strong> is a good number to use. <code>kmeans</code> output below useful values:</p>
<blockquote>
<p><strong><code>cluster</code></strong> <code>: cluster number for all observations</code><br />
<strong><code>centers</code></strong> <code>: Centre values (of each dimensions) for each cluster</code><br />
<strong><code>withinss</code></strong> <code>: Total Sum of Squares Within For Each Cluster</code><br />
<strong><code>size</code></strong> <code>: Number of observations for each cluster number</code></p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit.kmeans =<span class="st"> </span><span class="kw">kmeans</span>(data.scaled, <span class="dv">3</span>, <span class="dt">nstart =</span> <span class="dv">25</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit.kmeans<span class="op">$</span>cluster
##  ID_1  ID_2  ID_3  ID_4  ID_5  ID_6  ID_7  ID_8  ID_9 ID_10 ID_11 ID_12 
##     3     3     3     3     1     1     1     1     1     1     2     2 
## ID_13 ID_14 ID_15 
##     2     2     2</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit.kmeans<span class="op">$</span>withinss
## [1] 0.5512567 1.1226046 0.7940430</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit.kmeans<span class="op">$</span>size
## [1] 6 5 4</code></pre></div>
</div>
</div>
<div id="visualizing-k-mean-cluster" class="section level3">
<h3><span class="header-section-number">9.9.3</span> Visualizing K-Mean Cluster</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(factoextra)

<span class="kw">fviz_cluster</span>( fit.kmeans, <span class="dt">data =</span> data.scaled, 
  <span class="dt">geom =</span> <span class="st">&quot;point&quot;</span>, <span class="dt">stand =</span> <span class="ot">FALSE</span>, <span class="dt">ellipse.type =</span> <span class="st">&quot;norm&quot;</span>)</code></pre></div>
<p><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-162-1.png" width="864" /></p>
</div>
</div>
<div id="agreement-with-actual-group-data" class="section level2">
<h2><span class="header-section-number">9.10</span> Agreement With Actual Group Data</h2>
<p>The adjusted Rand index provides a measure of the agreement between two sets of grouping data, adjusted for chance. It ranges from -1 (no agreement) to 1 (perfect agreement).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&#39;flexclust&#39;</span>)</code></pre></div>
<div id="compare-cluster-with-actual-data" class="section level3">
<h3><span class="header-section-number">9.10.1</span> Compare Cluster with Actual Data</h3>
<p>If we know the actual grouping data, we can then run this index analysis against the cluster grouping.</p>
<p>Construct a table of cluster groups and actual groups. Then run randIndex on it to reveal the agreement measure.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># cluster data generated using cutree()</span>
<span class="kw">table</span>(my.df<span class="op">$</span>grp, clusters)  

<span class="kw">randIndex</span>( <span class="kw">table</span>(my.df<span class="op">$</span>grp, clusters) )
##     clusters
##      1 2 3
##   G1 4 1 0
##   G2 0 5 0
##   G3 0 0 5
##       ARI 
## 0.7920792</code></pre></div>
</div>
<div id="compare-two-clusters" class="section level3">
<h3><span class="header-section-number">9.10.2</span> Compare Two Clusters</h3>
<p>We can also compare cluster data from two different clusters, eg. clusters using different algorithm.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># cluster data generated using kmeans and factoextra::hcut()</span>
<span class="kw">table</span>(fit.kmeans<span class="op">$</span>cluster, fit.hc<span class="op">$</span>cluster)

<span class="kw">randIndex</span>( <span class="kw">table</span>(fit.kmeans<span class="op">$</span>cluster, fit.hc<span class="op">$</span>cluster) )
##    
##     1 2 3
##   1 0 6 0
##   2 0 0 5
##   3 4 0 0
## ARI 
##   1</code></pre></div>
<p>It this case, both models give similar clustering result.</p>
<!--chapter:end:09-clustering.Rmd-->
</div>
</div>
</div>
<div id="regression-analysis" class="section level1">
<h1><span class="header-section-number">10</span> Regression Analysis</h1>
<div id="introduction" class="section level2">
<h2><span class="header-section-number">10.1</span> Introduction</h2>
<p>Regression is statistical process for estimating the relationships among variables:</p>
<ul>
<li>It includes many techniques for modeling and analyzing the relationship between a dependent variable and one or more independent variables<br />
</li>
<li>More specifically, regression analysis helps one understand how the typical value of the dependent variable changes when any one of the independent variables is varied, while the other independent variables are held fixed<br />
</li>
<li>Regression analysis estimates the conditional expectation of the dependent variable given the independent variables – that is, the average value of the dependent variable when the independent variables are fixed<br />
</li>
<li>Regression analysis is a form of predictive modelling technique which investigates the relationship between a dependent (target) and independent variable</li>
</ul>
<div id="general-equation-and-terminilogy" class="section level3">
<h3><span class="header-section-number">10.1.1</span> General Equation and Terminilogy</h3>
<p>A regression model relates Y to a function of <span class="math inline">\(X\)</span> and <span class="math inline">\(\beta\)</span>:</p>
<p><span class="math inline">\(\quad{Y\approx f(\mathbf {X} ,{\boldsymbol {\beta }})}\)</span><br />
<span class="math inline">\(\quad \quad E(Y)\)</span> = Predicted Value, Expected outcome or response, Expectation<br />
<span class="math inline">\(\quad \quad Y\)</span> = Dependent variable, criterion, outocme, response<br />
<span class="math inline">\(\quad \quad X\)</span> = Independent variable, features, predictors</p>
<p>The goal of regression analaysis is to derive a model that estimate the <strong>paramter (<span class="math inline">\(\beta\)</span>) which has the least cost</strong>.</p>
</div>
<div id="r-formula-object" class="section level3">
<h3><span class="header-section-number">10.1.2</span> R Formula Object</h3>
<div id="notation-symbols" class="section level4">
<h4><span class="header-section-number">10.1.2.1</span> Notation Symbols</h4>
<table style="width:100%;">
<colgroup>
<col width="6%" />
<col width="79%" />
<col width="13%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">Symbol</th>
<th align="left">Usage</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">~</td>
<td align="left">Seperate response variables on the left, predictor variables on the right</td>
<td>y ~ x</td>
</tr>
<tr class="even">
<td align="center">+</td>
<td align="left">Seperate predictor variables</td>
<td>y ~ x + z</td>
</tr>
<tr class="odd">
<td align="center">:</td>
<td align="left">Denotes interaction between predictors</td>
<td>y ~ x : z</td>
</tr>
<tr class="even">
<td align="center">*</td>
<td align="left">Shortcut denoting all possible interactions. x * z equivalent to x + z + x:z</td>
<td>y ~ x * z</td>
</tr>
<tr class="odd">
<td align="center">^</td>
<td align="left">^3 measn include these variables and all interactions up to three way</td>
<td>y ~ (x + z + w)^2</td>
</tr>
<tr class="even">
<td align="center">-1</td>
<td align="left">Suppress the intercept (make intercept to be zero) y ~ x - 1 fits the regression of y on x, forcing the line y = 0 at x = 0</td>
<td>y ~ x -1</td>
</tr>
<tr class="odd">
<td align="center">.</td>
<td align="left">A shortcut placeholder to include all other variables except the dependent variable y ~ . will expand to y ~ x + z + w</td>
<td>y ~ .</td>
</tr>
<tr class="even">
<td align="center">-</td>
<td align="left">Exclude specific variable</td>
<td>y ~.-z , y~.-w:z</td>
</tr>
<tr class="odd">
<td align="center">I ()</td>
<td align="left">Elements in parentheses are interpreted arithmetically</td>
<td></td>
</tr>
<tr class="even">
<td align="center">function</td>
<td align="left">Math function can be used in formula, log(y) ~ x + z + w would predict log(y) from x, z and w</td>
<td>log(y) ~ x + z + w</td>
</tr>
</tbody>
</table>
</div>
<div id="example-equation-and-notations" class="section level4">
<h4><span class="header-section-number">10.1.2.2</span> Example Equation and Notations</h4>
<table>
<colgroup>
<col width="3%" />
<col width="69%" />
<col width="26%" />
</colgroup>
<thead>
<tr class="header">
<th align="center"></th>
<th align="left">Example Equation</th>
<th align="left">R Formula Notation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="left"><span class="math inline">\(y=\beta_0 + \beta_1 x + \beta_2 w + \beta_3 z + e\)</span></td>
<td align="left">y ~ x + w + z</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="left"><span class="math inline">\(y=\beta_0 + \beta_1 x + \beta_2 wz + e\)</span></td>
<td align="left">y ~ x + w:z</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="left"><span class="math inline">\(y=\beta_0 + \beta_1 x + \beta_2 wz + \beta_3 w + \beta_4 z + e\)</span></td>
<td align="left">y ~ x + w*z</td>
</tr>
<tr class="even">
<td align="center"></td>
<td align="left"></td>
<td align="left">y ~ x + w:z + w + z</td>
</tr>
<tr class="odd">
<td align="center">4</td>
<td align="left"><span class="math inline">\(y = 0 + \beta_1 x + \beta_2 w\)</span></td>
<td align="left">y ~ -1 + x + w</td>
</tr>
<tr class="even">
<td align="center">5</td>
<td align="left"><span class="math inline">\(y=\beta_0 + \beta_1 x + \beta_2 w + e\)</span></td>
<td align="left">y ~ .- z</td>
</tr>
<tr class="odd">
<td align="center">6</td>
<td align="left"><span class="math inline">\(y=\beta_0 + \beta_1 x + \beta_2 x^2 + \beta_3 x^3 + e\)</span></td>
<td align="left">y ~ x + I(x^2) + I(x^3)</td>
</tr>
</tbody>
</table>
<p>In R, there are <strong>more than one way</strong> to write a notation, consider below two examples:</p>
<p><span class="math inline">\(y=\beta_0 + \beta_1 x + \beta_2 w + \beta_3 z + \beta_4 xw + \beta_5 xz + \beta_6 wz + \beta_7 xwz + e\)</span><br />
can be represented by three formulas as below:</p>
<pre><code>y ~ (x + w + z)^3  
y ~ x * w * z
y ~ x + w + z + x:w + x:z + w:z + x:w:z</code></pre>
<p><span class="math inline">\(y=\beta_0 + \beta_1 x + \beta_2 w + \beta_3 z + \beta_4 xw + \beta_5 xz + \beta_6 wz + e\)</span><br />
can be represented by three formula as below:</p>
<pre><code>y ~ (x + w + z)^2
y ~ x * w * z - x:w:z
y ~ x + w + z + x:w + x:z + w:z</code></pre>
</div>
</div>
</div>
<div id="application-1" class="section level2">
<h2><span class="header-section-number">10.2</span> Application</h2>
</div>
<div id="types-of-regression" class="section level2">
<h2><span class="header-section-number">10.3</span> Types of Regression</h2>
<div id="linear-and-non-lienar" class="section level3">
<h3><span class="header-section-number">10.3.1</span> Linear and Non Lienar</h3>
<ol style="list-style-type: decimal">
<li><p><strong>Linear Regression</strong></p>
<ol style="list-style-type: lower-alpha">
<li>Simple an d Multiple Regression<br />
</li>
<li>General Linear Model<br />
</li>
<li>Heteroscedastic Model<br />
</li>
<li>Hierarchical Linear Model<br />
</li>
<li>Erros-in-variables<br />
</li>
<li>Others</li>
</ol></li>
<li><p><strong>Non Linear Regression</strong></p>
<ol style="list-style-type: lower-alpha">
<li>Logistic Regression<br />
</li>
<li>Polynomial Regression<br />
</li>
<li>Stepwise Regression<br />
</li>
<li>Ridge Regression<br />
</li>
<li>Lasso Regression<br />
</li>
<li>ElasticNet Regression<br />
</li>
<li>Others</li>
</ol></li>
</ol>
</div>
<div id="choosing-the-regression-algorithm" class="section level3">
<h3><span class="header-section-number">10.3.2</span> Choosing the Regression Algorithm</h3>
<ol style="list-style-type: decimal">
<li>Number of independent variables<br />
</li>
<li><p>Shape of the regression line</p></li>
<li>Type of dependent variable
<ul>
<li>Binary outocme : Logistic Regression</li>
</ul></li>
</ol>
<p>lm() fits models following the form Y = Xb + e, where e is Normal (0 , s^2).</p>
<p>glm() fits models following the form f(Y) = Xb + e. However, in glm both the function f(Y) (the ‘link function’) and the distribution of the error term e can be specified. Hence the name - ‘generalised linear model’.</p>
<p>If you are getting the same results using both lm() and glm(), it is because for glm(), f(Y) - the ‘link function’ defaults to Y, and e defaults to Normal (0, s^2). i.e. if you don’t specify the link function and error distribution, the parameters that glm() uses produce the same effect as running lm().</p>
<p>Glm uses normal distribution, lm uses t-distribution, hence the degree of freedom used are different.</p>
<p>lm models equation of <span class="math inline">\(Y = \beta_0 X + E\)</span>, where e = Normal(0,s^2)<br />
glm models equation of <span class="math inline">\(g(Y) = \beta_0 X + E\)</span>, where distribution of e can be specified<br />
function g(Y) is called ‘link function’ . By default parameters, glm fits the same model as lm, with exception that it uses normal distribution instead of t-distribution.</p>
</div>
</div>
<div id="linear-regression-ols" class="section level2">
<h2><span class="header-section-number">10.4</span> Linear Regression (OLS)</h2>
<p>This section discussed <strong>Ordinary Least Square</strong> Linear Regression, this includes single and multiple variable OLS Linear Regression.</p>
<p>There are other types of linear regression, which are not covered.</p>
<ul>
<li>General Linear Regression<br />
</li>
<li>Generalized Linear Regression<br />
</li>
<li>Hierachical Linear Regression<br />
</li>
<li>Erros-in-variable Linear Regression<br />
</li>
<li>Others</li>
</ul>
<div id="the-concept" class="section level3">
<h3><span class="header-section-number">10.4.1</span> The Concept</h3>
<p>Linear Regression establishes a relationship between <strong>dependent variable (Y)</strong> and one or more <strong>independent variables (X)</strong> using a best fit straight line (also known as <strong>regression line</strong>).</p>
<ul>
<li>The objective of linear regression modeling is to find the most <strong>optimum equation</strong> that <strong>best explain</strong> the data</li>
<li><strong>Optimum</strong> equation is defined as the one that has the least cost (error)</li>
</ul>
<p>Once we had derived the <strong>optimum equation</strong>, we can use the model to predict target <span class="math inline">\(Y&#39;\)</span> base on new variables <span class="math inline">\(X\)</span>.</p>
</div>
<div id="assumptions" class="section level3">
<h3><span class="header-section-number">10.4.2</span> Assumptions</h3>
<p>Below are conditions for the <strong>least-squares estimator - used by linear regression</strong> to possess desirable properties; in particular, these assumptions imply that the <strong>parameter estimates</strong> will be <strong>unbiased, consistent, and efficient</strong> in the class of linear unbiased estimators.</p>
<p><strong>Classical assumptions</strong> for linear regression analysis include:</p>
<ul>
<li><p>The sample is representative of the population for the inference prediction<br />
Question how is the data being gathered, is it convincing that it represents the population ?</p></li>
<li><p>Number of observations <strong>must be larger</strong> than number of independent variables<br />
Check the length of observations &gt;= column length of data</p></li>
</ul>
<p><strong>Assumptions On Dependent Variable</strong></p>
<ul>
<li>Must not be a categorical data type</li>
</ul>
<p><strong>Assumptions On Independent Variable</strong></p>
<ul>
<li><p>The independent variables are measured with <strong>no error</strong>, that is observations must be a set of known constants. (Note: If this is not so, modeling may be done instead using errors-in-variables model techniques)<br />
Think about if the ‘predictor’ has erors, what makes the outcome ?</p></li>
<li><strong>Each</strong> independent variable are <strong>linearly correclated with outcome</strong>, when other independent variables are held constant. Validation methods:
<ol style="list-style-type: lower-alpha">
<li>Run Matrix Scatter plot outcome against individual independent variables. Methods to verify are:<br />
</li>
<li>Run matrix correlation calculation for outcome againsts all independent varaibels. Correlation value 0.5 and above consider good correlation and therefore acceptable <br><br />
</li>
</ol></li>
<li><strong>NO Multicollinearity</strong> amont predictors - Meaning little or not linear correlationamong the predictors, i.e. it is not possible to express any predictor as a linear combination of the others, if so, we wouldn’t know which predictor actually influene the outcome. Validation method:
<ol style="list-style-type: lower-alpha">
<li>Scatter Plot Matrix for all independent variables<br />
</li>
<li>Correlation Matrix calculation for all independent varaibels. Correlation value 0.2 and below consider week correlation and therefore acceptable<br />
</li>
<li>Tolerance (<strong>T</strong>) - measures the influence of one independent variable on all other independent variables<br />
<strong>T &lt;0.01</strong> –&gt; <strong>confirm</strong> correlation<br />
<strong>T &lt;0.1</strong> –&gt; <strong>might have</strong> correlation<br />
</li>
<li>Variance Inflation Factor (<strong>VIF</strong>) - VIF = 1/T<br />
<strong>T &gt;100</strong> –&gt; <strong>confirm</strong> correlation<br />
<strong>T &gt;10</strong> –&gt; <strong>might have</strong> correlation<br />
</li>
<li>Condition Index (<strong>CI</strong>) - calculated using a factor analysis on the independent variables<br />
** Values of 10-30** –&gt; indicate a mediocre multicollinearity<br />
** Values &gt; 30** –&gt; strong multicollinearity</li>
</ol></li>
</ul>
<p><strong>Assumptions On Errors (residuals)</strong></p>
<ul>
<li>The <strong>errors are random numbers</strong>, with means of <strong>zero</strong>
<ul>
<li>There should not be a pattern in the residuals distribution<br />
</li>
<li>If the residuals are <strong>normally distributed</strong> with <strong>mean of zero</strong>, then it is considered a bonus which we can perform statistical significant testing. <span class="math inline">\(e = N(0,\sigma^2)\)</span><br />
</li>
<li>Normality on redisuals implies that the dependent variable are also normally distributed (if and only if <strong>dependent variable is not stochastic</strong>)</li>
</ul></li>
<li><p>The <strong>errors are uncorrelated</strong> - that is, the variance–covariance matrix of the errors is diagonal and each non-zero element is the variance of the error</p></li>
<li><p><strong>Homoscedasticity</strong> - The variance of the error is constant across observations. If heteroscedasticity exist, scatter plot of response and predictor will look like below</p></li>
</ul>
<p>If not, weighted least squares or other methods might instead be used. - The Goldfeld-Quandt Test can test for heteroscedasticity<br />
- If homoscedasticity is present, a non-linear correction might fix the problem</p>
<div id="are-the-assumptions-to-be-followed-strictly" class="section level4">
<h4><span class="header-section-number">10.4.2.1</span> Are The Assumptions to be followed strictly ?</h4>
<p>In real life, actual data <strong>rarely satisfies</strong> the assumptions, that is:</p>
<ul>
<li>Method is used even though the assumptions are not true<br />
</li>
<li>Variation from the assumptions can sometimes be used as a measure of how far the model is from being useful<br />
</li>
<li>Many of these assumptions may be relaxed in more advanced treatments</li>
</ul>
<p>Reports of statistical analyses usually include analyses of tests on the sample data and methodology for the fit and usefulness of the model.</p>
</div>
<div id="additional-notes-of-independent-variables" class="section level4">
<h4><span class="header-section-number">10.4.2.2</span> Additional notes of independent variables</h4>
<ul>
<li>Adding more variables to a regression procedure may <strong>overfit</strong> the model and make things worse. The idea is to pick the <strong>best</strong> variables<br />
</li>
<li>Some independent variable(s) are better at predicting the outocme, some contribute little or nothing</li>
</ul>
<p>Because of <strong>multicollinearity</strong> and <strong>overfitting</strong>, there is a fair amount of <strong>prep-work</strong> to be performed BEFORE conducting multiple regression analysis - if one is to do it properly.</p>
</div>
</div>
<div id="equations" class="section level3">
<h3><span class="header-section-number">10.4.3</span> Equations</h3>
<div id="terminology" class="section level4">
<h4><span class="header-section-number">10.4.3.1</span> Terminology</h4>
<p><strong>Simple</strong> Linear Regression (classical) consists of just on predictor. aka Single Variable Linear Regression.<br />
<strong>Multiple</strong> Linear Regression (classical) consists of multiple predictors. aka. Multiple Variable Linear Regression.</p>
<p><strong>Multivariate</strong> Regression (aka. <strong>General Linear Regression</strong>) is linear regression where the outocme is a vector (not scalar). Not the same as multiple variable linear regression.</p>
</div>
<div id="ordinary-least-square-estimatation" class="section level4">
<h4><span class="header-section-number">10.4.3.2</span> Ordinary Least Square Estimatation</h4>
<p><strong>Regression Model - Actual Outcome</strong></p>
<p><span class="math inline">\(\quad y_i = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + ... \beta_k x_k + e_i\)</span><br />
<span class="math inline">\(\quad\)</span>where:<br />
<span class="math inline">\(\quad \quad y_i\)</span> = actual outcome value<br />
<span class="math inline">\(\quad \quad \beta_0\)</span> = intercept, when all independent variables are 0<br />
<span class="math inline">\(\quad \quad \beta_k\)</span> = parameter for independent variable k <span class="math inline">\(\quad \quad e_i\)</span> = error for observation i</p>
<p><strong>Regression Equation - Predicted Outcome</strong></p>
<p><span class="math inline">\(\quad E(y_i) = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + ... \beta_k x_k\)</span></p>
<p><span class="math inline">\(\quad h_\theta(X)~=~\theta_0~+~\theta_1 \cdot X\)</span> , error terms assumed to be zero<br />
<span class="math inline">\(\quad\)</span>where:<br />
<span class="math inline">\(\quad \quad h_\theta(x)\)</span> = hypothesis target (dependant variable)<br />
<span class="math inline">\(\quad \quad \theta_0\)</span> = intercept<br />
<span class="math inline">\(\quad \quad \theta_1\)</span> = slopes or coefficients<br />
<span class="math inline">\(\quad \quad X\)</span> = independant variables (predictors)</p>
<p><span class="math inline">\(\quad\)</span>Take note that each <span class="math inline">\(\theta_0\)</span> and <span class="math inline">\(\theta_1\)</span> represents multi-variate data in matrix form.</p>
</div>
<div id="cost-function" class="section level4">
<h4><span class="header-section-number">10.4.3.3</span> Cost Function</h4>
<ul>
<li>The goal is to find some values of θ (known as coefficients), so we can minimize the difference between real values <span class="math inline">\(y\)</span> and predicted values (<span class="math inline">\(h(x)\)</span>)<br />
</li>
<li>Mathematically, this means finding the minimum value of cost function <span class="math inline">\(J\)</span> and derive the optimum value of <span class="math inline">\(\theta_0\)</span> and <span class="math inline">\(\theta_1\)</span><br />
</li>
<li>Linear regression uses Total Sum Of Square calculation on Error as Cost Function, denoted by <span class="math inline">\(J\)</span> below:</li>
</ul>
<p><span class="math inline">\(\quad \quad J(\theta_0,\theta_1) = \frac{1}{2m}\sum_{i=1}^m ((h_\theta(x^i)-y^i)^2\)</span></p>
</div>
</div>
<div id="ols-performance" class="section level3">
<h3><span class="header-section-number">10.4.4</span> OLS Performance</h3>
<div id="fundamental" class="section level4">
<h4><span class="header-section-number">10.4.4.1</span> Fundamental</h4>
<p>OLS performance is mainly on error analysis.</p>
<p><strong>SST</strong> (<strong>total</strong> sample variability) = <strong>SSR</strong> (<strong>explained</strong> variability) + <strong>SSE</strong> (<strong>unexplained</strong> variability) :</p>
<div class="figure">
<img src="images/explain_sst.jpg" alt="SST Explained" />
<p class="caption">SST Explained</p>
</div>
</div>
<div id="root-mean-square-error-rmse" class="section level4">
<h4><span class="header-section-number">10.4.4.2</span> Root Mean Square Error (RMSE)</h4>
<ul>
<li>RMSE = The square root of the average of the total sum of square error<br />
<span class="math inline">\(RMSE = \sqrt{\frac{SSE}{n}} = \sqrt \frac{\sum^n_{i=1}{(y_i - \hat y_i)^2}}{n}\)</span><br />
</li>
<li>It measure <strong>how close</strong> observed data points are to the model’s predicted values<br />
</li>
<li>It has a unit of Y, therefore cannot used for comparison models with different outcome</li>
<li>It can be used to compare different model with the similar outcome but different predictors, however, adjusted <span class="math inline">\(R^2\)</span> is better in this<br />
</li>
<li>Low RMSE value indicates better fit<br />
</li>
<li>Compared to the similar Mean Absolute Error, RMSE amplifies and severely punishes large errors</li>
</ul>
<blockquote>
<p><strong>RMSE</strong> is excellent general measurement to assess <strong>the accuracy</strong> of a model</p>
</blockquote>
</div>
<div id="r-r2-and-r2_adj" class="section level4">
<h4><span class="header-section-number">10.4.4.3</span> <span class="math inline">\(r\)</span>, <span class="math inline">\(R^2\)</span> and <span class="math inline">\(R^2_{adj}\)</span></h4>
<p><strong>r - Correlation Coeeficient</strong></p>
<ul>
<li>Correlation, often measured as a correlation coefficient - indicates the <strong>strength</strong> and direction of a linear relationship between two variables (for example model output and observed values)<br />
</li>
<li>The best known is the Pearson product-moment correlation coefficient (also called Pearson correlation coefficient or the sample correlation coefficient)<br />
</li>
<li>It is a ratio (has no unit)<br />
<span class="math inline">\(Pearson Correlation, r = \frac{{}\sum_{i=1}^{n} (x_i - \overline{x})(y_i - \overline{y})} {\sqrt{\sum_{i=1}^{n} (x_i - \overline{x})^2(y_i - \overline{y})^2}} \quad, \quad 0=&lt;r&lt;=1\)</span></li>
</ul>
<blockquote>
<p><strong>Scatter plot</strong> predicted and actual outcome reveal visually the good-fit of the model, good correlation also means tigther the scatter plots with less variability</p>
</blockquote>
<p><strong>R-Squared - Coefficient Determination</strong></p>
<ul>
<li><p><span class="math inline">\(R^2\)</span> is a ratio indicating how much <strong>variations are explained</strong> by regression model<br />
<span class="math inline">\(R^2 = r^2 = \frac{SSR}{SST} = 1-\frac{SSE}{SST}, \quad 0 &lt;= R^2 &lt;= 1\)</span></p></li>
<li>High <span class="math inline">\(R^2\)</span> value indicates high SSR and low SSE, which means the model is <strong>more precise</strong>
<ul>
<li>In a <strong>perfect fit</strong> situation (SSE=0), <span class="math inline">\(R^2\)</span> will be 1.<br />
</li>
<li>In a worst fit situation (coefficient=0, SSR=0, aka horizontally flat line), <span class="math inline">\(R^2\)</span> will be 0.</li>
</ul></li>
<li><p>One pitfall of <span class="math inline">\(R^2\)</span> is that it <strong>always increases</strong> when additional variables are added to the model. The increase can be artificial as it doesn’t improve the model fit - which is called <strong>over-fitting</strong>. A <strong>remediation</strong> to this is <span class="math inline">\(R^2_{adj}\)</span></p></li>
</ul>
<p><strong>Adjusted R-Squared</strong></p>
<ul>
<li><p>Adjusted <span class="math inline">\(R^2\)</span> incorporates the number of coefficients and observations into the calculation<br />
<span class="math inline">\(R_{adj}^2 = 1- \bigg( \frac{n-1}{n-p}\bigg) \frac{SSE}{SST}\)</span><br />
<span class="math inline">\(\quad\)</span> p = number of coefficients (including intercept)<br />
<span class="math inline">\(\quad\)</span> n = number of observations</p></li>
<li>Adjusted <span class="math inline">\(R^2\)</span> will <strong>decrease</strong> when adding predictors that doesn’t increase the model fit that make up for the loss of degrees of freedom<br />
</li>
<li><p>Likewise, it will <strong>increase</strong> as predictors are added if the increase in model fit is <strong>worthwhile</strong></p></li>
</ul>
<blockquote>
<p><strong><span class="math inline">\(R^2_{adj}\)</span></strong> is useful for <strong>comparing models with a different number of predictors</strong>, hence can be use for features selection</p>
</blockquote>
</div>
</div>
<div id="sample-data-7" class="section level3">
<h3><span class="header-section-number">10.4.5</span> Sample Data</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1234</span>)
n=<span class="dv">100</span>
my.df =<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">id =</span> <span class="kw">paste</span>(<span class="st">&#39;ID&#39;</span>, <span class="dv">1</span><span class="op">:</span>n),
  <span class="dt">x1 =</span> <span class="dv">10</span><span class="op">:</span>(<span class="dv">10</span> <span class="op">+</span><span class="st"> </span>n <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="kw">runif</span>(n, <span class="dt">min =</span> <span class="fl">0.5</span>, <span class="dt">max =</span> <span class="fl">1.1</span>),
  <span class="dt">x2 =</span> <span class="dv">20</span><span class="op">:</span>(<span class="dv">20</span> <span class="op">+</span><span class="st"> </span>n <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="kw">runif</span>(n, <span class="dt">min =</span> <span class="fl">0.5</span>, <span class="dt">max =</span> <span class="fl">1.1</span>),
  <span class="dt">x3 =</span> <span class="dv">30</span><span class="op">:</span>(<span class="dv">30</span> <span class="op">+</span><span class="st"> </span>n <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="kw">runif</span>(n, <span class="dt">min =</span> <span class="fl">0.5</span>, <span class="dt">max =</span> <span class="fl">1.1</span>)
)
my.df<span class="op">$</span>y =<span class="st"> </span><span class="dv">88</span> <span class="op">+</span><span class="st"> </span><span class="fl">0.1</span> <span class="op">*</span><span class="st"> </span>my.df<span class="op">$</span>x1 <span class="op">+</span><span class="st"> </span><span class="fl">0.2</span> <span class="op">*</span><span class="st"> </span>my.df<span class="op">$</span>x2 <span class="op">+</span><span class="st"> </span><span class="fl">0.3</span><span class="op">*</span>my.df<span class="op">$</span>x3
<span class="kw">cor</span>(my.df[, <span class="dv">2</span><span class="op">:</span><span class="dv">5</span>])
<span class="kw">lm</span>(<span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2 <span class="op">+</span><span class="st"> </span>x3, <span class="dt">data =</span> my.df)</code></pre></div>
<pre><code>##           x1        x2        x3         y
## x1 1.0000000 0.7798930 0.7848857 0.8732915
## x2 0.7798930 1.0000000 0.7879751 0.9235238
## x3 0.7848857 0.7879751 1.0000000 0.9574600
## y  0.8732915 0.9235238 0.9574600 1.0000000
## 
## Call:
## lm(formula = y ~ x1 + x2 + x3, data = my.df)
## 
## Coefficients:
## (Intercept)           x1           x2           x3  
##        88.0          0.1          0.2          0.3</code></pre>
<p><span class="math inline">\(h(x_1,x_2,x_3) = \theta_0+ \theta_1x_1 + \theta_2x_2 + \theta_3X_3\)</span></p>
</div>
<div id="run-the-code-4" class="section level3">
<h3><span class="header-section-number">10.4.6</span> Run The Code</h3>
<blockquote>
<p><strong><code>fit = lm ( data = , formula = )</code></strong><br />
<strong><code>fit = lm ( data , formula )</code></strong><br />
<strong><code>fit = lm ( formula , data )</code></strong><br />
formula : y~x1 + x2 + x3<br />
data: matrix or dataframe</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cor</span>(my.df[, <span class="dv">2</span><span class="op">:</span><span class="dv">5</span>])
<span class="kw">lm</span>(<span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2 <span class="op">+</span><span class="st"> </span>x3, <span class="dt">data =</span> my.df)</code></pre></div>
<pre><code>##           x1        x2        x3         y
## x1 1.0000000 0.7798930 0.7848857 0.8732915
## x2 0.7798930 1.0000000 0.7879751 0.9235238
## x3 0.7848857 0.7879751 1.0000000 0.9574600
## y  0.8732915 0.9235238 0.9574600 1.0000000
## 
## Call:
## lm(formula = y ~ x1 + x2 + x3, data = my.df)
## 
## Coefficients:
## (Intercept)           x1           x2           x3  
##        88.0          0.1          0.2          0.3</code></pre>
</div>
</div>
<div id="regression-diagnostic" class="section level2">
<h2><span class="header-section-number">10.5</span> Regression Diagnostic</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&#39;car&#39;</span>)</code></pre></div>
<div id="outlier-test" class="section level3">
<h3><span class="header-section-number">10.5.1</span> Outlier Test</h3>
</div>
<div id="linearity-test" class="section level3">
<h3><span class="header-section-number">10.5.2</span> Linearity Test</h3>
</div>
<div id="homoscedasticity-test" class="section level3">
<h3><span class="header-section-number">10.5.3</span> Homoscedasticity Test</h3>
</div>
<div id="multicollinearity-test" class="section level3">
<h3><span class="header-section-number">10.5.4</span> Multicollinearity Test</h3>
</div>
<div id="normality-test" class="section level3">
<h3><span class="header-section-number">10.5.5</span> Normality Test</h3>
<!--chapter:end:10-regression.Rmd-->
</div>
</div>
</div>
<div id="classification" class="section level1">
<h1><span class="header-section-number">11</span> Classification</h1>
<div id="introduction-1" class="section level2">
<h2><span class="header-section-number">11.1</span> Introduction</h2>
</div>
<div id="application-2" class="section level2">
<h2><span class="header-section-number">11.2</span> Application</h2>
</div>
<div id="comparing-algorithm" class="section level2">
<h2><span class="header-section-number">11.3</span> Comparing Algorithm</h2>
</div>
<div id="logistic-regression" class="section level2">
<h2><span class="header-section-number">11.4</span> Logistic Regression</h2>
<div id="the-concept-1" class="section level3">
<h3><span class="header-section-number">11.4.1</span> The Concept</h3>
<p>Logistic Regression is a actually a <strong>classification</strong> algorithm. It is used to predict:</p>
<ul>
<li>Binary outcome (1=Yes/Sucess, 0=No/Failure), given a set of independent variables.</li>
<li>Multinomial outcome (more than two categories) - however, reference category for comparison must be specified, otehrwise, must run multiple regressions with different refence categories</li>
</ul>
<p>Logistic Regression as a <strong>special case</strong> of linear regression where:</p>
<ul>
<li>The outcome variable is categorical<br />
</li>
<li><strong>Ln of odds</strong> as dependent variable</li>
</ul>
<p>Linear regression cannot be used for classification because:</p>
<ul>
<li>Binary data does not have a normal distribution, which is a condition for many types of regressions<br />
</li>
<li>Predicted values can go beyond 0 and 1, which violates the definition of probability<br />
</li>
<li>Probabilities are often not linear</li>
</ul>
</div>
<div id="assumptions-1" class="section level3">
<h3><span class="header-section-number">11.4.2</span> Assumptions</h3>
<p>Since logistic regression is related to linear combination of IVs, it share some common asssumptions regarding IVs and error terms:</p>
<ol style="list-style-type: decimal">
<li>Dependent variable must be 1/0 type eg. ‘sucess/failure’, ‘male/female’, ‘yes/no’. Must not be ordinal and continous<br />
</li>
<li>Observations must be independent<br />
</li>
<li>Like OLS, Linearity between logit with all independent variables<br />
</li>
<li>Like OLS, NO multicollinearity - if found, create interaction term, or drop one of the IVs<br />
</li>
<li>Like OLS, error terms are assumed uncorrelated</li>
</ol>
<p>Although <strong>logit</strong> is a linear relation with independent variables, logistic regression (which use MLE) is <strong>different from OLS</strong> Linear Regression as below, due to the fact that DV is categorical and not continuuous:</p>
<ul>
<li>Can handle categorical independent variables<br />
</li>
<li>Does not assume normality of DV and IVs: becauae <span class="math inline">\(p\)</span> follow Bernoulli distribution<br />
</li>
<li>Does not assume linearity between DV and IVs: because DV is categorical<br />
</li>
<li>Does not assume homoscedasticity<br />
</li>
<li>Does not assume normal errors</li>
</ul>
</div>
<div id="equations-1" class="section level3">
<h3><span class="header-section-number">11.4.3</span> Equations</h3>
<ul>
<li>The goal of logistic regression is to estimate <span class="math inline">\(p\)</span> (the probability of ‘Success’) for a <strong>linear combination</strong> of the independent variables<br />
</li>
<li><p>This is done by ‘linking’ the linear combination of independent variables to Bernoulli probability distribution (with domain from 0 to 1), to predict the probability of success</p></li>
<li><p>The <strong>link function</strong> is called <strong>logit</strong>, which is the natural log of odds ratio. It is a linear function against independent variables:<br />
<span class="math inline">\(logit(p) = ln(odds) = ln\bigg(\frac{p}{1-p}\bigg) = \beta_0 + \beta_1 x_1 + ... + \beta_n x_n\)</span></p></li>
<li><p>Derive <strong>Odd ratio</strong> by anti-log. It measures the ‘strength’ of IV in affecting the outcome, p:<br />
<span class="math inline">\(odds = \frac{p}{1-p} = e^{\beta_0 + \beta_1 x_1 + ... + \beta_n x_n}\)</span></p></li>
<li><p><span class="math inline">\(p\)</span> can be further derived as below sigmoid function. <span class="math inline">\(p\)</span> is <strong>non-linear</strong> against independent varibales :<br />
<span class="math inline">\(p = \frac{1}{1+e^{-\beta_0 + \beta_1x_1 + ... + \beta_nx_n}}\)</span></p></li>
</ul>
</div>
<div id="sample-data-8" class="section level3">
<h3><span class="header-section-number">11.4.4</span> Sample Data</h3>
</div>
<div id="run-the-code-5" class="section level3">
<h3><span class="header-section-number">11.4.5</span> Run The Code</h3>
<blockquote>
<p><strong><code>glm</code></strong> <code>(formula, family=gaussian(link=identity), data)</code><br />
<span class="math inline">\(\quad\)</span> <code>formula : example y ~ x1 + x2 + x3</code><br />
<span class="math inline">\(\quad\)</span> <code>family  : binomial, gaussian, poisson, quasi etc   $\quad$</code>link : logit-default for binomial(), identity-default for gaussian, log-default for poisson`</p>
</blockquote>
<div id="binomial" class="section level4">
<h4><span class="header-section-number">11.4.5.1</span> Binomial</h4>
<p><strong>Binomial Example</strong></p>
<pre><code>glm (y ~ x1 + x2 + x3 , family=binomial(logit), data=my.df)</code></pre>
</div>
</div>
</div>
<div id="performance-measurement" class="section level2">
<h2><span class="header-section-number">11.5</span> Performance Measurement</h2>
<blockquote>
<p>summary(fit) # display results<br />
confint(fit) # 95% CI for the coefficients<br />
exp(coef(fit)) # exponentiated coefficients<br />
exp(confint(fit)) # 95% CI for exponentiated coefficients<br />
predict(fit, type=“response”) # predicted values<br />
residuals(fit, type=“deviance”) # residuals</p>
</blockquote>
<div id="confusion-matrix" class="section level3">
<h3><span class="header-section-number">11.5.1</span> Confusion Matrix</h3>
<div class="figure">
<img src="images/confusion_table.jpg" alt="Confusion Matrix" />
<p class="caption">Confusion Matrix</p>
</div>
<p><span class="math inline">\(Accuracy = \frac{TP+TN}{TP+TN+FP+FN}\)</span></p>
<p><strong>Simulate the Binary Data</strong> and generate frequency table of Actual vs Predicted</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">predicted =<span class="st"> </span><span class="kw">sample</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">1</span>, <span class="dv">33</span>, <span class="dt">replace=</span>T)
actual    =<span class="st"> </span><span class="kw">sample</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">1</span>, <span class="dv">33</span>, <span class="dt">replace=</span>T)
t =<span class="st"> </span><span class="kw">table</span>(actual, predicted)    <span class="co"># 2-dim frequency table</span>
t</code></pre></div>
<pre><code>##       predicted
## actual 0 1
##      0 9 8
##      1 9 7</code></pre>
<p><strong>Generate Proportion Table</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p1 =<span class="st"> </span><span class="kw">prop.table</span>(t)              <span class="co"># for accuracy calc</span>
<span class="kw">addmargins</span>(p1)</code></pre></div>
<pre><code>##       predicted
## actual         0         1       Sum
##    0   0.2727273 0.2424242 0.5151515
##    1   0.2727273 0.2121212 0.4848485
##    Sum 0.5454545 0.4545455 1.0000000</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p2 =<span class="st"> </span><span class="kw">prop.table</span>(t, <span class="dt">margin =</span> <span class="dv">1</span>)  <span class="co"># for tpr, fpr, fnr, tnr calc</span>
<span class="kw">addmargins</span>(p2,<span class="dv">2</span>)</code></pre></div>
<pre><code>##       predicted
## actual         0         1       Sum
##      0 0.5294118 0.4705882 1.0000000
##      1 0.5625000 0.4375000 1.0000000</code></pre>
<p><strong>Calcuate Metrics</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">c</span>(<span class="dt">accuracy=</span>p1[<span class="dv">1</span>]<span class="op">+</span>p1[<span class="dv">4</span>],<span class="dt">tpr=</span>p2[<span class="dv">1</span>],<span class="dt">fpr=</span>p2[<span class="dv">2</span>],<span class="dt">fnr=</span>p2[<span class="dv">3</span>],<span class="dt">tnr=</span>p2[<span class="dv">4</span>])</code></pre></div>
<pre><code>##  accuracy       tpr       fpr       fnr       tnr 
## 0.4848485 0.5294118 0.5625000 0.4705882 0.4375000</code></pre>
</div>
<div id="roc-curve" class="section level3">
<h3><span class="header-section-number">11.5.2</span> ROC Curve</h3>
<!--chapter:end:11-classification.Rmd-->
</div>
</div>
</div>
<div id="survival-analysis" class="section level1">
<h1><span class="header-section-number">12</span> Survival Analysis</h1>
<div id="library-3" class="section level2">
<h2><span class="header-section-number">12.1</span> Library</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(survival)</code></pre></div>
</div>
<div id="sample-data-9" class="section level2">
<h2><span class="header-section-number">12.2</span> Sample Data</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">main.data =<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;./datasets/surv_maintenance.csv&#39;</span>)
<span class="kw">str</span>(main.data)</code></pre></div>
<pre><code>## &#39;data.frame&#39;:    1000 obs. of  7 variables:
##  $ lifetime      : int  56 81 60 86 34 30 68 65 23 81 ...
##  $ broken        : int  0 1 0 1 0 0 0 1 0 1 ...
##  $ pressureInd   : num  92.2 72.1 96.3 94.4 97.8 ...
##  $ moistureInd   : num  104.2 103.1 77.8 108.5 99.4 ...
##  $ temperatureInd: num  96.5 87.3 112.2 72 103.8 ...
##  $ team          : Factor w/ 3 levels &quot;TeamA&quot;,&quot;TeamB&quot;,..: 1 3 1 3 2 1 2 2 2 3 ...
##  $ provider      : Factor w/ 4 levels &quot;Provider1&quot;,&quot;Provider2&quot;,..: 4 4 1 2 1 1 2 3 2 4 ...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(main.data)</code></pre></div>
<pre><code>##   lifetime broken pressureInd moistureInd temperatureInd  team  provider
## 1       56      0    92.17885   104.23020       96.51716 TeamA Provider4
## 2       81      1    72.07594   103.06570       87.27106 TeamC Provider4
## 3       60      0    96.27225    77.80138      112.19617 TeamA Provider1
## 4       86      1    94.40646   108.49361       72.02537 TeamC Provider2
## 5       34      0    97.75290    99.41349      103.75627 TeamB Provider1
## 6       30      0    87.67880   115.71226       89.79210 TeamA Provider1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(main.data)</code></pre></div>
<pre><code>##     lifetime        broken       pressureInd      moistureInd    
##  Min.   : 1.0   Min.   :0.000   Min.   : 33.48   Min.   : 58.55  
##  1st Qu.:34.0   1st Qu.:0.000   1st Qu.: 85.56   1st Qu.: 92.77  
##  Median :60.0   Median :0.000   Median : 97.22   Median : 99.43  
##  Mean   :55.2   Mean   :0.397   Mean   : 98.60   Mean   : 99.38  
##  3rd Qu.:80.0   3rd Qu.:1.000   3rd Qu.:112.25   3rd Qu.:106.12  
##  Max.   :93.0   Max.   :1.000   Max.   :173.28   Max.   :128.60  
##  temperatureInd      team          provider  
##  Min.   : 42.28   TeamA:336   Provider1:254  
##  1st Qu.: 87.68   TeamB:356   Provider2:266  
##  Median :100.59   TeamC:308   Provider3:242  
##  Mean   :100.63               Provider4:238  
##  3rd Qu.:113.66                              
##  Max.   :172.54</code></pre>
</div>
<div id="the-code" class="section level2">
<h2><span class="header-section-number">12.3</span> The Code</h2>
<p><strong>Create the Model</strong></p>
<p>Step 1 - Use survival::Surv to create an object that ties time (lifetime) to event (broken). This object simple simply combines both time and event variables together in a matrix.</p>
<p>Step 2 - run the modelling with the time-event object create above, specify the parameters and distribution (example below use normal distribution).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dependantVar =<span class="st"> </span><span class="kw">Surv</span>(main.data<span class="op">$</span>lifetime, main.data<span class="op">$</span>broken)
main.fit =<span class="st"> </span><span class="kw">survreg</span>(dependantVar<span class="op">~</span>pressureInd<span class="op">+</span>moistureInd<span class="op">+</span>temperatureInd<span class="op">+</span>team<span class="op">+</span>provider, 
                   <span class="dt">dist=</span><span class="st">&quot;gaussian&quot;</span>, 
                   <span class="dt">data=</span>main.data)
<span class="kw">summary</span>(main.fit)</code></pre></div>
<pre><code>## 
## Call:
## survreg(formula = dependantVar ~ pressureInd + moistureInd + 
##     temperatureInd + team + provider, data = main.data, dist = &quot;gaussian&quot;)
##                       Value Std. Error        z        p
## (Intercept)        8.04e+01    0.29371  273.574 0.00e+00
## pressureInd       -7.14e-04    0.00122   -0.587 5.57e-01
## moistureInd        6.01e-03    0.00240    2.505 1.22e-02
## temperatureInd    -1.04e-02    0.00121   -8.593 8.49e-18
## teamTeamB         -5.67e-02    0.05882   -0.964 3.35e-01
## teamTeamC         -6.22e+00    0.06132 -101.392 0.00e+00
## providerProvider2  1.25e+01    0.06665  187.464 0.00e+00
## providerProvider3 -1.44e+01    0.06275 -229.241 0.00e+00
## providerProvider4  7.92e+00    0.07056  112.233 0.00e+00
## Log(scale)        -7.43e-01    0.03540  -20.998 6.86e-98
## 
## Scale= 0.476 
## 
## Gaussian distribution
## Loglik(model)= -270.1   Loglik(intercept only)= -1557
##  Chisq= 2573.75 on 8 degrees of freedom, p= 0 
## Number of Newton-Raphson Iterations: 12 
## n= 1000</code></pre>
<p>Use the model to predict lifetime before break (labeled as Ebreak below). Then calculate the remaing lifetime (remaingLT) as predicted lifetime before break - current lifetime.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Ebreak =<span class="st"> </span><span class="kw">predict</span>(main.fit, <span class="dt">data=</span>main.data,<span class="dt">type=</span><span class="st">&#39;quantile&#39;</span>,<span class="dt">p=</span><span class="fl">0.5</span>)
remainingLT =<span class="st"> </span>Ebreak <span class="op">-</span><span class="st"> </span>main.data<span class="op">$</span>lifetime</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">main.data.forecast =<span class="st"> </span><span class="kw">data.frame</span> (
  <span class="dt">lifetime =</span> main.data<span class="op">$</span>lifetime,
  <span class="dt">broken =</span> main.data<span class="op">$</span>broken,
  Ebreak,
  remainingLT
)</code></pre></div>
<p>Put all into one data.frame. Sort the remainingLT with lowest first, so that the priority to pay attention to are top to down.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(main.data.forecast[<span class="kw">order</span>(main.data.forecast<span class="op">$</span>remainingLT, <span class="dt">decreasing =</span> <span class="ot">FALSE</span>),])</code></pre></div>
<pre><code>##     lifetime broken   Ebreak remainingLT
## 277       61      1 59.67415   -1.325853
## 668       60      1 58.83450   -1.165500
## 619       60      1 58.86275   -1.137253
## 338       60      1 58.87862   -1.121378
## 303       60      1 58.88567   -1.114328
## 557       60      1 58.89501   -1.104994</code></pre>
</div>
<div id="performance-evaluation" class="section level2">
<h2><span class="header-section-number">12.4</span> Performance Evaluation</h2>
<p>Performance can be measured by analysis <strong>how well the model predict the lifetime of ‘already happened event’</strong>, which is the training data. Subset the training data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">eval.data =<span class="st"> </span><span class="kw">subset</span> ( main.data.forecast, broken<span class="op">==</span><span class="dv">1</span>)</code></pre></div>
<p>Measure <strong>correlation</strong> of the predicted and actual.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cor</span>(eval.data<span class="op">$</span>Ebreak,eval.data<span class="op">$</span>lifetime)
## [1] 0.9989941</code></pre></div>
<p><strong>Visualize</strong> the fitness of the model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(eval.data<span class="op">$</span>Ebreak, eval.data<span class="op">$</span>lifetime)</code></pre></div>
<p><img src="biz_tech_analytics_r_files/figure-html/unnamed-chunk-181-1.png" width="864" /></p>
<!--chapter:end:12-survival.Rmd-->
</div>
</div>
<!--bookdown:body:end-->
            </section>

          </div>
        </div>
      </div>
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
    </div>
  </div>
<!--bookdown:config-->

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
